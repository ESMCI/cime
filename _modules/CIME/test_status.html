
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>CIME.test_status &#8212; CIME 5.6 documentation</title>
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">CIME 5.6 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for CIME.test_status</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Contains the crucial TestStatus class which manages phase-state of a test</span>
<span class="sd">case and ensure that this state is represented by the TestStatus file in</span>
<span class="sd">the case.</span>

<span class="sd">TestStatus objects are only modifiable via the set_status method and this</span>
<span class="sd">is only allowed if the object is being accessed within the context of a</span>
<span class="sd">context manager. Example:</span>

<span class="sd">    with TestStatus(test_dir=caseroot) as ts:</span>
<span class="sd">        ts.set_status(RUN_PHASE, TEST_PASS_STATUS)</span>

<span class="sd">This file also contains all of the hardcoded phase information which includes</span>
<span class="sd">the phase names, phase orders, potential phase states, and which phases are</span>
<span class="sd">required (core phases).</span>

<span class="sd">Additional important design decisions:</span>
<span class="sd">1) In order to ensure that incomplete tests are always left in a PEND</span>
<span class="sd">   state, updating a core phase to a PASS state will automatically set the next</span>
<span class="sd">   core state to PEND.</span>
<span class="sd">2) If the user repeats a core state, that invalidates all subsequent state. For</span>
<span class="sd">   example, if a user rebuilds their case, then any of the post-run states like the</span>
<span class="sd">   RUN state are no longer valid.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">CIME.XML.standard_module_setup</span> <span class="k">import</span> <span class="o">*</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span>

<span class="kn">import</span> <span class="nn">os</span>

<span class="n">TEST_STATUS_FILENAME</span> <span class="o">=</span> <span class="s2">&quot;TestStatus&quot;</span>

<span class="c1"># The statuses that a phase can be in</span>
<span class="n">TEST_PEND_STATUS</span> <span class="o">=</span> <span class="s2">&quot;PEND&quot;</span>
<span class="n">TEST_PASS_STATUS</span> <span class="o">=</span> <span class="s2">&quot;PASS&quot;</span>
<span class="n">TEST_FAIL_STATUS</span> <span class="o">=</span> <span class="s2">&quot;FAIL&quot;</span>

<span class="n">ALL_PHASE_STATUSES</span> <span class="o">=</span> <span class="p">[</span><span class="n">TEST_PEND_STATUS</span><span class="p">,</span> <span class="n">TEST_PASS_STATUS</span><span class="p">,</span> <span class="n">TEST_FAIL_STATUS</span><span class="p">]</span>

<span class="c1"># Special statuses that the overall test can be in</span>
<span class="n">TEST_DIFF_STATUS</span>     <span class="o">=</span> <span class="s2">&quot;DIFF&quot;</span>   <span class="c1"># Implies a failure in the BASELINE phase</span>
<span class="n">NAMELIST_FAIL_STATUS</span> <span class="o">=</span> <span class="s2">&quot;NLFAIL&quot;</span> <span class="c1"># Implies a failure in the NLCOMP phase</span>

<span class="c1"># Special strings that can appear in comments, indicating particular types of failures</span>
<span class="n">TEST_NO_BASELINES_COMMENT</span> <span class="o">=</span> <span class="s2">&quot;BFAIL&quot;</span> <span class="c1"># Implies baseline directory is missing in the baseline comparison phase</span>

<span class="c1"># The valid phases</span>
<span class="n">CREATE_NEWCASE_PHASE</span>  <span class="o">=</span> <span class="s2">&quot;CREATE_NEWCASE&quot;</span>
<span class="n">XML_PHASE</span>             <span class="o">=</span> <span class="s2">&quot;XML&quot;</span>
<span class="n">SETUP_PHASE</span>           <span class="o">=</span> <span class="s2">&quot;SETUP&quot;</span>
<span class="n">NAMELIST_PHASE</span>        <span class="o">=</span> <span class="s2">&quot;NLCOMP&quot;</span>
<span class="n">SHAREDLIB_BUILD_PHASE</span> <span class="o">=</span> <span class="s2">&quot;SHAREDLIB_BUILD&quot;</span>
<span class="n">MODEL_BUILD_PHASE</span>     <span class="o">=</span> <span class="s2">&quot;MODEL_BUILD&quot;</span>
<span class="n">SUBMIT_PHASE</span>          <span class="o">=</span> <span class="s2">&quot;SUBMIT&quot;</span>
<span class="n">RUN_PHASE</span>             <span class="o">=</span> <span class="s2">&quot;RUN&quot;</span>
<span class="n">THROUGHPUT_PHASE</span>      <span class="o">=</span> <span class="s2">&quot;TPUTCOMP&quot;</span>
<span class="n">MEMCOMP_PHASE</span>         <span class="o">=</span> <span class="s2">&quot;MEMCOMP&quot;</span>
<span class="n">MEMLEAK_PHASE</span>         <span class="o">=</span> <span class="s2">&quot;MEMLEAK&quot;</span>
<span class="n">STARCHIVE_PHASE</span>       <span class="o">=</span> <span class="s2">&quot;SHORT_TERM_ARCHIVER&quot;</span>
<span class="n">COMPARE_PHASE</span>         <span class="o">=</span> <span class="s2">&quot;COMPARE&quot;</span> <span class="c1"># This is one special, real phase will be COMPARE_$WHAT, this is for internal test comparisons, there could be multiple variations of this phase in one test</span>
<span class="n">BASELINE_PHASE</span>        <span class="o">=</span> <span class="s2">&quot;BASELINE&quot;</span>
<span class="n">GENERATE_PHASE</span>        <span class="o">=</span> <span class="s2">&quot;GENERATE&quot;</span>

<span class="n">ALL_PHASES</span> <span class="o">=</span> <span class="p">[</span><span class="n">CREATE_NEWCASE_PHASE</span><span class="p">,</span>
              <span class="n">XML_PHASE</span><span class="p">,</span>
              <span class="n">SETUP_PHASE</span><span class="p">,</span>
              <span class="n">NAMELIST_PHASE</span><span class="p">,</span>
              <span class="n">SHAREDLIB_BUILD_PHASE</span><span class="p">,</span>
              <span class="n">MODEL_BUILD_PHASE</span><span class="p">,</span>
              <span class="n">SUBMIT_PHASE</span><span class="p">,</span>
              <span class="n">RUN_PHASE</span><span class="p">,</span>
              <span class="n">COMPARE_PHASE</span><span class="p">,</span>
              <span class="n">BASELINE_PHASE</span><span class="p">,</span>
              <span class="n">THROUGHPUT_PHASE</span><span class="p">,</span>
              <span class="n">MEMCOMP_PHASE</span><span class="p">,</span>
              <span class="n">MEMLEAK_PHASE</span><span class="p">,</span>
              <span class="n">STARCHIVE_PHASE</span><span class="p">,</span>
              <span class="n">GENERATE_PHASE</span><span class="p">]</span>

<span class="c1"># These are mandatory phases that a test must go through</span>
<span class="n">CORE_PHASES</span> <span class="o">=</span> <span class="p">[</span><span class="n">CREATE_NEWCASE_PHASE</span><span class="p">,</span>
               <span class="n">XML_PHASE</span><span class="p">,</span>
               <span class="n">SETUP_PHASE</span><span class="p">,</span>
               <span class="n">SHAREDLIB_BUILD_PHASE</span><span class="p">,</span>
               <span class="n">MODEL_BUILD_PHASE</span><span class="p">,</span>
               <span class="n">SUBMIT_PHASE</span><span class="p">,</span>
               <span class="n">RUN_PHASE</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">_test_helper1</span><span class="p">(</span><span class="n">file_contents</span><span class="p">):</span>
    <span class="n">ts</span> <span class="o">=</span> <span class="n">TestStatus</span><span class="p">(</span><span class="n">test_dir</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">test_name</span><span class="o">=</span><span class="s2">&quot;ERS.foo.A&quot;</span><span class="p">)</span>
    <span class="n">ts</span><span class="o">.</span><span class="n">_parse_test_status</span><span class="p">(</span><span class="n">file_contents</span><span class="p">)</span> <span class="c1"># pylint: disable=protected-access</span>
    <span class="k">return</span> <span class="n">ts</span><span class="o">.</span><span class="n">_phase_statuses</span> <span class="c1"># pylint: disable=protected-access</span>

<span class="k">def</span> <span class="nf">_test_helper2</span><span class="p">(</span><span class="n">file_contents</span><span class="p">,</span> <span class="n">wait_for_run</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">check_throughput</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">check_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ignore_namelists</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">ts</span> <span class="o">=</span> <span class="n">TestStatus</span><span class="p">(</span><span class="n">test_dir</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">test_name</span><span class="o">=</span><span class="s2">&quot;ERS.foo.A&quot;</span><span class="p">)</span>
    <span class="n">ts</span><span class="o">.</span><span class="n">_parse_test_status</span><span class="p">(</span><span class="n">file_contents</span><span class="p">)</span> <span class="c1"># pylint: disable=protected-access</span>
    <span class="k">return</span> <span class="n">ts</span><span class="o">.</span><span class="n">get_overall_test_status</span><span class="p">(</span><span class="n">wait_for_run</span><span class="o">=</span><span class="n">wait_for_run</span><span class="p">,</span>
                                      <span class="n">check_throughput</span><span class="o">=</span><span class="n">check_throughput</span><span class="p">,</span>
                                      <span class="n">check_memory</span><span class="o">=</span><span class="n">check_memory</span><span class="p">,</span>
                                      <span class="n">ignore_namelists</span><span class="o">=</span><span class="n">ignore_namelists</span><span class="p">)</span>

<div class="viewcode-block" id="TestStatus"><a class="viewcode-back" href="../../CIME_api/CIME.html#CIME.test_status.TestStatus">[docs]</a><span class="k">class</span> <span class="nc">TestStatus</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">test_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">no_io</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a TestStatus object</span>

<span class="sd">        If test_dir is not specified, it is set to the current working directory</span>

<span class="sd">        no_io is intended only for testing, and should be kept False in</span>
<span class="sd">        production code</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">test_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="k">if</span> <span class="n">test_dir</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">test_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">test_dir</span><span class="p">,</span> <span class="n">TEST_STATUS_FILENAME</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_phase_statuses</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span> <span class="c1"># {name -&gt; (status, comments)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_name</span> <span class="o">=</span> <span class="n">test_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ok_to_modify</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_no_io</span> <span class="o">=</span> <span class="n">no_io</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parse_test_status_file</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">W_OK</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_no_io</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">expect</span><span class="p">(</span><span class="n">test_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Must provide test_name if TestStatus file doesn&#39;t exist&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ok_to_modify</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ok_to_modify</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">phase</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phase_statuses</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">phase</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<div class="viewcode-block" id="TestStatus.get_name"><a class="viewcode-back" href="../../CIME_api/CIME.html#CIME.test_status.TestStatus.get_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_name</span></div>

<div class="viewcode-block" id="TestStatus.set_status"><a class="viewcode-back" href="../../CIME_api/CIME.html#CIME.test_status.TestStatus.set_status">[docs]</a>    <span class="k">def</span> <span class="nf">set_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the status of this test by changing the status of given phase to the</span>
<span class="sd">        given status.</span>

<span class="sd">        &gt;&gt;&gt; with TestStatus(test_dir=&quot;/&quot;, test_name=&quot;ERS.foo.A&quot;, no_io=True) as ts:</span>
<span class="sd">        ...     ts.set_status(CREATE_NEWCASE_PHASE, &quot;PASS&quot;)</span>
<span class="sd">        ...     ts.set_status(XML_PHASE, &quot;PASS&quot;)</span>
<span class="sd">        ...     ts.set_status(SETUP_PHASE, &quot;FAIL&quot;)</span>
<span class="sd">        ...     ts.set_status(SETUP_PHASE, &quot;PASS&quot;)</span>
<span class="sd">        ...     ts.set_status(&quot;{}_base_rest&quot;.format(COMPARE_PHASE), &quot;FAIL&quot;)</span>
<span class="sd">        ...     ts.set_status(SHAREDLIB_BUILD_PHASE, &quot;PASS&quot;, comments=&#39;Time=42&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ts._phase_statuses</span>
<span class="sd">        OrderedDict([(&#39;CREATE_NEWCASE&#39;, (&#39;PASS&#39;, &#39;&#39;)), (&#39;XML&#39;, (&#39;PASS&#39;, &#39;&#39;)), (&#39;SETUP&#39;, (&#39;PASS&#39;, &#39;&#39;)), (&#39;SHAREDLIB_BUILD&#39;, (&#39;PASS&#39;, &#39;Time=42&#39;)), (&#39;COMPARE_base_rest&#39;, (&#39;FAIL&#39;, &#39;&#39;)), (&#39;MODEL_BUILD&#39;, (&#39;PEND&#39;, &#39;&#39;))])</span>

<span class="sd">        &gt;&gt;&gt; with TestStatus(test_dir=&quot;/&quot;, test_name=&quot;ERS.foo.A&quot;, no_io=True) as ts:</span>
<span class="sd">        ...     ts.set_status(CREATE_NEWCASE_PHASE, &quot;PASS&quot;)</span>
<span class="sd">        ...     ts.set_status(XML_PHASE, &quot;PASS&quot;)</span>
<span class="sd">        ...     ts.set_status(SETUP_PHASE, &quot;FAIL&quot;)</span>
<span class="sd">        ...     ts.set_status(SETUP_PHASE, &quot;PASS&quot;)</span>
<span class="sd">        ...     ts.set_status(BASELINE_PHASE, &quot;PASS&quot;)</span>
<span class="sd">        ...     ts.set_status(&quot;{}_base_rest&quot;.format(COMPARE_PHASE), &quot;FAIL&quot;)</span>
<span class="sd">        ...     ts.set_status(SHAREDLIB_BUILD_PHASE, &quot;PASS&quot;, comments=&#39;Time=42&#39;)</span>
<span class="sd">        ...     ts.set_status(SETUP_PHASE, &quot;PASS&quot;)</span>
<span class="sd">        &gt;&gt;&gt; ts._phase_statuses</span>
<span class="sd">        OrderedDict([(&#39;CREATE_NEWCASE&#39;, (&#39;PASS&#39;, &#39;&#39;)), (&#39;XML&#39;, (&#39;PASS&#39;, &#39;&#39;)), (&#39;SETUP&#39;, (&#39;PASS&#39;, &#39;&#39;)), (&#39;SHAREDLIB_BUILD&#39;, (&#39;PEND&#39;, &#39;&#39;))])</span>

<span class="sd">        &gt;&gt;&gt; with TestStatus(test_dir=&quot;/&quot;, test_name=&quot;ERS.foo.A&quot;, no_io=True) as ts:</span>
<span class="sd">        ...     ts.set_status(CREATE_NEWCASE_PHASE, &quot;FAIL&quot;)</span>
<span class="sd">        &gt;&gt;&gt; ts._phase_statuses</span>
<span class="sd">        OrderedDict([(&#39;CREATE_NEWCASE&#39;, (&#39;FAIL&#39;, &#39;&#39;))])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">expect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ok_to_modify</span><span class="p">,</span> <span class="s2">&quot;TestStatus not in a modifiable state, use &#39;with&#39; syntax&quot;</span><span class="p">)</span>
        <span class="n">expect</span><span class="p">(</span><span class="n">phase</span> <span class="ow">in</span> <span class="n">ALL_PHASES</span> <span class="ow">or</span> <span class="n">phase</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">COMPARE_PHASE</span><span class="p">),</span>
               <span class="s2">&quot;Invalid phase &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">phase</span><span class="p">))</span>
        <span class="n">expect</span><span class="p">(</span><span class="n">status</span> <span class="ow">in</span> <span class="n">ALL_PHASE_STATUSES</span><span class="p">,</span> <span class="s2">&quot;Invalid status &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">phase</span> <span class="ow">in</span> <span class="n">CORE_PHASES</span> <span class="ow">and</span> <span class="n">phase</span> <span class="o">!=</span> <span class="n">CORE_PHASES</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">previous_core_phase</span> <span class="o">=</span> <span class="n">CORE_PHASES</span><span class="p">[</span><span class="n">CORE_PHASES</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="c1">#TODO: enable check below</span>
            <span class="c1">#expect(previous_core_phase in self._phase_statuses, &quot;Core phase &#39;{}&#39; was skipped&quot;.format(previous_core_phase))</span>

            <span class="k">if</span> <span class="n">previous_core_phase</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phase_statuses</span><span class="p">:</span>
                <span class="n">expect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_phase_statuses</span><span class="p">[</span><span class="n">previous_core_phase</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">TEST_PASS_STATUS</span><span class="p">,</span>
                       <span class="s2">&quot;Cannot move past core phase &#39;</span><span class="si">{}</span><span class="s2">&#39;, it didn&#39;t pass: &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">previous_core_phase</span><span class="p">))</span>

        <span class="n">reran_phase</span> <span class="o">=</span> <span class="p">(</span><span class="n">phase</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phase_statuses</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phase_statuses</span><span class="p">[</span><span class="n">phase</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">TEST_PEND_STATUS</span> <span class="ow">and</span> <span class="n">phase</span> <span class="ow">in</span> <span class="n">CORE_PHASES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">reran_phase</span><span class="p">:</span>
            <span class="c1"># All subsequent phases are invalidated</span>
            <span class="n">phase_idx</span> <span class="o">=</span> <span class="n">ALL_PHASES</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">subsequent_phase</span> <span class="ow">in</span> <span class="n">ALL_PHASES</span><span class="p">[</span><span class="n">phase_idx</span><span class="o">+</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="k">if</span> <span class="n">subsequent_phase</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phase_statuses</span><span class="p">:</span>
                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phase_statuses</span><span class="p">[</span><span class="n">subsequent_phase</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">subsequent_phase</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">COMPARE_PHASE</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">stored_phase</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_phase_statuses</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                        <span class="k">if</span> <span class="n">stored_phase</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">COMPARE_PHASE</span><span class="p">):</span>
                            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phase_statuses</span><span class="p">[</span><span class="n">stored_phase</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_phase_statuses</span><span class="p">[</span><span class="n">phase</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">comments</span><span class="p">)</span> <span class="c1"># Can overwrite old phase info</span>

        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="n">TEST_PASS_STATUS</span> <span class="ow">and</span> <span class="n">phase</span> <span class="ow">in</span> <span class="n">CORE_PHASES</span> <span class="ow">and</span> <span class="n">phase</span> <span class="o">!=</span> <span class="n">CORE_PHASES</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">next_core_phase</span> <span class="o">=</span> <span class="n">CORE_PHASES</span><span class="p">[</span><span class="n">CORE_PHASES</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_phase_statuses</span><span class="p">[</span><span class="n">next_core_phase</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">TEST_PEND_STATUS</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestStatus.get_status"><a class="viewcode-back" href="../../CIME_api/CIME.html#CIME.test_status.TestStatus.get_status">[docs]</a>    <span class="k">def</span> <span class="nf">get_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phase</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phase_statuses</span><span class="p">[</span><span class="n">phase</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">phase</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phase_statuses</span> <span class="k">else</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="TestStatus.get_comment"><a class="viewcode-back" href="../../CIME_api/CIME.html#CIME.test_status.TestStatus.get_comment">[docs]</a>    <span class="k">def</span> <span class="nf">get_comment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phase</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phase_statuses</span><span class="p">[</span><span class="n">phase</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">phase</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phase_statuses</span> <span class="k">else</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="TestStatus.phase_statuses_dump"><a class="viewcode-back" href="../../CIME_api/CIME.html#CIME.test_status.TestStatus.phase_statuses_dump">[docs]</a>    <span class="k">def</span> <span class="nf">phase_statuses_dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            prefix: string printed at the start of each line</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phase_statuses</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">phase</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phase_statuses</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">status</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="n">data</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">comments</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">{}{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_name</span><span class="p">,</span> <span class="n">phase</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">{}{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_name</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">comments</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="TestStatus.flush"><a class="viewcode-back" href="../../CIME_api/CIME.html#CIME.test_status.TestStatus.flush">[docs]</a>    <span class="k">def</span> <span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phase_statuses</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_no_io</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
                <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_statuses_dump</span><span class="p">())</span></div>

    <span class="k">def</span> <span class="nf">_parse_test_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_contents</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &gt;&gt;&gt; contents = &#39;&#39;&#39;</span>
<span class="sd">        ... PASS ERS.foo.A CREATE_NEWCASE</span>
<span class="sd">        ... PASS ERS.foo.A XML</span>
<span class="sd">        ... FAIL ERS.foo.A SETUP</span>
<span class="sd">        ... PASS ERS.foo.A COMPARE_base_rest</span>
<span class="sd">        ... PASS ERS.foo.A SHAREDLIB_BUILD Time=42</span>
<span class="sd">        ... &#39;&#39;&#39;</span>
<span class="sd">        &gt;&gt;&gt; _test_helper1(contents)</span>
<span class="sd">        OrderedDict([(&#39;CREATE_NEWCASE&#39;, (&#39;PASS&#39;, &#39;&#39;)), (&#39;XML&#39;, (&#39;PASS&#39;, &#39;&#39;)), (&#39;SETUP&#39;, (&#39;FAIL&#39;, &#39;&#39;)), (&#39;COMPARE_base_rest&#39;, (&#39;PASS&#39;, &#39;&#39;)), (&#39;SHAREDLIB_BUILD&#39;, (&#39;PASS&#39;, &#39;Time=42&#39;))])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file_contents</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">line</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">pass</span> <span class="c1"># skip blank lines</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">status</span><span class="p">,</span> <span class="n">curr_test_name</span><span class="p">,</span> <span class="n">phase</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_test_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_test_name</span> <span class="o">=</span> <span class="n">curr_test_name</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">expect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_test_name</span> <span class="o">==</span> <span class="n">curr_test_name</span><span class="p">,</span>
                           <span class="s2">&quot;inconsistent test name in parse_test_status: &#39;</span><span class="si">{}</span><span class="s2">&#39; != &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_test_name</span><span class="p">,</span> <span class="n">curr_test_name</span><span class="p">))</span>

                <span class="n">expect</span><span class="p">(</span><span class="n">status</span> <span class="ow">in</span> <span class="n">ALL_PHASE_STATUSES</span><span class="p">,</span>
                       <span class="s2">&quot;Unexpected status &#39;</span><span class="si">{}</span><span class="s2">&#39; in parse_test_status for test &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_name</span><span class="p">))</span>
                <span class="n">expect</span><span class="p">(</span><span class="n">phase</span> <span class="ow">in</span> <span class="n">ALL_PHASES</span> <span class="ow">or</span> <span class="n">phase</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">COMPARE_PHASE</span><span class="p">),</span>
                       <span class="s2">&quot;phase &#39;</span><span class="si">{}</span><span class="s2">&#39; not expected in parse_test_status for test &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">phase</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_name</span><span class="p">))</span>
                <span class="n">expect</span><span class="p">(</span><span class="n">phase</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phase_statuses</span><span class="p">,</span>
                       <span class="s2">&quot;Should not have seen multiple instances of phase &#39;</span><span class="si">{}</span><span class="s2">&#39; for test &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">phase</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_name</span><span class="p">))</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_phase_statuses</span><span class="p">[</span><span class="n">phase</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">3</span><span class="p">:]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;In TestStatus file for test &#39;</span><span class="si">{}</span><span class="s2">&#39;, line &#39;</span><span class="si">{}</span><span class="s2">&#39; not in expected format&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_test_name</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_parse_test_status_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parse_test_status</span><span class="p">(</span><span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

<div class="viewcode-block" id="TestStatus.get_overall_test_status"><a class="viewcode-back" href="../../CIME_api/CIME.html#CIME.test_status.TestStatus.get_overall_test_status">[docs]</a>    <span class="k">def</span> <span class="nf">get_overall_test_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wait_for_run</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">check_throughput</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">check_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ignore_namelists</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ignore_memleak</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given the current phases and statuses, produce a single results for this test. Preference</span>
<span class="sd">        is given to PEND since we don&#39;t want to stop waiting for a test</span>
<span class="sd">        that hasn&#39;t finished. Namelist diffs are given the lowest precedence.</span>

<span class="sd">        &gt;&gt;&gt; _test_helper2(&#39;PASS ERS.foo.A RUN&#39;)</span>
<span class="sd">        &#39;PASS&#39;</span>
<span class="sd">        &gt;&gt;&gt; _test_helper2(&#39;PASS ERS.foo.A SHAREDLIB_BUILD\nPEND ERS.foo.A RUN&#39;)</span>
<span class="sd">        &#39;PEND&#39;</span>
<span class="sd">        &gt;&gt;&gt; _test_helper2(&#39;FAIL ERS.foo.A MODEL_BUILD\nPEND ERS.foo.A RUN&#39;)</span>
<span class="sd">        &#39;PEND&#39;</span>
<span class="sd">        &gt;&gt;&gt; _test_helper2(&#39;PASS ERS.foo.A MODEL_BUILD\nPASS ERS.foo.A RUN&#39;)</span>
<span class="sd">        &#39;PASS&#39;</span>
<span class="sd">        &gt;&gt;&gt; _test_helper2(&#39;PASS ERS.foo.A RUN\nFAIL ERS.foo.A TPUTCOMP&#39;)</span>
<span class="sd">        &#39;PASS&#39;</span>
<span class="sd">        &gt;&gt;&gt; _test_helper2(&#39;PASS ERS.foo.A RUN\nFAIL ERS.foo.A TPUTCOMP&#39;, check_throughput=True)</span>
<span class="sd">        &#39;FAIL&#39;</span>
<span class="sd">        &gt;&gt;&gt; _test_helper2(&#39;PASS ERS.foo.A RUN\nFAIL ERS.foo.A NLCOMP&#39;)</span>
<span class="sd">        &#39;NLFAIL&#39;</span>
<span class="sd">        &gt;&gt;&gt; _test_helper2(&#39;PASS ERS.foo.A RUN\nFAIL ERS.foo.A MEMCOMP&#39;)</span>
<span class="sd">        &#39;PASS&#39;</span>
<span class="sd">        &gt;&gt;&gt; _test_helper2(&#39;PASS ERS.foo.A RUN\nFAIL ERS.foo.A NLCOMP&#39;, ignore_namelists=True)</span>
<span class="sd">        &#39;PASS&#39;</span>
<span class="sd">        &gt;&gt;&gt; _test_helper2(&#39;PASS ERS.foo.A COMPARE_1\nFAIL ERS.foo.A NLCOMP\nFAIL ERS.foo.A COMPARE_2\nPASS ERS.foo.A RUN&#39;)</span>
<span class="sd">        &#39;FAIL&#39;</span>
<span class="sd">        &gt;&gt;&gt; _test_helper2(&#39;FAIL ERS.foo.A BASELINE\nFAIL ERS.foo.A NLCOMP\nPASS ERS.foo.A COMPARE_2\nPASS ERS.foo.A RUN&#39;)</span>
<span class="sd">        &#39;DIFF&#39;</span>
<span class="sd">        &gt;&gt;&gt; _test_helper2(&#39;FAIL ERS.foo.A BASELINE\nFAIL ERS.foo.A NLCOMP\nFAIL ERS.foo.A COMPARE_2\nPASS ERS.foo.A RUN&#39;)</span>
<span class="sd">        &#39;FAIL&#39;</span>
<span class="sd">        &gt;&gt;&gt; _test_helper2(&#39;PASS ERS.foo.A MODEL_BUILD&#39;)</span>
<span class="sd">        &#39;PASS&#39;</span>
<span class="sd">        &gt;&gt;&gt; _test_helper2(&#39;PASS ERS.foo.A MODEL_BUILD&#39;, wait_for_run=True)</span>
<span class="sd">        &#39;PEND&#39;</span>
<span class="sd">        &gt;&gt;&gt; _test_helper2(&#39;FAIL ERS.foo.A MODEL_BUILD&#39;, wait_for_run=True)</span>
<span class="sd">        &#39;FAIL&#39;</span>
<span class="sd">        &gt;&gt;&gt; _test_helper2(&#39;PASS ERS.foo.A MODEL_BUILD\nPEND ERS.foo.A RUN&#39;, wait_for_run=True)</span>
<span class="sd">        &#39;PEND&#39;</span>
<span class="sd">        &gt;&gt;&gt; _test_helper2(&#39;PASS ERS.foo.A MODEL_BUILD\nFAIL ERS.foo.A RUN&#39;, wait_for_run=True)</span>
<span class="sd">        &#39;FAIL&#39;</span>
<span class="sd">        &gt;&gt;&gt; _test_helper2(&#39;PASS ERS.foo.A MODEL_BUILD\nPASS ERS.foo.A RUN&#39;, wait_for_run=True)</span>
<span class="sd">        &#39;PASS&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rv</span> <span class="o">=</span> <span class="n">TEST_PASS_STATUS</span>
        <span class="n">run_phase_found</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">phase</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phase_statuses</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">phase</span> <span class="o">==</span> <span class="n">RUN_PHASE</span><span class="p">:</span>
                <span class="n">run_phase_found</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">==</span> <span class="n">TEST_PEND_STATUS</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">status</span>

            <span class="k">elif</span> <span class="p">(</span><span class="n">status</span> <span class="o">==</span> <span class="n">TEST_FAIL_STATUS</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="ow">not</span> <span class="n">check_throughput</span> <span class="ow">and</span> <span class="n">phase</span> <span class="o">==</span> <span class="n">THROUGHPUT_PHASE</span><span class="p">)</span> <span class="ow">or</span>
                     <span class="p">(</span><span class="ow">not</span> <span class="n">check_memory</span> <span class="ow">and</span> <span class="n">phase</span> <span class="o">==</span> <span class="n">MEMCOMP_PHASE</span><span class="p">)</span> <span class="ow">or</span>
                     <span class="p">(</span><span class="n">ignore_namelists</span> <span class="ow">and</span> <span class="n">phase</span> <span class="o">==</span> <span class="n">NAMELIST_PHASE</span><span class="p">)</span> <span class="ow">or</span>
                     <span class="p">(</span><span class="n">ignore_memleak</span> <span class="ow">and</span> <span class="n">phase</span> <span class="o">==</span> <span class="n">MEMLEAK_PHASE</span><span class="p">)</span> <span class="p">):</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">phase</span> <span class="o">==</span> <span class="n">NAMELIST_PHASE</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">rv</span> <span class="o">==</span> <span class="n">TEST_PASS_STATUS</span><span class="p">):</span>
                        <span class="n">rv</span> <span class="o">=</span> <span class="n">NAMELIST_FAIL_STATUS</span>

                <span class="k">elif</span> <span class="p">(</span><span class="n">rv</span> <span class="ow">in</span> <span class="p">[</span><span class="n">NAMELIST_FAIL_STATUS</span><span class="p">,</span> <span class="n">TEST_PASS_STATUS</span><span class="p">]</span> <span class="ow">and</span> <span class="n">phase</span> <span class="o">==</span> <span class="n">BASELINE_PHASE</span><span class="p">):</span>
                    <span class="n">rv</span> <span class="o">=</span> <span class="n">TEST_DIFF_STATUS</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">rv</span> <span class="o">=</span> <span class="n">TEST_FAIL_STATUS</span>

        <span class="c1"># The test did not fail but the RUN phase was not found, so if the user requested</span>
        <span class="c1"># that we wait for the RUN phase, then the test must still be considered pending.</span>
        <span class="k">if</span> <span class="n">rv</span> <span class="o">!=</span> <span class="n">TEST_FAIL_STATUS</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">run_phase_found</span> <span class="ow">and</span> <span class="n">wait_for_run</span><span class="p">:</span>
            <span class="n">rv</span> <span class="o">=</span> <span class="n">TEST_PEND_STATUS</span>

        <span class="k">return</span> <span class="n">rv</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">CIME 5.6 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, U.S. National Science Foundation and U.S. Department of Energy.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.3.
    </div>
  </body>
</html>