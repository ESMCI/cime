

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>System Testing &mdash; CIME master documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="_static/sphinx-toolbox-code.css" />
      <link rel="stylesheet" type="text/css" href="_static/custom.css?v=3d7e66fe" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=30d551ce"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Tools" href="tools/index.html" />
    <link rel="prev" title="Customize CIME" href="ccs/model-configuration/customize-cime.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            CIME
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">For Users</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="ccs/index.html">Case Control System (CCS)</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">System Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="tools/index.html">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">For Developers/Contributors</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contributing-guide.html">Contributing Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CIME</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">System Testing</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/system_testing.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="system-testing">
<span id="system-tests"></span><h1>System Testing<a class="headerlink" href="#system-testing" title="Link to this heading"></a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#overview" id="id2">Overview</a></p></li>
<li><p><a class="reference internal" href="#testing-a-case" id="id3">Testing a Case</a></p>
<ul>
<li><p><a class="reference internal" href="#run-a-individual-tests" id="id4">Run a individual tests</a></p></li>
<li><p><a class="reference internal" href="#run-a-test-suite" id="id5">Run a test suite</a></p>
<ul>
<li><p><a class="reference internal" href="#xml" id="id6">XML</a></p></li>
<li><p><a class="reference internal" href="#python" id="id7">Python</a></p>
<ul>
<li><p><a class="reference internal" href="#format" id="id8">Format</a></p></li>
<li><p><a class="reference internal" href="#example" id="id9">Example</a></p></li>
<li><p><a class="reference internal" href="#listing-the-test-suites" id="id10">Listing the test suites</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#test-name-syntax" id="id11">Test name syntax</a></p>
<ul>
<li><p><a class="reference internal" href="#test-type" id="id12">Test Type</a></p></li>
<li><p><a class="reference internal" href="#modifiers" id="id13">Modifiers</a></p></li>
<li><p><a class="reference internal" href="#test-mods" id="id14">Test Mods</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#testing-process" id="id15">Testing Process</a></p>
<ul>
<li><p><a class="reference internal" href="#output" id="id16">Output</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#baselines" id="id17">Baselines</a></p>
<ul>
<li><p><a class="reference internal" href="#creating-a-baseline" id="id18">Creating a baseline</a></p></li>
<li><p><a class="reference internal" href="#comparing-a-baseline" id="id19">Comparing a baseline</a></p></li>
<li><p><a class="reference internal" href="#managing-baselines" id="id20">Managing baselines</a></p></li>
<li><p><a class="reference internal" href="#performance-baselines" id="id21">Performance baselines</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="overview">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Overview</a><a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">create_test`</span></code> tool is a versatile and powerful utility provided by CIME for automating the creation, setup, building, and execution of system tests. It simplifies the process of running tests by allowing users to specify test configurations through a single command. The tool supports a wide range of test types, modifiers, and options, making it highly customizable to meet various testing needs.</p>
<p>Key features of <code class="docutils literal notranslate"><span class="pre">create_test</span></code> include:</p>
<ul class="simple">
<li><p>Automated creation and setup of test cases.</p></li>
<li><p>Building and running tests with specified configurations.</p></li>
<li><p>Support for multiple test types and modifiers.</p></li>
<li><p>Ability to run individual tests or suites of tests.</p></li>
<li><p>Integration with baseline comparison and performance testing.</p></li>
<li><p>Detailed logging and status reporting for each phase of the test.</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">create_test</span></code> tool is essential for ensuring the reliability and correctness of the model by providing a streamlined and efficient way to conduct comprehensive system tests.</p>
</section>
<section id="testing-a-case">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Testing a Case</a><a class="headerlink" href="#testing-a-case" title="Link to this heading"></a></h2>
<p>To run a system test(s) CIME provides <code class="docutils literal notranslate"><span class="pre">create_test</span></code>. This tool provides much of the same functionality as <code class="docutils literal notranslate"><span class="pre">create_newcase</span></code> allowing to define a non-default compiler, queue, override the output location of the test cases, etc.</p>
<p>CIME has functionality to create baselines fors tests, and compare future runs to track changes in answers.</p>
<p>The tool supports running single, or multiple tests. Multiple tests can be defined by just their test names on the CLI or by providing an XML or Python file.</p>
<section id="run-a-individual-tests">
<span id="system-testing-individual"></span><h3><a class="toc-backref" href="#id4" role="doc-backlink">Run a individual tests</a><a class="headerlink" href="#run-a-individual-tests" title="Link to this heading"></a></h3>
<p>The following will run a single test case.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./scripts/create_test<span class="w"> </span>&lt;testname&gt;
</pre></div>
</div>
<p>The following will run multiple test cases.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./scripts/create_test<span class="w"> </span>&lt;testname&gt;<span class="w"> </span>&lt;testname&gt;
</pre></div>
</div>
<p>These test names could also be placed a file and run with the follow command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./scripts/create_test<span class="w"> </span>-f<span class="w"> </span>&lt;filename&gt;
</pre></div>
</div>
</section>
<section id="run-a-test-suite">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">Run a test suite</a><a class="headerlink" href="#run-a-test-suite" title="Link to this heading"></a></h3>
<p>The following will run an entire test suite of test cases.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./scripts/create_test<span class="w"> </span>&lt;testsuite&gt;
</pre></div>
</div>
<section id="xml">
<h4><a class="toc-backref" href="#id6" role="doc-backlink">XML</a><a class="headerlink" href="#xml" title="Link to this heading"></a></h4>
<p>A pre-defined suite of test can be run by passing the <code class="docutils literal notranslate"><span class="pre">--xml</span></code> argument to <code class="docutils literal notranslate"><span class="pre">create_test</span></code>.</p>
<p>This argument will cause CIME to load <code class="docutils literal notranslate"><span class="pre">testlist*.xml</span></code> files. As described in <a class="reference external" href="https://github.com/ESCOMP/ctsm/wiki/System-Testing-Guide">https://github.com/ESCOMP/ctsm/wiki/System-Testing-Guide</a>, to determine what pre-defined test suites are available and what tests they contain, you can run <code class="docutils literal notranslate"><span class="pre">./scripts/query_testlists</span></code>.</p>
<p>Test suites are retrieved in create_test via 3 selection attributes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">xml</span><span class="o">-</span><span class="n">category</span> <span class="n">your_category</span>   <span class="n">The</span> <span class="n">test</span> <span class="n">category</span><span class="o">.</span>
<span class="o">--</span><span class="n">xml</span><span class="o">-</span><span class="n">machine</span>  <span class="n">your_machine</span>    <span class="n">The</span> <span class="n">machine</span><span class="o">.</span>
<span class="o">--</span><span class="n">xml</span><span class="o">-</span><span class="n">compiler</span> <span class="n">your_compiler</span>   <span class="n">The</span> <span class="n">compiler</span><span class="o">.</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">If none of these 3 are used, the default values are ‘none’.</div>
<div class="line">If any of them are used, the default for the unused options is ‘all’.</div>
<div class="line">Existing values of these attributes can be seen by running <code class="docutils literal notranslate"><span class="pre">query_testlists</span></code></div>
</div>
<p>The search for test names can be restricted to a single test list using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">xml</span><span class="o">-</span><span class="n">testlist</span> <span class="n">your_testlist</span>
</pre></div>
</div>
<p>Omitting this results in searching all testlists listed in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cime</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="p">{</span><span class="n">cesm</span><span class="p">,</span><span class="n">e3sm</span><span class="p">}</span><span class="o">/</span><span class="n">config_files</span><span class="o">.</span><span class="n">xml</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">./scripts/query_testlists</span></code> tool gathers descriptions of the tests and testlists available
in the XML format, the components, and projects.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">--xml-{compiler,machine,category,testlist}</span></code> arguments can be used
as in create_test (above) to focus the search.
The ‘category’ descriptor of a test can be used to run a group of associated tests at the same time.
The available categories, with the tests they encompass, can be listed by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">query_testlists</span> <span class="o">--</span><span class="n">define</span><span class="o">-</span><span class="n">testtypes</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">--show-options</span></code> argument does the same, but displays the ‘options’ defined for the tests,
such as queue, walltime, etc.</p>
<p>Adding a test requires first deciding which compset will be tested
and then finding the appropriate <code class="docutils literal notranslate"><span class="pre">testlist_$component.xml</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>components/$component/cime_config/testdefs/
   testlist_$component.xml
   testmods_dirs/$component/{TESTMODS1,TESTMODS2,...}
cime_config/
   testlist_allactive.xml
   testmods_dirs/allactive/{defaultio,...}
</pre></div>
</div>
<p>You can optionally add testmods for that test in the testmods_dirs.
Testlists and testmods live in different paths for cime, drv, and components.</p>
<p>If this test will only be run as a single test, you can now create a test name
and follow the <a class="reference internal" href="#system-testing-individual">individual</a> test instructions for create_test.</p>
</section>
<section id="python">
<h4><a class="toc-backref" href="#id7" role="doc-backlink">Python</a><a class="headerlink" href="#python" title="Link to this heading"></a></h4>
<p>A suite of tests can also be provided with a python file <code class="docutils literal notranslate"><span class="pre">tests.py</span></code> placed in <code class="docutils literal notranslate"><span class="pre">$MODEL/cime_config</span></code>.</p>
<p>To run a test suite called e3sm_developer:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">create_test</span> <span class="n">e3sm_developer</span>
</pre></div>
</div>
<p>One can exclude a specific test from a suite:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">create_test</span> <span class="n">e3sm_developer</span> <span class="o">^</span><span class="n">SMS</span><span class="o">.</span><span class="n">f19_f19</span><span class="o">.</span><span class="n">A</span>
</pre></div>
</div>
<p>See <code class="docutils literal notranslate"><span class="pre">./scripts/create_test</span> <span class="pre">-h</span></code> for the full list of options.</p>
<section id="format">
<h5><a class="toc-backref" href="#id8" role="doc-backlink">Format</a><a class="headerlink" href="#format" title="Link to this heading"></a></h5>
<p>The following defines the format of <code class="docutils literal notranslate"><span class="pre">tests.py</span></code>. The only variable that needs to be defined is <code class="docutils literal notranslate"><span class="pre">_TESTS</span></code> which needs to be a dictionary. Each key is the name of a test suite and the value is a dictionary. See below for the description of possible values.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Key</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>inherit</p></td>
<td><p>A tuple, list, or str of other suites.</p></td>
</tr>
<tr class="row-odd"><td><p>time</p></td>
<td><p>Upper limit for test time. Format is <code class="docutils literal notranslate"><span class="pre">HH:MM:SS</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p>share</p></td>
<td><p>Should cases share a build. Value is <code class="docutils literal notranslate"><span class="pre">true</span></code> or <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p>tests</p></td>
<td><p>A tuple, list, or str of <code class="docutils literal notranslate"><span class="pre">&lt;testname&gt;</span></code>, see the format below.</p></td>
</tr>
</tbody>
</table>
<p>The format for <code class="docutils literal notranslate"><span class="pre">&lt;testname&gt;</span></code> is <code class="docutils literal notranslate"><span class="pre">TESTTYPE.GRID.COMPSET[.TESTMOD]</span></code>. The <code class="docutils literal notranslate"><span class="pre">TESTMOD</span></code> is optional.</p>
</section>
<section id="example">
<h5><a class="toc-backref" href="#id9" role="doc-backlink">Example</a><a class="headerlink" href="#example" title="Link to this heading"></a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">_TESTS</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">&quot;suite_a&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;inherit&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;suite_b&quot;</span><span class="p">),</span>
    <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;0:45:00&quot;</span><span class="p">,</span>
    <span class="s2">&quot;share&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tests&quot;</span><span class="p">:</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="n">testname</span><span class="o">&gt;</span>
    <span class="p">)</span>
  <span class="p">},</span>
  <span class="s2">&quot;suite_b&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;02:00:00&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tests&quot;</span><span class="p">:</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="n">testname</span><span class="o">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="listing-the-test-suites">
<h5><a class="toc-backref" href="#id10" role="doc-backlink">Listing the test suites</a><a class="headerlink" href="#listing-the-test-suites" title="Link to this heading"></a></h5>
<p>The following tool will list the tests.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">CIME</span><span class="o">/</span><span class="n">Tools</span><span class="o">/</span><span class="n">list_e3sm_tests</span> <span class="o">-</span><span class="n">t</span> <span class="n">compsets</span> <span class="n">e3sm_developer</span>
</pre></div>
</div>
<p>Will list all the compsets tested in the <code class="docutils literal notranslate"><span class="pre">e3sm_developer</span></code> test suite.</p>
</section>
</section>
</section>
</section>
<section id="test-name-syntax">
<h2><a class="toc-backref" href="#id11" role="doc-backlink">Test name syntax</a><a class="headerlink" href="#test-name-syntax" title="Link to this heading"></a></h2>
<p>A test name is defined by the following format, where anything enclosed in <code class="docutils literal notranslate"><span class="pre">[]</span></code> is option.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TESTTYPE</span><span class="p">[</span><span class="n">_MODIFIERS</span><span class="p">]</span><span class="o">.</span><span class="n">GRID</span><span class="o">.</span><span class="n">COMPSET</span><span class="p">[</span><span class="o">.</span><span class="n">MACHINE_COMPILER</span><span class="p">][</span><span class="o">.</span><span class="n">GROUP</span><span class="o">-</span><span class="n">TESTMODS</span><span class="p">]</span>
</pre></div>
</div>
<p>The following is a minimal example where <code class="docutils literal notranslate"><span class="pre">ERP</span></code> is the <code class="docutils literal notranslate"><span class="pre">TESTTYPE</span></code>, <code class="docutils literal notranslate"><span class="pre">ne4pg2_oQU480</span></code> is the <code class="docutils literal notranslate"><span class="pre">GRID</span></code> and <code class="docutils literal notranslate"><span class="pre">F2010</span></code> is the <code class="docutils literal notranslate"><span class="pre">COMPSET</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ERP</span><span class="o">.</span><span class="n">ne4pg2_oQU480</span><span class="o">.</span><span class="n">F2010</span>
</pre></div>
</div>
<p>Below is a breakdown of the different parts of the <code class="docutils literal notranslate"><span class="pre">testname</span></code> syntax.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Syntax Part</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>TESTTYPE</p></td>
<td><p>The type of test e.g. SMS, ERS, etc. See <code class="docutils literal notranslate"><span class="pre">config_tests.xml</span></code> for options.</p></td>
</tr>
<tr class="row-odd"><td><p>MODIFIER</p></td>
<td><p>Changes to the default settings for the test type.</p></td>
</tr>
<tr class="row-even"><td><p>GRID</p></td>
<td><p>The model grid, can be longname or alias.</p></td>
</tr>
<tr class="row-odd"><td><p>COMPSET</p></td>
<td><p>The compset, can be a longname but usually a compset alias.</p></td>
</tr>
<tr class="row-even"><td><p>MACHINE</p></td>
<td><p>This is optional; if this value is not supplied, <code class="docutils literal notranslate"><span class="pre">create_test</span></code> will probe the underlying machine.</p></td>
</tr>
<tr class="row-odd"><td><p>COMPILER</p></td>
<td><p>If this value is not supplied, use the default compiler for MACHINE.</p></td>
</tr>
<tr class="row-even"><td><p>GROUP-TESTMODS</p></td>
<td><p>This is optional. This points to a directory with testmod.</p></td>
</tr>
</tbody>
</table>
<section id="test-type">
<h3><a class="toc-backref" href="#id12" role="doc-backlink">Test Type</a><a class="headerlink" href="#test-type" title="Link to this heading"></a></h3>
<p>The test type defines the behavior that the case will be tested against. For example a test may exercise a models ability to restart, invariance with MPI task count, or short term archiving.</p>
<p>CIME provides some tests out of the box, but a model may add additional test types using the <code class="docutils literal notranslate"><span class="pre">SYSTEM_TEST_DIR</span></code> variable or adding them to <code class="docutils literal notranslate"><span class="pre">cime_config/SystemTests</span></code> in any component.</p>
<p>The following test types are provided by CIME.</p>
<table class="docutils align-default" id="system-testings-types">
<thead>
<tr class="row-odd"><th class="head"><p>TESTTYPE</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ERS</p></td>
<td><dl>
<dt>Exact restart from startup (default 6 days + 5 days)</dt><dd><div class="line-block">
<div class="line">Do an 11-day initial test - write a restart at day 6.    (file suffix: base)</div>
<div class="line">Do a 5-day restart test, starting from restart at day 6. (file suffix: rest)</div>
<div class="line">Compare component history files ‘.base’ and ‘.rest’ at day 11 with cprnc</div>
<div class="line-block">
<div class="line">PASS if they are identical.</div>
</div>
</div>
</dd>
</dl>
</td>
</tr>
<tr class="row-odd"><td><p>ERT</p></td>
<td><p>Longer version of ERS. Exact restart from startup, default 2 months + 1 month (ERS with info DBUG = 1).</p></td>
</tr>
<tr class="row-even"><td><p>IRT</p></td>
<td><p>Exact restart from startup, (default 4 days + 7 days) with restart from interim file.</p></td>
</tr>
<tr class="row-odd"><td><p>ERIO</p></td>
<td><p>Exact restart from startup with different IO file types, (default 6 days + 5 days).</p></td>
</tr>
<tr class="row-even"><td><p>ERR</p></td>
<td><p>Exact restart from startup with resubmit, (default 4 days + 3 days).</p></td>
</tr>
<tr class="row-odd"><td><p>ERRI</p></td>
<td><p>Exact restart from startup with resubmit, (default 4 days + 3 days). Tests incomplete logs option for st_archive.</p></td>
</tr>
<tr class="row-even"><td><p>ERI</p></td>
<td><dl class="simple">
<dt>Hybrid/branch/exact restart test, default (by default STOP_N is 22 days)</dt><dd><dl class="simple">
<dt>ref1case</dt><dd><p>Do an initial run for 3 days writing restarts at day 3.
ref1case is a clone of the main case.
Short term archiving is on.</p>
</dd>
<dt>ref2case (Suffix hybrid)</dt><dd><p>Do a hybrid run for default 19 days running with ref1 restarts from day 3,
and writing restarts at day 10.
ref2case is a clone of the main case.
Short term archiving is on.</p>
</dd>
<dt>case</dt><dd><p>Do a branch run, starting from restarts written in ref2case,
for 9 days and writing restarts at day 5.
Short term archiving is off.</p>
</dd>
<dt>case (Suffix base)</dt><dd><p>Do a restart run from the branch run restarts for 4 days.
Compare component history files ‘.base’ and ‘.hybrid’ at day 19.
Short term archiving is off.</p>
</dd>
</dl>
</dd>
</dl>
</td>
</tr>
<tr class="row-odd"><td><p>ERP</p></td>
<td><dl class="simple">
<dt>PES counts hybrid (OPENMP/MPI) restart bit-for-bit test from startup, (default 6 days + 5 days).</dt><dd><p>Initial PES set up out of the box
Do an 11-day initial test - write a restart at day 6.     (file suffix base)
Half the number of tasks and threads for each component.
Do a 5-day restart test starting from restart at day 6. (file suffix rest)
Compare component history files ‘.base’ and ‘.rest’ at day 11.
This is just like an ERS test but the tasks/threading counts are modified on restart.</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-even"><td><p>PEA</p></td>
<td><dl class="simple">
<dt>Single PE bit-for-bit test (default 5 days)</dt><dd><p>Do an initial run on 1 PE with mpi library.     (file suffix: base)
Do the same run on 1 PE with mpiserial library. (file suffix: mpiserial)
Compare base and mpiserial.</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-odd"><td><p>PEM</p></td>
<td><dl class="simple">
<dt>Modified PE counts for MPI(NTASKS) bit-for-bit test (default 5 days)</dt><dd><p>Do an initial run with default PE layout                                     (file suffix: base)
Do another initial run with modified PE layout (NTASKS_XXX =&gt; NTASKS_XXX/2)  (file suffix: modpes)
Compare base and modpes.</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-even"><td><p>PET</p></td>
<td><dl class="simple">
<dt>Modified threading OPENMP bit-for-bit test (default 5 days)</dt><dd><p>Do an initial run where all components are threaded by default. (file suffix: base)
Do another initial run with NTHRDS=1 for all components.        (file suffix: single_thread)
Compare base and single_thread.</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-odd"><td><p>PFS</p></td>
<td><p>Performance test setup. History and restart output is turned off. (default 20 days)</p></td>
</tr>
<tr class="row-even"><td><p>ICP</p></td>
<td><p>CICE performance test.</p></td>
</tr>
<tr class="row-odd"><td><p>OCP</p></td>
<td><p>POP performance test. (default 10 days)</p></td>
</tr>
<tr class="row-even"><td><p>MCC</p></td>
<td><p>Multi-driver validation vs single-driver (both multi-instance). (default 5 days)</p></td>
</tr>
<tr class="row-odd"><td><p>NCK</p></td>
<td><dl class="simple">
<dt>Multi-instance validation vs single instance - sequential PE for instances (default length)</dt><dd><p>Do an initial run test with NINST 1. (file suffix: base)
Do an initial run test with NINST 2. (file suffix: multiinst for both _0001 and _0002)
Compare base and _0001 and _0002.</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-even"><td><p>REP</p></td>
<td><p>Reproducibility: Two identical initial runs are bit-for-bit. (default 5 days)</p></td>
</tr>
<tr class="row-odd"><td><p>SBN</p></td>
<td><p>Smoke build-namelist test (just run preview_namelist and check_input_data).</p></td>
</tr>
<tr class="row-even"><td><p>SMS</p></td>
<td><dl class="simple">
<dt>Smoke test (default 5 days)</dt><dd><p>Do a 5-day initial test that runs to completion without error. (file suffix: base)</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-odd"><td><p>SEQ</p></td>
<td><dl class="simple">
<dt>Different sequencing bit-for-bit test. (default 10 days)</dt><dd><p>Do an initial run test with out-of-box PE-layout. (file suffix: base)
Do a second run where all root pes are at pe-0.   (file suffix: seq)
Compare base and seq.</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-even"><td><p>DAE</p></td>
<td><p>Data assimilation test, default 1 day, two DA cycles, no data modification.</p></td>
</tr>
<tr class="row-odd"><td><p>PRE</p></td>
<td><dl class="simple">
<dt>Pause-resume test: by default a bit-for-bit test of pause-resume cycling.</dt><dd><p>Default 5 hours, five pause/resume cycles, no data modification.</p>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
<p>The tests run for a default length indicated above, will use default pelayouts for the case
on the machine the test runs on and its default coupler and MPI library. It is possible to modify
elements of the test through a test type modifier.</p>
</section>
<section id="modifiers">
<h3><a class="toc-backref" href="#id13" role="doc-backlink">Modifiers</a><a class="headerlink" href="#modifiers" title="Link to this heading"></a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>MODIFIERS</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>_C#</p></td>
<td><p>Set number of instances to # and use the multi driver (can’t use with _N).</p></td>
</tr>
<tr class="row-odd"><td><p>_cG</p></td>
<td><p>CALENDAR set to “GREGORIAN”.</p></td>
</tr>
<tr class="row-even"><td><p>_D</p></td>
<td><p>XML variable DEBUG set to “TRUE”.</p></td>
</tr>
<tr class="row-odd"><td><p>_I</p></td>
<td><p>Marker to distinguish tests with the same name - ignored.</p></td>
</tr>
<tr class="row-even"><td><p>_Lo#</p></td>
<td><dl>
<dt>Run length set by o (STOP_OPTION) and # (STOP_N).</dt><dd><div class="line-block">
<div class="line">o = {“y”:”nyears”, “m”:”nmonths”,  “d”:”ndays”,</div>
<div class="line-block">
<div class="line">“h”:”nhours”, “s”:”nseconds”, “n”:”nsteps”}</div>
</div>
</div>
</dd>
</dl>
</td>
</tr>
<tr class="row-odd"><td><p>_Mx</p></td>
<td><p>Set MPI library to x.</p></td>
</tr>
<tr class="row-even"><td><p>_N#</p></td>
<td><p>Set number of instances to # and use a single driver (can’t use with _C).</p></td>
</tr>
<tr class="row-odd"><td><p>_Px</p></td>
<td><p>Set create_newcase’s <code class="docutils literal notranslate"><span class="pre">--pecount</span></code> to x, which is usually N (tasks) or NxM (tasks x threads per task).</p></td>
</tr>
<tr class="row-even"><td><p>_R</p></td>
<td><p>For testing in PTS_MODE or Single Column Model (SCM) mode.
For PTS_MODE, compile with mpi-serial.</p></td>
</tr>
<tr class="row-odd"><td><p>_Vx</p></td>
<td><dl>
<dt>Set driver to x.</dt><dd><div class="line-block">
<div class="line"><br /></div>
</div>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
<p>For example, this will run the ERP test with debugging turned on during compilation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">scripts</span><span class="o">/</span><span class="n">create_test</span> <span class="n">ERP_D</span><span class="o">.</span><span class="n">ne4pg2_oQU480</span><span class="o">.</span><span class="n">F2010</span>
</pre></div>
</div>
<p>This will run the ERP test for 3 days instead of the default 11 days:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">scripts</span><span class="o">/</span><span class="n">create_test</span> <span class="n">ERP_Ld3</span><span class="o">.</span><span class="n">ne4pg2_oQU480</span><span class="o">.</span><span class="n">F2010</span>
</pre></div>
</div>
<p>You can combine test type modifiers:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">scripts</span><span class="o">/</span><span class="n">create_test</span> <span class="n">ERP_D_Ld3</span><span class="o">.</span><span class="n">ne4pg2_oQU480</span><span class="o">.</span><span class="n">F2010</span>
</pre></div>
</div>
</section>
<section id="test-mods">
<h3><a class="toc-backref" href="#id14" role="doc-backlink">Test Mods</a><a class="headerlink" href="#test-mods" title="Link to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">create_test</span></code> tool works with out-of-the-box compsets and grids.
Sometimes you may want to run a test with modifications to a namelist or other setting without creating an entire compset. CIME provides the testmods capability for this situation.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">GROUP-TESTMODS</span></code> string is at the end of the full testname (including machine and compiler).</p>
<p>The syntax for <code class="docutils literal notranslate"><span class="pre">GROUP-TESTMODS</span></code> is as follows.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Syntax part</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>GROUP</p></td>
<td><p>Name of the directory relative to <code class="docutils literal notranslate"><span class="pre">TESTS_MODS_DIR</span></code> that contains <code class="docutils literal notranslate"><span class="pre">TESTMODS</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p>TESTMODS</p></td>
<td><p>Name of the directory under <code class="docutils literal notranslate"><span class="pre">GROUP</span></code> that contains any combination of <cite>user_nl_*</cite>, <cite>shell_commands</cite>, <cite>user_mods</cite>, or <cite>params.py</cite>.</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A test mod can contain any combination of <code class="docutils literal notranslate"><span class="pre">user_nl_*</span></code>, <code class="docutils literal notranslate"><span class="pre">shell_commands</span></code>, <code class="docutils literal notranslate"><span class="pre">user_mods</span></code>, or <code class="docutils literal notranslate"><span class="pre">params.py</span></code>.</p>
</div>
<p>For example, the <code class="docutils literal notranslate"><span class="pre">ERP</span></code> test for an E3SM <code class="docutils literal notranslate"><span class="pre">F-case</span></code> can be modified to use a different radiation scheme by using <code class="docutils literal notranslate"><span class="pre">eam-rrtmgp</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ERP_D_Ld3</span><span class="o">.</span><span class="n">ne4pg2_oQU480</span><span class="o">.</span><span class="n">F2010</span><span class="o">.</span><span class="n">pm</span><span class="o">-</span><span class="n">cpu_intel</span><span class="o">.</span><span class="n">eam</span><span class="o">-</span><span class="n">rrtmgp</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">TESTS_MODS_DIR</span></code> was set to <code class="docutils literal notranslate"><span class="pre">$E3SM/components/eam/cime_config/testdefs/testmods_dirs</span></code> then the
directory containing the testmods would be <code class="docutils literal notranslate"><span class="pre">$E3SM/components/eam/cime_config/testdefs/testmods_dirs/eam/rrtmpg</span></code>.</p>
<p>In this directory, you’d find a <cite>shell_commands`</cite> file containing the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="o">./</span><span class="n">xmlchange</span> <span class="o">--</span><span class="n">append</span> <span class="n">CAM_CONFIG_OPTS</span><span class="o">=</span><span class="s1">&#39;-rad rrtmgp&#39;</span>
</pre></div>
</div>
<p>These commands are applied after the testcase is created and case.setup is called.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Do not use ‘-’ in the testmods directory name because it has a special meaning to <code class="docutils literal notranslate"><span class="pre">create_test</span></code>.</p>
</div>
</section>
</section>
<section id="testing-process">
<h2><a class="toc-backref" href="#id15" role="doc-backlink">Testing Process</a><a class="headerlink" href="#testing-process" title="Link to this heading"></a></h2>
<p>Each test run by <code class="docutils literal notranslate"><span class="pre">create_test</span></code> includes the following mandatory steps:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Phase</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>CREATE_NEWCASE</p></td>
<td><p>Creates the case directory (case.create_newcase)</p></td>
</tr>
<tr class="row-odd"><td><p>XML</p></td>
<td><p>XML changes to case based on test settings (xmlchange)</p></td>
</tr>
<tr class="row-even"><td><p>SETUP</p></td>
<td><p>Setup case (case.setup)</p></td>
</tr>
<tr class="row-odd"><td><p>SHAREDLIB_BUILD</p></td>
<td><p>Build sharedlibs (case.build)</p></td>
</tr>
<tr class="row-even"><td><p>MODEL_BUILD</p></td>
<td><p>Build model (case.build)</p></td>
</tr>
<tr class="row-odd"><td><p>SUBMIT</p></td>
<td><p>Submit test (case.submit)</p></td>
</tr>
<tr class="row-even"><td><p>RUN</p></td>
<td><p>Run test</p></td>
</tr>
</tbody>
</table>
<p>And the following optional phases:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Phase</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>NLCOMP</p></td>
<td><p>Compare namelists against baseline</p></td>
</tr>
<tr class="row-odd"><td><p>THROUGHPUT</p></td>
<td><p>Compare throughput against baseline</p></td>
</tr>
<tr class="row-even"><td><p>MEMCOMP</p></td>
<td><p>Compare memory usage against baseline</p></td>
</tr>
<tr class="row-odd"><td><p>MEMLEAK</p></td>
<td><p>Check for memory leaks</p></td>
</tr>
<tr class="row-even"><td><p>COMPARE</p></td>
<td><p>Used to track test-specific comparisons, for example, an ERS test would have a COMPARE_base_rest phase representing the check that the base result matched the restart result.</p></td>
</tr>
<tr class="row-odd"><td><p>GENERATE</p></td>
<td><p>Generate baseline results</p></td>
</tr>
<tr class="row-even"><td><p>BASELINE</p></td>
<td><p>Compare results against baselines</p></td>
</tr>
</tbody>
</table>
<p>Each phase within the test may be in one of the following states:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>State</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>PASS</p></td>
<td><p>The phase was executed successfully</p></td>
</tr>
<tr class="row-odd"><td><p>FAIL</p></td>
<td><p>We attempted to execute this phase, but it failed. If this phase is mandatory, no further progress will be made on this test. A detailed explanation of the failure should be in TestStatus.log.</p></td>
</tr>
<tr class="row-even"><td><p>PEND</p></td>
<td><p>This phase will be run or is currently running but not complete</p></td>
</tr>
</tbody>
</table>
<section id="output">
<h3><a class="toc-backref" href="#id16" role="doc-backlink">Output</a><a class="headerlink" href="#output" title="Link to this heading"></a></h3>
<p>Lets look at the output from <code class="docutils literal notranslate"><span class="pre">./scripts/create_test</span> <span class="pre">SMS.f19_f19.A</span></code>. Here you can find each phase of the test its status and the time it took to complete.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Creating<span class="w"> </span><span class="nb">test</span><span class="w"> </span>directory<span class="w"> </span>/home/jgfouca/e3sm/scratch/SMS.f19_f19.A.melvin_gnu.20170504_163152_31aahy
RUNNING<span class="w"> </span>TESTS:
<span class="w">  </span>SMS.f19_f19.A.melvin_gnu
Starting<span class="w"> </span>CREATE_NEWCASE<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>SMS.f19_f19.A.melvin_gnu<span class="w"> </span>with<span class="w"> </span><span class="m">1</span><span class="w"> </span>procs
Finished<span class="w"> </span>CREATE_NEWCASE<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>SMS.f19_f19.A.melvin_gnu<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">4</span>.170537<span class="w"> </span>seconds<span class="w"> </span><span class="o">(</span>PASS<span class="o">)</span>
Starting<span class="w"> </span>XML<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>SMS.f19_f19.A.melvin_gnu<span class="w"> </span>with<span class="w"> </span><span class="m">1</span><span class="w"> </span>procs
Finished<span class="w"> </span>XML<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>SMS.f19_f19.A.melvin_gnu<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0</span>.735993<span class="w"> </span>seconds<span class="w"> </span><span class="o">(</span>PASS<span class="o">)</span>
Starting<span class="w"> </span>SETUP<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>SMS.f19_f19.A.melvin_gnu<span class="w"> </span>with<span class="w"> </span><span class="m">1</span><span class="w"> </span>procs
Finished<span class="w"> </span>SETUP<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>SMS.f19_f19.A.melvin_gnu<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">11</span>.544286<span class="w"> </span>seconds<span class="w"> </span><span class="o">(</span>PASS<span class="o">)</span>
Starting<span class="w"> </span>SHAREDLIB_BUILD<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>SMS.f19_f19.A.melvin_gnu<span class="w"> </span>with<span class="w"> </span><span class="m">1</span><span class="w"> </span>procs
Finished<span class="w"> </span>SHAREDLIB_BUILD<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>SMS.f19_f19.A.melvin_gnu<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">82</span>.670667<span class="w"> </span>seconds<span class="w"> </span><span class="o">(</span>PASS<span class="o">)</span>
Starting<span class="w"> </span>MODEL_BUILD<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>SMS.f19_f19.A.melvin_gnu<span class="w"> </span>with<span class="w"> </span><span class="m">4</span><span class="w"> </span>procs
Finished<span class="w"> </span>MODEL_BUILD<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>SMS.f19_f19.A.melvin_gnu<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">18</span>.613263<span class="w"> </span>seconds<span class="w"> </span><span class="o">(</span>PASS<span class="o">)</span>
Starting<span class="w"> </span>RUN<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>SMS.f19_f19.A.melvin_gnu<span class="w"> </span>with<span class="w"> </span><span class="m">64</span><span class="w"> </span>procs
Finished<span class="w"> </span>RUN<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>SMS.f19_f19.A.melvin_gnu<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">35</span>.068546<span class="w"> </span>seconds<span class="w"> </span><span class="o">(</span>PASS<span class="o">)</span>.<span class="w"> </span><span class="o">[</span>COMPLETED<span class="w"> </span><span class="m">1</span><span class="w"> </span>of<span class="w"> </span><span class="m">1</span><span class="o">]</span>
At<span class="w"> </span>test-scheduler<span class="w"> </span>close,<span class="w"> </span>state<span class="w"> </span>is:
PASS<span class="w"> </span>SMS.f19_f19.A.melvin_gnu<span class="w"> </span>RUN
<span class="w">  </span>Case<span class="w"> </span>dir:<span class="w"> </span>/home/jgfouca/e3sm/scratch/SMS.f19_f19.A.melvin_gnu.20170504_163152_31aahy
test-scheduler<span class="w"> </span>took<span class="w"> </span><span class="m">154</span>.780044079<span class="w"> </span>seconds
</pre></div>
</div>
<p>The case is created in <code class="docutils literal notranslate"><span class="pre">$CASEDIR</span></code> which can be seen in the output above. The test status is stored in <code class="docutils literal notranslate"><span class="pre">$CASEDIR/TestStatus</span></code>.
The case directory name format is <code class="docutils literal notranslate"><span class="pre">&lt;testname&gt;.&lt;test-id&gt;</span></code> where <code class="docutils literal notranslate"><span class="pre">&lt;test-id&gt;</span></code> defaults to <code class="docutils literal notranslate"><span class="pre">YYYYMMDD_HHMMSS_hash</span></code>.
This can be overridden with the <code class="docutils literal notranslate"><span class="pre">--test-id</span></code> argument to <code class="docutils literal notranslate"><span class="pre">create_test</span></code>.</p>
<p>The current state of a test is represented in the file <code class="docutils literal notranslate"><span class="pre">$CASEDIR/TestStatus</span></code>. Example output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PASS</span> <span class="n">ERP_D_Ld3</span><span class="o">.</span><span class="n">ne4pg2_oQU480</span><span class="o">.</span><span class="n">F2010</span><span class="o">.</span><span class="n">chrysalis_intel</span> <span class="n">CREATE_NEWCASE</span>
<span class="n">PASS</span> <span class="n">ERP_D_Ld3</span><span class="o">.</span><span class="n">ne4pg2_oQU480</span><span class="o">.</span><span class="n">F2010</span><span class="o">.</span><span class="n">chrysalis_intel</span> <span class="n">XML</span>
<span class="n">PASS</span> <span class="n">ERP_D_Ld3</span><span class="o">.</span><span class="n">ne4pg2_oQU480</span><span class="o">.</span><span class="n">F2010</span><span class="o">.</span><span class="n">chrysalis_intel</span> <span class="n">SETUP</span>
<span class="n">PASS</span> <span class="n">ERP_D_Ld3</span><span class="o">.</span><span class="n">ne4pg2_oQU480</span><span class="o">.</span><span class="n">F2010</span><span class="o">.</span><span class="n">chrysalis_intel</span> <span class="n">SHAREDLIB_BUILD</span> <span class="n">time</span><span class="o">=</span><span class="mi">277</span>
<span class="n">PASS</span> <span class="n">ERP_D_Ld3</span><span class="o">.</span><span class="n">ne4pg2_oQU480</span><span class="o">.</span><span class="n">F2010</span><span class="o">.</span><span class="n">chrysalis_intel</span> <span class="n">MODEL_BUILD</span> <span class="n">time</span><span class="o">=</span><span class="mi">572</span>
<span class="n">PASS</span> <span class="n">ERP_D_Ld3</span><span class="o">.</span><span class="n">ne4pg2_oQU480</span><span class="o">.</span><span class="n">F2010</span><span class="o">.</span><span class="n">chrysalis_intel</span> <span class="n">SUBMIT</span>
<span class="n">PASS</span> <span class="n">ERP_D_Ld3</span><span class="o">.</span><span class="n">ne4pg2_oQU480</span><span class="o">.</span><span class="n">F2010</span><span class="o">.</span><span class="n">chrysalis_intel</span> <span class="n">RUN</span> <span class="n">time</span><span class="o">=</span><span class="mi">208</span>
<span class="n">PASS</span> <span class="n">ERP_D_Ld3</span><span class="o">.</span><span class="n">ne4pg2_oQU480</span><span class="o">.</span><span class="n">F2010</span><span class="o">.</span><span class="n">chrysalis_intel</span> <span class="n">COMPARE_base_rest</span>
<span class="n">PASS</span> <span class="n">ERP_D_Ld3</span><span class="o">.</span><span class="n">ne4pg2_oQU480</span><span class="o">.</span><span class="n">F2010</span><span class="o">.</span><span class="n">chrysalis_intel</span> <span class="n">MEMLEAK</span> <span class="n">insufficient</span> <span class="n">data</span> <span class="k">for</span> <span class="n">memleak</span> <span class="n">test</span>
<span class="n">PASS</span> <span class="n">ERP_D_Ld3</span><span class="o">.</span><span class="n">ne4pg2_oQU480</span><span class="o">.</span><span class="n">F2010</span><span class="o">.</span><span class="n">chrysalis_intel</span> <span class="n">SHORT_TERM_ARCHIVER</span>
</pre></div>
</div>
<p>The entire stdout output from the test will be put in the file <code class="docutils literal notranslate"><span class="pre">$CASEDIR/TestStatus.log</span></code>.</p>
<p>A <code class="docutils literal notranslate"><span class="pre">cs.status.&lt;test-id&gt;</span></code> script will also be put in the test root. This script will allow you to see the status of the test.</p>
</section>
</section>
<section id="baselines">
<h2><a class="toc-backref" href="#id17" role="doc-backlink">Baselines</a><a class="headerlink" href="#baselines" title="Link to this heading"></a></h2>
<p>An important part of testing is creating, comparing, and managing baselines (sometimes called gold results). Baselines can be used to compare history files, namelist files, and performance metrics.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">create_test</span></code> tool can be asked to perform bit-for-bit comparisons between the files generated by the current run and the files stored in the baseline. They must be bit-for-bit identical for the baseline test to pass.</p>
<p>Baseline testing adds an additional test criteria to the one that comes from the test type and is used as a way to guard against unintentionally changing the results from a deterministic climate model.</p>
<section id="creating-a-baseline">
<h3><a class="toc-backref" href="#id18" role="doc-backlink">Creating a baseline</a><a class="headerlink" href="#creating-a-baseline" title="Link to this heading"></a></h3>
<p>A baseline can be generated by passing <code class="docutils literal notranslate"><span class="pre">-g</span></code> to <code class="docutils literal notranslate"><span class="pre">create_test</span></code>. There
are additional options to control generating baselines.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">scripts</span><span class="o">/</span><span class="n">create_test</span> <span class="o">-</span><span class="n">b</span> <span class="n">master</span> <span class="o">-</span><span class="n">g</span> <span class="n">SMS</span><span class="o">.</span><span class="n">ne30_f19_g16_rx1</span><span class="o">.</span><span class="n">A</span>
</pre></div>
</div>
</section>
<section id="comparing-a-baseline">
<h3><a class="toc-backref" href="#id19" role="doc-backlink">Comparing a baseline</a><a class="headerlink" href="#comparing-a-baseline" title="Link to this heading"></a></h3>
<p>Comparing the output of a test to a baseline is achieved by passing <code class="docutils literal notranslate"><span class="pre">-c</span></code> to <code class="docutils literal notranslate"><span class="pre">create_test</span></code>.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">scripts</span><span class="o">/</span><span class="n">create_test</span> <span class="o">-</span><span class="n">b</span> <span class="n">master</span> <span class="o">-</span><span class="n">c</span> <span class="n">SMS</span><span class="o">.</span><span class="n">ne30_f19_g16_rx1</span><span class="o">.</span><span class="n">A</span>
</pre></div>
</div>
<p>Suppose you accidentally changed something in the source code that does not cause the model to crash but
does cause it to change the answers it produces. In this case, the SMS test would pass (it still runs) but the
comparison with baselines would FAIL (answers are not bit-for-bit identical to the baseline) and so the test
as a whole would FAIL.</p>
</section>
<section id="managing-baselines">
<h3><a class="toc-backref" href="#id20" role="doc-backlink">Managing baselines</a><a class="headerlink" href="#managing-baselines" title="Link to this heading"></a></h3>
<p>If you intended to change the answers, you need to update the baseline with new files. This is referred to as “blessing” the test.
This is done with the <code class="docutils literal notranslate"><span class="pre">./CIME/Tools/bless_test_results</span></code> tool. The tool provides the ability to bless different features of the baseline. The currently supported features are namelist files, history files, and performance metrics. The performance metrics are separated into throughput and memory usage.</p>
<p>The following command can be used to compare a test to a baseline and bless an update to the history file.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">CIME</span><span class="o">/</span><span class="n">Tools</span><span class="o">/</span><span class="n">bless_test_results</span> <span class="o">-</span><span class="n">b</span> <span class="n">master</span> <span class="o">--</span><span class="n">hist</span><span class="o">-</span><span class="n">only</span> <span class="n">SMS</span><span class="o">.</span><span class="n">ne30_f19_g16_rx1</span><span class="o">.</span><span class="n">A</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">./CIME/Tools/compare_test_results</span></code> tool can be used to quickly compare tests to baselines and report any <code class="docutils literal notranslate"><span class="pre">diffs</span></code>.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">CIME</span><span class="o">/</span><span class="n">Tools</span><span class="o">/</span><span class="n">compare_test_results</span> <span class="o">-</span><span class="n">b</span> <span class="n">master</span> <span class="n">SMS</span><span class="o">.</span><span class="n">ne30_f19_g16_rx1</span><span class="o">.</span><span class="n">A</span>
</pre></div>
</div>
</section>
<section id="performance-baselines">
<h3><a class="toc-backref" href="#id21" role="doc-backlink">Performance baselines</a><a class="headerlink" href="#performance-baselines" title="Link to this heading"></a></h3>
<p>By default performance baselines are generated by parsing the coupler log and comparing the throughput in SYPD (Simulated Years Per Day) and the memory usage high water.</p>
<p>This can be customized by creating a python module under <code class="docutils literal notranslate"><span class="pre">$MODEL/cime_config/customize</span></code>. There are four hooks that can be used to customize the generation and comparison.</p>
<ul class="simple">
<li><p>perf_get_throughput</p></li>
<li><p>perf_get_memory</p></li>
<li><p>perf_compare_throughput_baseline</p></li>
<li><p>perf_compare_memory_baseline</p></li>
</ul>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<p>need to add api docs and link</p>
</div>
<p>The following pseudo code is an example of this customization.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># $DRIVER/cime_config/customize/perf_baseline.py</span>

<span class="k">def</span><span class="w"> </span><span class="nf">perf_get_throughput</span><span class="p">(</span><span class="n">case</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Parameters</span>
<span class="sd">  ----------</span>
<span class="sd">  case : CIME.case.case.Case</span>
<span class="sd">    Current case object.</span>

<span class="sd">  Returns</span>
<span class="sd">  -------</span>
<span class="sd">  str</span>
<span class="sd">    Storing throughput value.</span>
<span class="sd">  str</span>
<span class="sd">    Open baseline file for writing.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">current</span> <span class="o">=</span> <span class="n">analyze_throughput</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">current</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">perf_get_memory</span><span class="p">(</span><span class="n">case</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Parameters</span>
<span class="sd">  ----------</span>
<span class="sd">  case : CIME.case.case.Case</span>
<span class="sd">    Current case object.</span>

<span class="sd">  Returns</span>
<span class="sd">  -------</span>
<span class="sd">  str</span>
<span class="sd">    Storing memory value.</span>
<span class="sd">  str</span>
<span class="sd">    Open baseline file for writing.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">current</span> <span class="o">=</span> <span class="n">analyze_memory</span><span class="p">(</span><span class="n">case</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">current</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">perf_compare_throughput_baseline</span><span class="p">(</span><span class="n">case</span><span class="p">,</span> <span class="n">baseline</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Parameters</span>
<span class="sd">  ----------</span>
<span class="sd">  case : CIME.case.case.Case</span>
<span class="sd">    Current case object.</span>
<span class="sd">  baseline : str</span>
<span class="sd">    Baseline throughput value.</span>
<span class="sd">  tolerance : float</span>
<span class="sd">    Allowed difference tolerance.</span>

<span class="sd">  Returns</span>
<span class="sd">  -------</span>
<span class="sd">  bool</span>
<span class="sd">    Whether throughput diff is below tolerance.</span>
<span class="sd">  str</span>
<span class="sd">    Comments about the results.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">current</span> <span class="o">=</span> <span class="n">analyze_throughput</span><span class="p">(</span><span class="n">case</span><span class="p">)</span>

  <span class="n">baseline</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">baseline</span><span class="p">)</span>

  <span class="n">diff</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="n">generate_diff</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">diff</span><span class="p">,</span> <span class="n">comments</span>

<span class="k">def</span><span class="w"> </span><span class="nf">perf_compare_memory_baseline</span><span class="p">(</span><span class="n">case</span><span class="p">,</span> <span class="n">baseline</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Parameters</span>
<span class="sd">  ----------</span>
<span class="sd">  case : CIME.case.case.Case</span>
<span class="sd">    Current case object.</span>
<span class="sd">  baseline : str</span>
<span class="sd">    Baseline memory value.</span>
<span class="sd">  tolerance : float</span>
<span class="sd">    Allowed difference tolerance.</span>

<span class="sd">  Returns</span>
<span class="sd">  -------</span>
<span class="sd">  bool</span>
<span class="sd">    Whether memory diff is below tolerance.</span>
<span class="sd">  str</span>
<span class="sd">    Comments about the results.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">current</span> <span class="o">=</span> <span class="n">analyze_memory</span><span class="p">(</span><span class="n">case</span><span class="p">)</span>

  <span class="n">baseline</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">baseline</span><span class="p">)</span>

  <span class="n">diff</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="n">generate_diff</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">diff</span><span class="p">,</span> <span class="n">comments</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="ccs/model-configuration/customize-cime.html" class="btn btn-neutral float-left" title="Customize CIME" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="tools/index.html" class="btn btn-neutral float-right" title="Tools" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, U.S. National Science Foundation and U.S. Department of Energy.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
     
<script>var version_json_loc = "../../versions.json";</script>


</footer>
        </div>
      </div>
    </section>
  </div>
  

  <script type="text/javascript">
    let baseUriRegex = /(.*\/cime)\/.*/g;
    let parsedUri = baseUriRegex.exec(document.baseURI);

    if (parsedUri != null && parsedUri.length == 2) {
      let baseUri = parsedUri[1];

      $.get(`${baseUri}/versions/versions.json`, function(data) {
        let versionElement = $("#versions");

        Object.keys(data).forEach(function(key) {
          let value = data[key];

          let item = `<dd><a href="${baseUri}/versions/${key}/html/">${value}</a></dd>`

          versionElement.append(item);
        });
      });
    }
  </script>
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: master
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <dl id="versions">
        <dt>Versions</dt>
      </dl>
      
      
    </div>
  </div>
<script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>