

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Building a Case &mdash; CIME master documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx-toolbox-code.css" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=3d7e66fe" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=30d551ce"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Running a Case" href="running-a-case.html" />
    <link rel="prev" title="Setting up a Case" href="setting-up-a-case.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            CIME
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">For Users</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Case Control System (CCS)</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="query-configuration.html">Query configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="user-config.html">User Config</a></li>
<li class="toctree-l2"><a class="reference internal" href="creating-a-case.html">Creating a Case</a></li>
<li class="toctree-l2"><a class="reference internal" href="setting-up-a-case.html">Setting up a Case</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Building a Case</a></li>
<li class="toctree-l2"><a class="reference internal" href="running-a-case.html">Running a Case</a></li>
<li class="toctree-l2"><a class="reference internal" href="cloning-a-case.html">Cloning a Case</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/index.html">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="timers.html">Timers</a></li>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="model-configuration/index.html">Model Configuration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../system_testing.html">System Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">For Developers/Contributors</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing-guide.html">Contributing Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">CIME</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Case Control System (CCS)</a></li>
      <li class="breadcrumb-item active">Building a Case</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/ccs/building-a-case.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="building-a-case">
<span id="ccs-building-a-case"></span><h1>Building a Case<a class="headerlink" href="#building-a-case" title="Link to this heading"></a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#configuring-the-build" id="id1">Configuring the Build</a></p></li>
<li><p><a class="reference internal" href="#building-the-model" id="id2">Building the Model</a></p></li>
<li><p><a class="reference internal" href="#rebuilding-the-model" id="id3">Rebuilding the Model</a></p></li>
</ul>
</nav>
<p>Once the case has been created and set up, it’s time to build the executable.
Several directories full of source code must be built all with the same compiler and flags.
The <strong>case.build</strong> script performs all build operations (setting dependencies, invoking Make/CMake,
creating the executable).</p>
<section id="configuring-the-build">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Configuring the Build</a><a class="headerlink" href="#configuring-the-build" title="Link to this heading"></a></h2>
<p>You do not need to change the default build settings to create the executable, but it may be useful to change them to make optimal use of the system. CIME provides the <a class="reference internal" href="setting-up-a-case.html#ccs-xmlquery"><span class="std std-ref">xmlquery</span></a> and <a class="reference internal" href="setting-up-a-case.html#ccs-xmlchange"><span class="std std-ref">xmlchange</span></a> commands to view and modify the build settings.</p>
<p>Below are some variables that affect the build process and output.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Variable</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>BUILD_THREADED</p></td>
<td><p>If <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> the model will be built with OpenMP.</p></td>
</tr>
<tr class="row-odd"><td><p>DEBUG</p></td>
<td><p>If <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> the model is compiled with debugging instead
of optimization flags.</p></td>
</tr>
<tr class="row-even"><td><p>GMAKE_J</p></td>
<td><p>The number of threads GNU Make should use while building.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="building-the-model">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Building the Model</a><a class="headerlink" href="#building-the-model" title="Link to this heading"></a></h2>
<p>Running <code class="docutils literal notranslate"><span class="pre">case.build</span></code> will:</p>
<ol class="arabic simple">
<li><p>Create the component namelists in <code class="docutils literal notranslate"><span class="pre">$RUNDIR</span></code> and <code class="docutils literal notranslate"><span class="pre">$CASEROOT/CaseDocs</span></code>.</p></li>
<li><p>Build the shared libraries, utilities (e.g. <code class="docutils literal notranslate"><span class="pre">cprnc</span></code>) and place them in <code class="docutils literal notranslate"><span class="pre">$SHAREDLIBROOT</span></code>.</p></li>
<li><p>Build the components and model executables, which is placed in <code class="docutils literal notranslate"><span class="pre">$EXEROOT</span></code>.</p></li>
</ol>
<p>Each utility, component, and the model will generate a log file in the form <code class="docutils literal notranslate"><span class="pre">$name.bldlog.$datestamp</span></code> in the <code class="docutils literal notranslate"><span class="pre">$EXEROOT</span></code> directory.
If the logs are compressed (as indicated by a .gz file extension), the build ran successfully.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The following is just an example and can vary based on the model, compiler, and compset.</p>
</div>
<p>Running <code class="docutils literal notranslate"><span class="pre">case.build</span></code> typically results in a directory structure similar to the following in <code class="docutils literal notranslate"><span class="pre">$EXEROOT</span></code>.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>.
├──<span class="w"> </span>atm
│<span class="w">   </span>└──<span class="w"> </span>obj
├──<span class="w"> </span>cpl
│<span class="w">   </span>└──<span class="w"> </span>obj
├──<span class="w"> </span>esp
│<span class="w">   </span>└──<span class="w"> </span>obj
├──<span class="w"> </span>glc
│<span class="w">   </span>└──<span class="w"> </span>obj
├──<span class="w"> </span>iac
│<span class="w">   </span>└──<span class="w"> </span>obj
├──<span class="w"> </span>ice
│<span class="w">   </span>└──<span class="w"> </span>obj
├──<span class="w"> </span>lib
│<span class="w">   </span>└──<span class="w"> </span>include
├──<span class="w"> </span>lnd
│<span class="w">   </span>└──<span class="w"> </span>obj
├──<span class="w"> </span>ocn
│<span class="w">   </span>└──<span class="w"> </span>obj
├──<span class="w"> </span>oneapi-ifx
│<span class="w">   </span>└──<span class="w"> </span>mpich
│<span class="w">       </span>└──<span class="w"> </span>nodebug
│<span class="w">           </span>└──<span class="w"> </span>nothreads
│<span class="w">               </span>├──<span class="w"> </span>gptl
│<span class="w">               </span>├──<span class="w"> </span>include
│<span class="w">               </span>├──<span class="w"> </span>lib
│<span class="w">               </span>├──<span class="w"> </span>mct
│<span class="w">               </span>└──<span class="w"> </span>spio
├──<span class="w"> </span>rof
│<span class="w">   </span>└──<span class="w"> </span>obj
└──<span class="w"> </span>wav
<span class="w">    </span>└──<span class="w"> </span>obj
</pre></div>
</div>
<p>In this example, the model is built with the Intel oneAPI compiler and uses MPICH for parallel communication (denoted by the <code class="docutils literal notranslate"><span class="pre">oneapi-ifx</span></code> and <code class="docutils literal notranslate"><span class="pre">mpich</span></code> directories). The <code class="docutils literal notranslate"><span class="pre">nodebug</span></code> and <code class="docutils literal notranslate"><span class="pre">nothreads</span></code> directories indicate that the build is not using debugging flags or threading.</p>
<p>The directories under <code class="docutils literal notranslate"><span class="pre">oneapi-ifx/mpich/nodebug/nothreads</span></code> contains the external libraries used by the model.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">lib/include</span></code> directory contains special include modules.</p>
<p>The model executable is placed directly in the <code class="docutils literal notranslate"><span class="pre">$EXEROOT</span></code> directory, which is typically named after the model (e.g., <strong>cesm.exe</strong> or <strong>e3sm.exe</strong>).</p>
<p>In the <code class="docutils literal notranslate"><span class="pre">$EXEROOT</span></code> directory is where you’ll find the build logs for each component, external library, and the model executable.</p>
<p>Component namelists, component logs, output data sets, and restart files are placed in <code class="docutils literal notranslate"><span class="pre">$RUNDIR</span></code>.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>It is important to note that <code class="docutils literal notranslate"><span class="pre">$RUNDIR</span></code> and <code class="docutils literal notranslate"><span class="pre">$EXEROOT</span></code> are independent variables that are set in the <code class="docutils literal notranslate"><span class="pre">$CASEROOT/env_run.xml</span></code> file.</p>
<p>The default values for <code class="docutils literal notranslate"><span class="pre">$RUNDIR</span></code> and <code class="docutils literal notranslate"><span class="pre">$EXEROOT</span></code> respectively are <code class="docutils literal notranslate"><span class="pre">$CIME_OUTPUT_ROOT/$CASE/run</span></code> and <code class="docutils literal notranslate"><span class="pre">$CIME_OUTPUT_ROOT/$CASE/bld</span></code>. Changing the <code class="docutils literal notranslate"><span class="pre">$CIME_OUTPUT_ROOT</span></code> variable will change the location of the run and build directories.</p>
</div>
</section>
<section id="rebuilding-the-model">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Rebuilding the Model</a><a class="headerlink" href="#rebuilding-the-model" title="Link to this heading"></a></h2>
<p>The model will need to be rebuilt if any of the following is changed:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">env_build.xml</span></code> is modified</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Macros.make</span></code> is modified</p></li>
<li><p>Code is added to <code class="docutils literal notranslate"><span class="pre">SourceMods/src</span></code></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">Macros.make</span></code> may or may not be present. It’s dependent on the model and whether Make or CMake is used.</p>
</div>
<p>It’s safest to clean the build and rebuild from scratch in these cases.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./case.build<span class="w"> </span>--clean-all
./case.build
</pre></div>
</div>
<p>If threading has been changed (turned on or off) in any component since the previous build, the build script should fail with the following error and suggestion that the model be rebuilt from scratch:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ERROR</span> <span class="n">SMP</span> <span class="n">STATUS</span> <span class="n">HAS</span> <span class="n">CHANGED</span>
<span class="n">SMP_BUILD</span> <span class="o">=</span> <span class="n">a0l0i0o0g0c0</span>
<span class="n">SMP_VALUE</span> <span class="o">=</span> <span class="n">a1l0i0o0g0c0</span>
<span class="n">A</span> <span class="n">manual</span> <span class="n">clean</span> <span class="n">of</span> <span class="n">your</span> <span class="n">obj</span> <span class="n">directories</span> <span class="ow">is</span> <span class="n">strongly</span> <span class="n">recommended</span><span class="o">.</span>
<span class="n">You</span> <span class="n">should</span> <span class="n">execute</span> <span class="n">the</span> <span class="n">following</span><span class="p">:</span>
  <span class="o">./</span><span class="n">case</span><span class="o">.</span><span class="n">build</span> <span class="o">--</span><span class="n">clean</span>
  <span class="o">./</span><span class="n">case</span><span class="o">.</span><span class="n">build</span>

<span class="o">----</span> <span class="n">OR</span> <span class="o">----</span>

<span class="n">You</span> <span class="n">can</span> <span class="n">override</span> <span class="n">this</span> <span class="n">error</span> <span class="n">message</span> <span class="n">at</span> <span class="n">your</span> <span class="n">own</span> <span class="n">risk</span> <span class="n">by</span> <span class="n">executing</span><span class="p">:</span>
  <span class="o">./</span><span class="n">xmlchange</span> <span class="n">SMP_BUILD</span><span class="o">=</span><span class="mi">0</span>
<span class="n">Then</span> <span class="n">rerun</span> <span class="n">the</span> <span class="n">build</span> <span class="n">script</span> <span class="n">interactively</span><span class="o">.</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>If there is any doubt, rebuild.</p>
</div>
<p>Run this to clean all of the model components (except for support libraries such as <strong>mct</strong> and <strong>gptl</strong>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">case</span><span class="o">.</span><span class="n">build</span> <span class="o">--</span><span class="n">clean</span>
</pre></div>
</div>
<p>Run this to clean everything associated with the build:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">case</span><span class="o">.</span><span class="n">build</span> <span class="o">--</span><span class="n">clean</span><span class="o">-</span><span class="nb">all</span>
</pre></div>
</div>
<p>You can also clean an individual component as shown here, where “compname” is the name of the component you want to clean (for example, atm, clm, pio, and so on).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">case</span><span class="o">.</span><span class="n">build</span> <span class="o">--</span><span class="n">clean</span> <span class="n">compname</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="setting-up-a-case.html" class="btn btn-neutral float-left" title="Setting up a Case" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="running-a-case.html" class="btn btn-neutral float-right" title="Running a Case" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, U.S. National Science Foundation and U.S. Department of Energy.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
     
<script>var version_json_loc = "../../../versions.json";</script>


</footer>
        </div>
      </div>
    </section>
  </div>
  

  <script type="text/javascript">
    let baseUriRegex = /(.*\/cime)\/.*/g;
    let parsedUri = baseUriRegex.exec(document.baseURI);

    if (parsedUri != null && parsedUri.length == 2) {
      let baseUri = parsedUri[1];

      $.get(`${baseUri}/versions/versions.json`, function(data) {
        let versionElement = $("#versions");

        Object.keys(data).forEach(function(key) {
          let value = data[key];

          let item = `<dd><a href="${baseUri}/versions/${key}/html/">${value}</a></dd>`

          versionElement.append(item);
        });
      });
    }
  </script>
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: master
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <dl id="versions">
        <dt>Versions</dt>
      </dl>
      
      
    </div>
  </div>
<script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>