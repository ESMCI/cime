

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Timers &mdash; CIME master documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx-toolbox-code.css" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=3d7e66fe" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=30d551ce"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Troubleshooting" href="troubleshooting.html" />
    <link rel="prev" title="Multi-instance" href="examples/multi-instance.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            CIME
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">For Users</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Case Control System (CCS)</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="query-configuration.html">Query configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="user-config.html">User Config</a></li>
<li class="toctree-l2"><a class="reference internal" href="creating-a-case.html">Creating a Case</a></li>
<li class="toctree-l2"><a class="reference internal" href="setting-up-a-case.html">Setting up a Case</a></li>
<li class="toctree-l2"><a class="reference internal" href="building-a-case.html">Building a Case</a></li>
<li class="toctree-l2"><a class="reference internal" href="running-a-case.html">Running a Case</a></li>
<li class="toctree-l2"><a class="reference internal" href="cloning-a-case.html">Cloning a Case</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/index.html">Examples</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Timers</a></li>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="model-configuration/index.html">Model Configuration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../system_testing.html">System Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">For Developers/Contributors</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing-guide.html">Contributing Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">CIME</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Case Control System (CCS)</a></li>
      <li class="breadcrumb-item active">Timers</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/ccs/timers.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="timers">
<span id="id1"></span><h1>Timers<a class="headerlink" href="#timers" title="Link to this heading"></a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#controlling-timers" id="id2">Controlling timers</a></p>
<ul>
<li><p><a class="reference internal" href="#level" id="id3">Level</a></p></li>
<li><p><a class="reference internal" href="#detail" id="id4">Detail</a></p></li>
<li><p><a class="reference internal" href="#find-grain-control" id="id5">Find-grain control</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#timing-data" id="id6">Timing data</a></p>
<ul>
<li><p><a class="reference internal" href="#model" id="id7">Model</a></p></li>
<li><p><a class="reference internal" href="#component" id="id8">Component</a></p></li>
<li><p><a class="reference internal" href="#coupler" id="id9">Coupler</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#advice-on-setting-your-wallclock-time" id="id10">Advice on setting your wallclock time</a></p></li>
</ul>
</nav>
<p>CIME includes a copy of the General Purpose Timing Library (GPTL) and timers are placed throughout the CIME driver. CIME-driven models typically
also have GPTL timers in their code and very detailed timing information can be obtained.</p>
<p>To enable timers, set the xml variable <code class="docutils literal notranslate"><span class="pre">CHECK_TIMING</span></code> to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> with <code class="docutils literal notranslate"><span class="pre">./xmlchange</span> <span class="pre">CHECK_TIMING=true</span></code>, this will produce files in <code class="docutils literal notranslate"><span class="pre">$CASEROOT/timing</span></code>.</p>
<section id="controlling-timers">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Controlling timers</a><a class="headerlink" href="#controlling-timers" title="Link to this heading"></a></h2>
<p>User customization of timers is done via the xml variables <code class="docutils literal notranslate"><span class="pre">TIMER_LEVEL</span></code> and <code class="docutils literal notranslate"><span class="pre">TIMER_DETAIL</span></code>.</p>
<section id="level">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">Level</a><a class="headerlink" href="#level" title="Link to this heading"></a></h3>
<p>Timer level using the XML variable <code class="docutils literal notranslate"><span class="pre">TIMER_LEVEL</span></code>: This is the maximum code stack depth of enabled timers.</p>
</section>
<section id="detail">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Detail</a><a class="headerlink" href="#detail" title="Link to this heading"></a></h3>
<p>Timer detail using the XML variable <code class="docutils literal notranslate"><span class="pre">TIMER_DETAIL</span></code>: This is the maximum detail level of enabled timers.</p>
<p>This is an integer indicating maximum detail level to profile.  This
xml variable is used to set the namelist variable timing_detail_limit.
This namelist variable is used by perf_mod (in
$CIMEROOT/src/share/timing/perf_mod.F90) to turn timers off and on
depending on calls to the routine t_adj_detailf.  If in the code a
statement appears like t_adj_detailf(+1), then the current timer
detail level is incremented by 1 and compared to the time_detail_limit
obtained from the namelist.  If the limit is exceeded then the timer
is turned off.</p>
</section>
<section id="find-grain-control">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">Find-grain control</a><a class="headerlink" href="#find-grain-control" title="Link to this heading"></a></h3>
<p>Further control of timers is then done via modifications of the <strong>prof_inparm namelists</strong> in the file <strong>drv_in</strong>. This is done
via keyword-value settings in user_nl_cpl. As an example, if you want to set the namelist variable <code class="docutils literal notranslate"><span class="pre">profile_barriers</span></code> to <code class="docutils literal notranslate"><span class="pre">.true.</span></code>,
add the following line in your <strong>$CASEROOT/user_nl_cpl</strong>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>profile_barriers = .true.
</pre></div>
</div>
</section>
</section>
<section id="timing-data">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Timing data</a><a class="headerlink" href="#timing-data" title="Link to this heading"></a></h2>
<p>Every model run produces three types of timing output that you can examine:</p>
<section id="model">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">Model</a><a class="headerlink" href="#model" title="Link to this heading"></a></h3>
<p>The timing output can be found in <code class="docutils literal notranslate"><span class="pre">$CASEROOT/timing/$model_timing.$CASE.$datestamp</span></code>.</p>
<p>This is the most useful way to quickly determine timing summaries across components
The following describes the most important parts of this timing file:</p>
<p>An example timing file of this type is:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>---------------- TIMING PROFILE ---------------------
Case        : b.e20.BHIST.f09_g17.20thC.297_02
LID         : 9459679.chadmin1.180517-114852
Machine     : cheyenne
Caseroot    : /glade/p/cesmdata/cseg/runs/cesm2_0/b.e20.BHIST.f09_g17.20thC.297_02
Timeroot    : /glade/p/cesmdata/cseg/runs/cesm2_0/b.e20.BHIST.f09_g17.20thC.297_02/Tools
User        : hannay
Curr Date   : Thu May 17 12:42:27 2018
grid        : a%0.9x1.25_l%0.9x1.25_oi%gx1v7_r%r05_g%gland4_w%ww3a_m%gx1v7
compset     : HIST_CAM60_CLM50%BGC-CROP_CICE_POP2%ECO_MOSART_CISM2%NOEVOLVE_WW3_BGC%BDRD
run_type    : hybrid, continue_run = FALSE (inittype = TRUE)
stop_option : nyears, stop_n = 1
run_length  : 365 days (364.958333333 for ocean)

component       comp_pes    root_pe   tasks  x threads instances (stride)
---------        ------     -------   ------   ------  ---------  ------
cpl = cpl        3456        0        1152   x 3       1      (1     )
atm = cam        3456        0        1152   x 3       1      (1     )
lnd = clm        2592        0        864    x 3       1      (1     )
ice = cice       864         864      288    x 3       1      (1     )
ocn = pop        768         1152     256    x 3       1      (1     )
rof = mosart     2592        0        864    x 3       1      (1     )
glc = cism       3456        0        1152   x 3       1      (1     )
wav = ww         96          1408     32     x 3       1      (1     )
esp = sesp       1           0        1      x 1       1      (1     )

total pes active           : 12960
mpi tasks per node               : 36
pe count for cost estimate : 4320

Overall Metrics:
Model Cost:            3541.30   pe-hrs/simulated_year
Model Throughput:        29.28   simulated_years/day

Init Time   :     242.045 seconds
Run Time    :    2951.082 seconds        8.085 seconds/day
Final Time  :       0.008 seconds

Actual Ocn Init Wait Time     :     768.737 seconds
Estimated Ocn Init Run Time   :       0.248 seconds
Estimated Run Time Correction :       0.000 seconds
(This correction has been applied to the ocean and total run times)

Runs Time in total seconds, seconds/model-day, and model-years/wall-day
CPL Run Time represents time in CPL pes alone, not including time associated with data exchange with other components

TOT Run Time:    2951.082 seconds        8.085 seconds/mday        29.28 myears/wday
CPL Run Time:     248.696 seconds        0.681 seconds/mday       347.41 myears/wday
ATM Run Time:    2097.788 seconds        5.747 seconds/mday        41.19 myears/wday
LND Run Time:     545.991 seconds        1.496 seconds/mday       158.24 myears/wday
ICE Run Time:     389.173 seconds        1.066 seconds/mday       222.01 myears/wday
OCN Run Time:    2169.399 seconds        5.944 seconds/mday        39.83 myears/wday
ROF Run Time:      42.241 seconds        0.116 seconds/mday      2045.41 myears/wday
GLC Run Time:       1.049 seconds        0.003 seconds/mday     82364.16 myears/wday
WAV Run Time:     517.414 seconds        1.418 seconds/mday       166.98 myears/wday
ESP Run Time:       0.000 seconds        0.000 seconds/mday         0.00 myears/wday
CPL COMM Time:   2464.660 seconds        6.752 seconds/mday        35.06 myears/wday

---------------- DRIVER TIMING FLOWCHART ---------------------
..........................
</pre></div>
</div>
<p>TIMING PROFILE is the first section in the timing output. It
summarizes general timing information for the run. The total run
time and cost are given in several metrics to facilitate analysis
and comparisons with other runs. These metrics includ pe-hrs per
simulated year (cost), simulated years per wall day (thoughput),
seconds, and seconds per model day. The total run time for each
component and the time for initialization of the model also are
provided. These times are the aggregate over the total run and do
not take into account any temporal or processor load imbalances.</p>
<p>DRIVER TIMING FLOWCHART is the second section in the timing
output. It provides timing information for the driver in
sequential order and indicates which processors are involved in
the cost. Finally, the timings for the coupler are broken out at
the bottom of the timing output file.</p>
</section>
<section id="component">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">Component</a><a class="headerlink" href="#component" title="Link to this heading"></a></h3>
<p>The timing output can be found in <code class="docutils literal notranslate"><span class="pre">$CASEROOT/timing/$model_timing_stats.$date</span></code>.</p>
<p>Provides an overall detailed timing summary for each component, including the minimum and maximum of all the model timers.</p>
</section>
<section id="coupler">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">Coupler</a><a class="headerlink" href="#coupler" title="Link to this heading"></a></h3>
<p>The timing out put can be found in <code class="docutils literal notranslate"><span class="pre">$RUNDIR/cpl.log.$datestamp</span></code> or <code class="docutils literal notranslate"><span class="pre">$DOUT_S_ROOT/logs/cpl.log.$datestamp</span></code>.</p>
<p>Contains the run time for each model day during the run and is
output during the run. You can search for <code class="docutils literal notranslate"><span class="pre">tStamp</span></code> in the cpl.log
file to see the information, which is useful for tracking down
temporal variability in cost due to inherent model variability or
to hardware. The model daily cost generally is pretty constant
unless I/O is written intermittently, such as at the end of the
month.</p>
</section>
</section>
<section id="advice-on-setting-your-wallclock-time">
<h2><a class="toc-backref" href="#id10" role="doc-backlink">Advice on setting your wallclock time</a><a class="headerlink" href="#advice-on-setting-your-wallclock-time" title="Link to this heading"></a></h2>
<dl>
<dt>When you look at the <strong>$model_timing.$CASE.$datestamp</strong> file for “Model Throughput”, you will find output like this:</dt><dd><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Overall</span> <span class="n">Metrics</span><span class="p">:</span>
<span class="n">Model</span> <span class="n">Cost</span><span class="p">:</span> <span class="mf">327.14</span> <span class="n">pe</span><span class="o">-</span><span class="n">hrs</span><span class="o">/</span><span class="n">simulated_year</span> <span class="p">(</span><span class="n">scale</span><span class="o">=</span> <span class="mf">0.50</span><span class="p">)</span>
<span class="n">Model</span> <span class="n">Throughput</span><span class="p">:</span> <span class="mf">4.70</span> <span class="n">simulated_years</span><span class="o">/</span><span class="n">day</span>
</pre></div>
</div>
</dd>
</dl>
<p>The model throughput is the estimated number of model years that you
can run in a wallclock day. Based on this, you can maximize your queue
limit and change <code class="docutils literal notranslate"><span class="pre">$STOP_OPTION</span></code> and <code class="docutils literal notranslate"><span class="pre">$STOP_N</span></code>.</p>
<p>For example, say a model’s throughput is 4.7 simulated_years/day, and
the maximum runtime limit on your machine is 12 hours. 4.7 model
years/24 hours * 12 hours = 2.35 years. On the massively parallel
computers, there is always some variability in how long it will take
a job to run. On some machines, you may need to leave as much as 20%
buffer time in your run to guarantee that jobs finish reliably before
the time limit. For that reason, set your model to run only one model
year/job. In this example, set your wallclock at 12 hours and invoke
<code class="docutils literal notranslate"><span class="pre">xmlchange</span></code> in <code class="docutils literal notranslate"><span class="pre">CASEROOT</span></code> as shown here:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">xmlchange</span> <span class="n">STOP_OPTION</span><span class="o">=</span><span class="n">nyears</span>
<span class="o">./</span><span class="n">xmlchange</span> <span class="n">STOP_N</span><span class="o">=</span><span class="mi">1</span>
<span class="o">./</span><span class="n">xmlchange</span> <span class="n">REST_OPTION</span><span class="o">=</span><span class="n">nyears</span>
<span class="o">./</span><span class="n">xmlchange</span> <span class="n">REST_N</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="examples/multi-instance.html" class="btn btn-neutral float-left" title="Multi-instance" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="troubleshooting.html" class="btn btn-neutral float-right" title="Troubleshooting" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, U.S. National Science Foundation and U.S. Department of Energy.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
     
<script>var version_json_loc = "../../../versions.json";</script>


</footer>
        </div>
      </div>
    </section>
  </div>
  

  <script type="text/javascript">
    let baseUriRegex = /(.*\/cime)\/.*/g;
    let parsedUri = baseUriRegex.exec(document.baseURI);

    if (parsedUri != null && parsedUri.length == 2) {
      let baseUri = parsedUri[1];

      $.get(`${baseUri}/versions/versions.json`, function(data) {
        let versionElement = $("#versions");

        Object.keys(data).forEach(function(key) {
          let value = data[key];

          let item = `<dd><a href="${baseUri}/versions/${key}/html/">${value}</a></dd>`

          versionElement.append(item);
        });
      });
    }
  </script>
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: master
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <dl id="versions">
        <dt>Versions</dt>
      </dl>
      
      
    </div>
  </div>
<script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>