<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CIME.get_tests &mdash; CIME master documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="../../_static/pop_ver.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            CIME
          </a>
              <div class="version">
                master
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../what_cime/index.html">What is CIME?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../users_guide/index.html">Case Control System Part 1: Basic Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../users_guide/index.html#case-control-system-part-2-configuration-porting-testing-and-use-cases">Case Control System Part 2: Configuration, Porting, Testing and Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../build_cpl/index.html">Building a Coupled Model with CIME</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc_tools/index.html">Miscellaneous Tools</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../glossary/index.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Tools_user/index.html">User Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../xml_files/index.html">XML Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CIME_api/modules.html">CIME</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Tools_api/modules.html">Tools</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">CIME</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">CIME.get_tests</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for CIME.get_tests</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">CIME.utils</span>
<span class="kn">from</span> <span class="nn">CIME.utils</span> <span class="kn">import</span> <span class="n">expect</span><span class="p">,</span> <span class="n">convert_to_seconds</span><span class="p">,</span> <span class="n">parse_test_name</span><span class="p">,</span> <span class="n">get_cime_root</span>
<span class="kn">from</span> <span class="nn">CIME.XML.machines</span> <span class="kn">import</span> <span class="n">Machines</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>

<span class="c1"># Expect that, if a model wants to use python-based test lists, they will have a file</span>
<span class="c1"># $model/cime_config/tests.py , containing a test dictionary called _TESTS. Currently,</span>
<span class="c1"># only E3SM is using this feature.</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">get_cime_root</span><span class="p">(),</span> <span class="s2">&quot;../cime_config&quot;</span><span class="p">))</span>
<span class="n">_ALL_TESTS</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">tests</span> <span class="kn">import</span> <span class="n">_TESTS</span>  <span class="c1"># pylint: disable=import-error</span>

    <span class="n">_ALL_TESTS</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_TESTS</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="c1"># Here are the tests belonging to cime suites. Format for individual tests is</span>
<span class="c1"># &lt;test&gt;.&lt;grid&gt;.&lt;compset&gt;[.&lt;testmod&gt;]</span>
<span class="c1">#</span>
<span class="c1"># suite_name : {</span>
<span class="c1">#     &quot;inherit&quot; : (suite1, suite2, ...), # Optional. Suites to inherit tests from. Default is None. Tuple, list, or str.</span>
<span class="c1">#     &quot;time&quot;    : &quot;HH:MM:SS&quot;,            # Optional. Recommended upper-limit on test time.</span>
<span class="c1">#     &quot;share&quot;   : True|False,            # Optional. If True, all tests in this suite share a build. Default is False.</span>
<span class="c1">#     &quot;tests&quot;   : (test1, test2, ...)    # Optional. The list of tests for this suite. See above for format. Tuple, list, or str. This is the ONLY inheritable attribute.</span>
<span class="c1"># }</span>

<span class="n">_CIME_TESTS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;cime_tiny&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;0:10:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tests&quot;</span><span class="p">:</span> <span class="p">(</span>
            <span class="s2">&quot;ERS.f19_g16_rx1.A&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NCK.f19_g16_rx1.A&quot;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">},</span>
    <span class="s2">&quot;cime_test_only_pass&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;0:10:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tests&quot;</span><span class="p">:</span> <span class="p">(</span>
            <span class="s2">&quot;TESTRUNPASS_P1.f19_g16_rx1.A&quot;</span><span class="p">,</span>
            <span class="s2">&quot;TESTRUNPASS_P1.ne30_g16_rx1.A&quot;</span><span class="p">,</span>
            <span class="s2">&quot;TESTRUNPASS_P1.f45_g37_rx1.A&quot;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">},</span>
    <span class="s2">&quot;cime_test_only_slow_pass&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;0:10:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tests&quot;</span><span class="p">:</span> <span class="p">(</span>
            <span class="s2">&quot;TESTRUNSLOWPASS_P1.f19_g16_rx1.A&quot;</span><span class="p">,</span>
            <span class="s2">&quot;TESTRUNSLOWPASS_P1.ne30_g16_rx1.A&quot;</span><span class="p">,</span>
            <span class="s2">&quot;TESTRUNSLOWPASS_P1.f45_g37_rx1.A&quot;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">},</span>
    <span class="s2">&quot;cime_test_only&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;0:10:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tests&quot;</span><span class="p">:</span> <span class="p">(</span>
            <span class="s2">&quot;TESTBUILDFAIL_P1.f19_g16_rx1.A&quot;</span><span class="p">,</span>
            <span class="s2">&quot;TESTBUILDFAILEXC_P1.f19_g16_rx1.A&quot;</span><span class="p">,</span>
            <span class="s2">&quot;TESTRUNFAIL_P1.f19_g16_rx1.A&quot;</span><span class="p">,</span>
            <span class="s2">&quot;TESTRUNSTARCFAIL_P1.f19_g16_rx1.A&quot;</span><span class="p">,</span>
            <span class="s2">&quot;TESTRUNFAILEXC_P1.f19_g16_rx1.A&quot;</span><span class="p">,</span>
            <span class="s2">&quot;TESTRUNPASS_P1.f19_g16_rx1.A&quot;</span><span class="p">,</span>
            <span class="s2">&quot;TESTTESTDIFF_P1.f19_g16_rx1.A&quot;</span><span class="p">,</span>
            <span class="s2">&quot;TESTMEMLEAKFAIL_P1.f09_g16.X&quot;</span><span class="p">,</span>
            <span class="s2">&quot;TESTMEMLEAKPASS_P1.f09_g16.X&quot;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">},</span>
    <span class="s2">&quot;cime_test_all&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;inherit&quot;</span><span class="p">:</span> <span class="s2">&quot;cime_test_only&quot;</span><span class="p">,</span>
        <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;0:10:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tests&quot;</span><span class="p">:</span> <span class="s2">&quot;TESTRUNDIFF_P1.f19_g16_rx1.A&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;cime_test_share&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;0:10:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;share&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;tests&quot;</span><span class="p">:</span> <span class="p">(</span>
            <span class="s2">&quot;SMS_P2.f19_g16_rx1.A&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SMS_P4.f19_g16_rx1.A&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SMS_P8.f19_g16_rx1.A&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SMS_P16.f19_g16_rx1.A&quot;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">},</span>
    <span class="s2">&quot;cime_test_share2&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;0:10:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;share&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;tests&quot;</span><span class="p">:</span> <span class="p">(</span>
            <span class="s2">&quot;SMS_P2.f19_g16_rx1.X&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SMS_P4.f19_g16_rx1.X&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SMS_P8.f19_g16_rx1.X&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SMS_P16.f19_g16_rx1.X&quot;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">},</span>
    <span class="s2">&quot;cime_test_repeat&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;tests&quot;</span><span class="p">:</span> <span class="p">(</span>
            <span class="s2">&quot;TESTRUNPASS_P1.f19_g16_rx1.A&quot;</span><span class="p">,</span>
            <span class="s2">&quot;TESTRUNPASS_P2.ne30_g16_rx1.A&quot;</span><span class="p">,</span>
            <span class="s2">&quot;TESTRUNPASS_P4.f45_g37_rx1.A&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">},</span>
    <span class="s2">&quot;cime_test_time&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;0:13:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tests&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;TESTRUNPASS_P69.f19_g16_rx1.A.testmod&quot;</span><span class="p">,),</span>
    <span class="p">},</span>
    <span class="s2">&quot;cime_test_multi_inherit&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;inherit&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;cime_test_repeat&quot;</span><span class="p">,</span> <span class="s2">&quot;cime_test_only_pass&quot;</span><span class="p">,</span> <span class="s2">&quot;cime_test_all&quot;</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="s2">&quot;cime_developer&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;0:15:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tests&quot;</span><span class="p">:</span> <span class="p">(</span>
            <span class="s2">&quot;NCK_Ld3.f45_g37_rx1.A&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ERI_Ln9.f09_g16.X&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ERIO_Ln11.f09_g16.X&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SEQ_Ln9.f19_g16_rx1.A&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ERS.ne30_g16_rx1.A.drv-y100k&quot;</span><span class="p">,</span>
            <span class="s2">&quot;IRT_N2_Vmct_Ln9.f19_g16_rx1.A&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ERR_Ln9.f45_g37_rx1.A&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ERP_Ln9.f45_g37_rx1.A&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SMS_D_Ln9_Mmpi-serial.f19_g16_rx1.A&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DAE.ww3a.ADWAV&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PET_Ln9_P4.f19_f19.A&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PEM_Ln9_P4.f19_f19.A&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SMS_Ln3.T42_T42.S&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PRE.f19_f19.ADESP&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PRE.f19_f19.ADESP_TEST&quot;</span><span class="p">,</span>
            <span class="s2">&quot;MCC_P1.f19_g16_rx1.A&quot;</span><span class="p">,</span>
            <span class="s2">&quot;LDSTA.f45_g37_rx1.A&quot;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">},</span>
<span class="p">}</span>

<span class="n">_ALL_TESTS</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_CIME_TESTS</span><span class="p">)</span>

<span class="c1">###############################################################################</span>
<span class="k">def</span> <span class="nf">_get_key_data</span><span class="p">(</span><span class="n">raw_dict</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">the_type</span><span class="p">):</span>
    <span class="c1">###############################################################################</span>
    <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">raw_dict</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">the_type</span> <span class="ow">is</span> <span class="nb">tuple</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">()</span>
        <span class="k">elif</span> <span class="n">the_type</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">the_type</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">expect</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Unsupported type </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">the_type</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">raw_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">the_type</span> <span class="ow">is</span> <span class="nb">tuple</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span><span class="p">,)</span>

        <span class="n">expect</span><span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">the_type</span><span class="p">),</span>
            <span class="s2">&quot;Wrong type for </span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2"> is a </span><span class="si">{}</span><span class="s2"> but expected </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">the_type</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">val</span>


<span class="c1">###############################################################################</span>
<div class="viewcode-block" id="get_test_data"><a class="viewcode-back" href="../../CIME_api/CIME.html#CIME.get_tests.get_test_data">[docs]</a><span class="k">def</span> <span class="nf">get_test_data</span><span class="p">(</span><span class="n">suite</span><span class="p">):</span>
    <span class="c1">###############################################################################</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    For a given suite, returns (inherit, time, share, tests)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">raw_dict</span> <span class="o">=</span> <span class="n">_ALL_TESTS</span><span class="p">[</span><span class="n">suite</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">raw_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">expect</span><span class="p">(</span>
            <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;inherit&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;share&quot;</span><span class="p">,</span> <span class="s2">&quot;tests&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Unexpected test key &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span>
        <span class="n">_get_key_data</span><span class="p">(</span><span class="n">raw_dict</span><span class="p">,</span> <span class="s2">&quot;inherit&quot;</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">),</span>
        <span class="n">_get_key_data</span><span class="p">(</span><span class="n">raw_dict</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
        <span class="n">_get_key_data</span><span class="p">(</span><span class="n">raw_dict</span><span class="p">,</span> <span class="s2">&quot;share&quot;</span><span class="p">,</span> <span class="nb">bool</span><span class="p">),</span>
        <span class="n">_get_key_data</span><span class="p">(</span><span class="n">raw_dict</span><span class="p">,</span> <span class="s2">&quot;tests&quot;</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">),</span>
    <span class="p">)</span></div>


<span class="c1">###############################################################################</span>
<div class="viewcode-block" id="get_test_suites"><a class="viewcode-back" href="../../CIME_api/CIME.html#CIME.get_tests.get_test_suites">[docs]</a><span class="k">def</span> <span class="nf">get_test_suites</span><span class="p">():</span>
    <span class="c1">###############################################################################</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">_ALL_TESTS</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>


<span class="c1">###############################################################################</span>
<div class="viewcode-block" id="get_test_suite"><a class="viewcode-back" href="../../CIME_api/CIME.html#CIME.get_tests.get_test_suite">[docs]</a><span class="k">def</span> <span class="nf">get_test_suite</span><span class="p">(</span>
    <span class="n">suite</span><span class="p">,</span> <span class="n">machine</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">compiler</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skip_inherit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">skip_tests</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
    <span class="c1">###############################################################################</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a list of FULL test names for a suite.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">suite</span> <span class="ow">in</span> <span class="n">get_test_suites</span><span class="p">(),</span> <span class="s2">&quot;Unknown test suite: &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">suite</span><span class="p">))</span>
    <span class="n">machobj</span> <span class="o">=</span> <span class="n">Machines</span><span class="p">(</span><span class="n">machine</span><span class="o">=</span><span class="n">machine</span><span class="p">)</span>
    <span class="n">machine</span> <span class="o">=</span> <span class="n">machobj</span><span class="o">.</span><span class="n">get_machine_name</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">compiler</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">compiler</span> <span class="o">=</span> <span class="n">machobj</span><span class="o">.</span><span class="n">get_default_compiler</span><span class="p">()</span>
    <span class="n">expect</span><span class="p">(</span>
        <span class="n">machobj</span><span class="o">.</span><span class="n">is_valid_compiler</span><span class="p">(</span><span class="n">compiler</span><span class="p">),</span>
        <span class="s2">&quot;Compiler </span><span class="si">{}</span><span class="s2"> not valid for machine </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">compiler</span><span class="p">,</span> <span class="n">machine</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">inherits_from</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">tests_raw</span> <span class="o">=</span> <span class="n">get_test_data</span><span class="p">(</span><span class="n">suite</span><span class="p">)</span>
    <span class="n">tests</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">tests_raw</span><span class="p">:</span>
        <span class="n">expect</span><span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
            <span class="s2">&quot;Bad type of test </span><span class="si">{}</span><span class="s2">, expected string&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">test_mods</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">test_components</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="n">expect</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_components</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="s2">&quot;Bad test name </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_components</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">test_name</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">test_components</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">test_mods</span> <span class="o">=</span> <span class="n">test_components</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">test_name</span> <span class="o">=</span> <span class="n">item</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">skip_tests</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">test_name</span> <span class="ow">in</span> <span class="n">skip_tests</span><span class="p">:</span>
            <span class="n">tests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">CIME</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get_full_test_name</span><span class="p">(</span>
                    <span class="n">test_name</span><span class="p">,</span>
                    <span class="n">machine</span><span class="o">=</span><span class="n">machine</span><span class="p">,</span>
                    <span class="n">compiler</span><span class="o">=</span><span class="n">compiler</span><span class="p">,</span>
                    <span class="n">testmods_string</span><span class="o">=</span><span class="n">test_mods</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">skip_inherit</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">inherits</span> <span class="ow">in</span> <span class="n">inherits_from</span><span class="p">:</span>
            <span class="n">inherited_tests</span> <span class="o">=</span> <span class="n">get_test_suite</span><span class="p">(</span><span class="n">inherits</span><span class="p">,</span> <span class="n">machine</span><span class="p">,</span> <span class="n">compiler</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">inherited_test</span> <span class="ow">in</span> <span class="n">inherited_tests</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">inherited_test</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
                    <span class="n">tests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inherited_test</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">tests</span></div>


<span class="c1">###############################################################################</span>
<div class="viewcode-block" id="suite_has_test"><a class="viewcode-back" href="../../CIME_api/CIME.html#CIME.get_tests.suite_has_test">[docs]</a><span class="k">def</span> <span class="nf">suite_has_test</span><span class="p">(</span><span class="n">suite</span><span class="p">,</span> <span class="n">test_full_name</span><span class="p">,</span> <span class="n">skip_inherit</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="c1">###############################################################################</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">machine</span><span class="p">,</span> <span class="n">compiler</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">CIME</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">parse_test_name</span><span class="p">(</span><span class="n">test_full_name</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">machine</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> is not a full test name&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">test_full_name</span><span class="p">))</span>

    <span class="n">tests</span> <span class="o">=</span> <span class="n">get_test_suite</span><span class="p">(</span>
        <span class="n">suite</span><span class="p">,</span> <span class="n">machine</span><span class="o">=</span><span class="n">machine</span><span class="p">,</span> <span class="n">compiler</span><span class="o">=</span><span class="n">compiler</span><span class="p">,</span> <span class="n">skip_inherit</span><span class="o">=</span><span class="n">skip_inherit</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">test_full_name</span> <span class="ow">in</span> <span class="n">tests</span></div>


<span class="c1">###############################################################################</span>
<div class="viewcode-block" id="get_build_groups"><a class="viewcode-back" href="../../CIME_api/CIME.html#CIME.get_tests.get_build_groups">[docs]</a><span class="k">def</span> <span class="nf">get_build_groups</span><span class="p">(</span><span class="n">tests</span><span class="p">):</span>
    <span class="c1">###############################################################################</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a list of tests, return a list of lists, with each list representing</span>
<span class="sd">    a group of tests that can share executables.</span>

<span class="sd">    &gt;&gt;&gt; tests = [&quot;SMS_P2.f19_g16_rx1.A.melvin_gnu&quot;, &quot;SMS_P4.f19_g16_rx1.A.melvin_gnu&quot;, &quot;SMS_P2.f19_g16_rx1.X.melvin_gnu&quot;, &quot;SMS_P4.f19_g16_rx1.X.melvin_gnu&quot;, &quot;TESTRUNSLOWPASS_P1.f19_g16_rx1.A.melvin_gnu&quot;, &quot;TESTRUNSLOWPASS_P1.ne30_g16_rx1.A.melvin_gnu&quot;]</span>
<span class="sd">    &gt;&gt;&gt; get_build_groups(tests)</span>
<span class="sd">    [(&#39;SMS_P2.f19_g16_rx1.A.melvin_gnu&#39;, &#39;SMS_P4.f19_g16_rx1.A.melvin_gnu&#39;), (&#39;SMS_P2.f19_g16_rx1.X.melvin_gnu&#39;, &#39;SMS_P4.f19_g16_rx1.X.melvin_gnu&#39;), (&#39;TESTRUNSLOWPASS_P1.f19_g16_rx1.A.melvin_gnu&#39;,), (&#39;TESTRUNSLOWPASS_P1.ne30_g16_rx1.A.melvin_gnu&#39;,)]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">build_groups</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># list of tuples ([tests], set(suites))</span>

    <span class="c1"># Get a list of suites that share exes</span>
    <span class="n">suites</span> <span class="o">=</span> <span class="n">get_test_suites</span><span class="p">()</span>
    <span class="n">share_suites</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">suite</span> <span class="ow">in</span> <span class="n">suites</span><span class="p">:</span>
        <span class="n">share</span> <span class="o">=</span> <span class="n">get_test_data</span><span class="p">(</span><span class="n">suite</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">share</span><span class="p">:</span>
            <span class="n">share_suites</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">suite</span><span class="p">)</span>

    <span class="c1"># Divide tests up into build groups. Assumes that build-compatibility is transitive</span>
    <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
        <span class="n">matched</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">my_share_suites</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">suite</span> <span class="ow">in</span> <span class="n">share_suites</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">suite_has_test</span><span class="p">(</span><span class="n">suite</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">skip_inherit</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="n">my_share_suites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">suite</span><span class="p">)</span>

        <span class="c1"># Try to match this test with an existing build group</span>
        <span class="k">if</span> <span class="n">my_share_suites</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">build_group_tests</span><span class="p">,</span> <span class="n">build_group_suites</span> <span class="ow">in</span> <span class="n">build_groups</span><span class="p">:</span>
                <span class="n">overlap</span> <span class="o">=</span> <span class="n">build_group_suites</span> <span class="o">&amp;</span> <span class="n">my_share_suites</span>
                <span class="k">if</span> <span class="n">overlap</span><span class="p">:</span>
                    <span class="n">matched</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">build_group_tests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
                    <span class="n">build_group_suites</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">my_share_suites</span><span class="p">)</span>
                    <span class="k">break</span>

        <span class="c1"># Nothing matched, this test is in a build group of its own</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">matched</span><span class="p">:</span>
            <span class="n">build_groups</span><span class="o">.</span><span class="n">append</span><span class="p">(([</span><span class="n">test</span><span class="p">],</span> <span class="n">my_share_suites</span><span class="p">))</span>

    <span class="k">return</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">build_groups</span><span class="p">]</span></div>


<span class="c1">###############################################################################</span>
<div class="viewcode-block" id="infer_arch_from_tests"><a class="viewcode-back" href="../../CIME_api/CIME.html#CIME.get_tests.infer_arch_from_tests">[docs]</a><span class="k">def</span> <span class="nf">infer_arch_from_tests</span><span class="p">(</span><span class="n">testargs</span><span class="p">):</span>
    <span class="c1">###############################################################################</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a tuple (machine, [compilers]) that can be inferred from the test args</span>

<span class="sd">    &gt;&gt;&gt; infer_arch_from_tests([&quot;NCK.f19_g16_rx1.A.melvin_gnu&quot;])</span>
<span class="sd">    (&#39;melvin&#39;, [&#39;gnu&#39;])</span>
<span class="sd">    &gt;&gt;&gt; infer_arch_from_tests([&quot;NCK.f19_g16_rx1.A&quot;])</span>
<span class="sd">    (None, [])</span>
<span class="sd">    &gt;&gt;&gt; infer_arch_from_tests([&quot;NCK.f19_g16_rx1.A&quot;, &quot;NCK.f19_g16_rx1.A.melvin_gnu&quot;])</span>
<span class="sd">    (&#39;melvin&#39;, [&#39;gnu&#39;])</span>
<span class="sd">    &gt;&gt;&gt; infer_arch_from_tests([&quot;NCK.f19_g16_rx1.A.melvin_gnu&quot;, &quot;NCK.f19_g16_rx1.A.melvin_gnu&quot;])</span>
<span class="sd">    (&#39;melvin&#39;, [&#39;gnu&#39;])</span>
<span class="sd">    &gt;&gt;&gt; infer_arch_from_tests([&quot;NCK.f19_g16_rx1.A.melvin_gnu9&quot;, &quot;NCK.f19_g16_rx1.A.melvin_gnu&quot;])</span>
<span class="sd">    (&#39;melvin&#39;, [&#39;gnu9&#39;, &#39;gnu&#39;])</span>
<span class="sd">    &gt;&gt;&gt; infer_arch_from_tests([&quot;NCK.f19_g16_rx1.A.melvin_gnu&quot;, &quot;NCK.f19_g16_rx1.A.mappy_gnu&quot;])</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">    CIME.utils.CIMEError: ERROR: Must have consistent machine &#39;melvin&#39; != &#39;mappy&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">e3sm_test_suites</span> <span class="o">=</span> <span class="n">get_test_suites</span><span class="p">()</span>

    <span class="n">machine</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">compilers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">testarg</span> <span class="ow">in</span> <span class="n">testargs</span><span class="p">:</span>
        <span class="n">testarg</span> <span class="o">=</span> <span class="n">testarg</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">testarg</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;^&quot;</span><span class="p">):</span>
            <span class="n">testarg</span> <span class="o">=</span> <span class="n">testarg</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="k">if</span> <span class="n">testarg</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">e3sm_test_suites</span><span class="p">:</span>
            <span class="n">machine_for_this_test</span><span class="p">,</span> <span class="n">compiler_for_this_test</span> <span class="o">=</span> <span class="n">parse_test_name</span><span class="p">(</span><span class="n">testarg</span><span class="p">)[</span>
                <span class="mi">4</span><span class="p">:</span><span class="mi">6</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="n">machine_for_this_test</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">machine</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">machine</span> <span class="o">=</span> <span class="n">machine_for_this_test</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">expect</span><span class="p">(</span>
                        <span class="n">machine</span> <span class="o">==</span> <span class="n">machine_for_this_test</span><span class="p">,</span>
                        <span class="s2">&quot;Must have consistent machine &#39;</span><span class="si">%s</span><span class="s2">&#39; != &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span>
                        <span class="o">%</span> <span class="p">(</span><span class="n">machine</span><span class="p">,</span> <span class="n">machine_for_this_test</span><span class="p">),</span>
                    <span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span>
                <span class="n">compiler_for_this_test</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="n">compiler_for_this_test</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">compilers</span>
            <span class="p">):</span>
                <span class="n">compilers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">compiler_for_this_test</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">machine</span><span class="p">,</span> <span class="n">compilers</span></div>


<span class="c1">###############################################################################</span>
<div class="viewcode-block" id="get_full_test_names"><a class="viewcode-back" href="../../CIME_api/CIME.html#CIME.get_tests.get_full_test_names">[docs]</a><span class="k">def</span> <span class="nf">get_full_test_names</span><span class="p">(</span><span class="n">testargs</span><span class="p">,</span> <span class="n">machine</span><span class="p">,</span> <span class="n">compiler</span><span class="p">):</span>
    <span class="c1">###############################################################################</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return full test names in the form:</span>
<span class="sd">    TESTCASE.GRID.COMPSET.MACHINE_COMPILER.TESTMODS</span>
<span class="sd">    Testmods are optional</span>

<span class="sd">    Testargs can be categories or test names and support the NOT symbol &#39;^&#39;</span>

<span class="sd">    &gt;&gt;&gt; get_full_test_names([&quot;cime_tiny&quot;], &quot;melvin&quot;, &quot;gnu&quot;)</span>
<span class="sd">    [&#39;ERS.f19_g16_rx1.A.melvin_gnu&#39;, &#39;NCK.f19_g16_rx1.A.melvin_gnu&#39;]</span>

<span class="sd">    &gt;&gt;&gt; get_full_test_names([&quot;cime_tiny&quot;, &quot;PEA_P1_M.f45_g37_rx1.A&quot;], &quot;melvin&quot;, &quot;gnu&quot;)</span>
<span class="sd">    [&#39;ERS.f19_g16_rx1.A.melvin_gnu&#39;, &#39;NCK.f19_g16_rx1.A.melvin_gnu&#39;, &#39;PEA_P1_M.f45_g37_rx1.A.melvin_gnu&#39;]</span>

<span class="sd">    &gt;&gt;&gt; get_full_test_names([&#39;ERS.f19_g16_rx1.A&#39;, &#39;NCK.f19_g16_rx1.A&#39;, &#39;PEA_P1_M.f45_g37_rx1.A&#39;], &quot;melvin&quot;, &quot;gnu&quot;)</span>
<span class="sd">    [&#39;ERS.f19_g16_rx1.A.melvin_gnu&#39;, &#39;NCK.f19_g16_rx1.A.melvin_gnu&#39;, &#39;PEA_P1_M.f45_g37_rx1.A.melvin_gnu&#39;]</span>

<span class="sd">    &gt;&gt;&gt; get_full_test_names([&quot;cime_tiny&quot;, &quot;^NCK.f19_g16_rx1.A&quot;], &quot;melvin&quot;, &quot;gnu&quot;)</span>
<span class="sd">    [&#39;ERS.f19_g16_rx1.A.melvin_gnu&#39;]</span>

<span class="sd">    &gt;&gt;&gt; get_full_test_names([&quot;cime_test_multi_inherit&quot;], &quot;melvin&quot;, &quot;gnu&quot;)</span>
<span class="sd">    [&#39;TESTBUILDFAILEXC_P1.f19_g16_rx1.A.melvin_gnu&#39;, &#39;TESTBUILDFAIL_P1.f19_g16_rx1.A.melvin_gnu&#39;, &#39;TESTMEMLEAKFAIL_P1.f09_g16.X.melvin_gnu&#39;, &#39;TESTMEMLEAKPASS_P1.f09_g16.X.melvin_gnu&#39;, &#39;TESTRUNDIFF_P1.f19_g16_rx1.A.melvin_gnu&#39;, &#39;TESTRUNFAILEXC_P1.f19_g16_rx1.A.melvin_gnu&#39;, &#39;TESTRUNFAIL_P1.f19_g16_rx1.A.melvin_gnu&#39;, &#39;TESTRUNPASS_P1.f19_g16_rx1.A.melvin_gnu&#39;, &#39;TESTRUNPASS_P1.f45_g37_rx1.A.melvin_gnu&#39;, &#39;TESTRUNPASS_P1.ne30_g16_rx1.A.melvin_gnu&#39;, &#39;TESTRUNPASS_P2.ne30_g16_rx1.A.melvin_gnu&#39;, &#39;TESTRUNPASS_P4.f45_g37_rx1.A.melvin_gnu&#39;, &#39;TESTRUNSTARCFAIL_P1.f19_g16_rx1.A.melvin_gnu&#39;, &#39;TESTTESTDIFF_P1.f19_g16_rx1.A.melvin_gnu&#39;]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">machine</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Must define a machine&quot;</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">compiler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Must define a compiler&quot;</span><span class="p">)</span>
    <span class="n">e3sm_test_suites</span> <span class="o">=</span> <span class="n">get_test_suites</span><span class="p">()</span>

    <span class="n">tests_to_run</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">negations</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">testarg</span> <span class="ow">in</span> <span class="n">testargs</span><span class="p">:</span>
        <span class="c1"># remove any whitespace in name</span>
        <span class="n">testarg</span> <span class="o">=</span> <span class="n">testarg</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">testarg</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;^&quot;</span><span class="p">):</span>
            <span class="n">negations</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">testarg</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">elif</span> <span class="n">testarg</span> <span class="ow">in</span> <span class="n">e3sm_test_suites</span><span class="p">:</span>
            <span class="n">tests_to_run</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">get_test_suite</span><span class="p">(</span><span class="n">testarg</span><span class="p">,</span> <span class="n">machine</span><span class="p">,</span> <span class="n">compiler</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">tests_to_run</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                    <span class="n">CIME</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get_full_test_name</span><span class="p">(</span>
                        <span class="n">testarg</span><span class="p">,</span> <span class="n">machine</span><span class="o">=</span><span class="n">machine</span><span class="p">,</span> <span class="n">compiler</span><span class="o">=</span><span class="n">compiler</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;.&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">testarg</span><span class="p">:</span>
                    <span class="n">expect</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Unrecognized test suite &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">testarg</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span>

    <span class="k">for</span> <span class="n">negation</span> <span class="ow">in</span> <span class="n">negations</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">negation</span> <span class="ow">in</span> <span class="n">e3sm_test_suites</span><span class="p">:</span>
            <span class="n">tests_to_run</span> <span class="o">-=</span> <span class="nb">set</span><span class="p">(</span><span class="n">get_test_suite</span><span class="p">(</span><span class="n">negation</span><span class="p">,</span> <span class="n">machine</span><span class="p">,</span> <span class="n">compiler</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fullname</span> <span class="o">=</span> <span class="n">CIME</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get_full_test_name</span><span class="p">(</span>
                <span class="n">negation</span><span class="p">,</span> <span class="n">machine</span><span class="o">=</span><span class="n">machine</span><span class="p">,</span> <span class="n">compiler</span><span class="o">=</span><span class="n">compiler</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">fullname</span> <span class="ow">in</span> <span class="n">tests_to_run</span><span class="p">:</span>
                <span class="n">tests_to_run</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">tests_to_run</span><span class="p">))</span></div>


<span class="c1">###############################################################################</span>
<div class="viewcode-block" id="get_recommended_test_time"><a class="viewcode-back" href="../../CIME_api/CIME.html#CIME.get_tests.get_recommended_test_time">[docs]</a><span class="k">def</span> <span class="nf">get_recommended_test_time</span><span class="p">(</span><span class="n">test_full_name</span><span class="p">):</span>
    <span class="c1">###############################################################################</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &gt;&gt;&gt; get_recommended_test_time(&quot;ERS.f19_g16_rx1.A.melvin_gnu&quot;)</span>
<span class="sd">    &#39;0:10:00&#39;</span>

<span class="sd">    &gt;&gt;&gt; get_recommended_test_time(&quot;TESTRUNPASS_P69.f19_g16_rx1.A.melvin_gnu.testmod&quot;)</span>
<span class="sd">    &#39;0:13:00&#39;</span>

<span class="sd">    &gt;&gt;&gt; get_recommended_test_time(&quot;PET_Ln20.ne30_ne30.FC5.sandiatoss3_intel.cam-outfrq9s&quot;)</span>
<span class="sd">    &gt;&gt;&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">best_time</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">suites</span> <span class="o">=</span> <span class="n">get_test_suites</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">suite</span> <span class="ow">in</span> <span class="n">suites</span><span class="p">:</span>
        <span class="n">rec_time</span> <span class="o">=</span> <span class="n">get_test_data</span><span class="p">(</span><span class="n">suite</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">suite_has_test</span><span class="p">(</span><span class="n">suite</span><span class="p">,</span> <span class="n">test_full_name</span><span class="p">,</span> <span class="n">skip_inherit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">rec_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="p">(</span>
                <span class="n">best_time</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="ow">or</span> <span class="n">convert_to_seconds</span><span class="p">(</span><span class="n">rec_time</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">convert_to_seconds</span><span class="p">(</span><span class="n">best_time</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">):</span>
            <span class="n">best_time</span> <span class="o">=</span> <span class="n">rec_time</span>

    <span class="k">return</span> <span class="n">best_time</span></div>


<span class="c1">###############################################################################</span>
<div class="viewcode-block" id="key_test_time"><a class="viewcode-back" href="../../CIME_api/CIME.html#CIME.get_tests.key_test_time">[docs]</a><span class="k">def</span> <span class="nf">key_test_time</span><span class="p">(</span><span class="n">test_full_name</span><span class="p">):</span>
    <span class="c1">###############################################################################</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">get_recommended_test_time</span><span class="p">(</span><span class="n">test_full_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">99999999</span> <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">convert_to_seconds</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017, U.S. National Science Foundation and U.S. Department of Energy.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
     
<script>var version_json_loc = "../../../../versions.json";</script>


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>