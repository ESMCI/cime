

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>10. Workflows &mdash; CIME master documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=30d551ce"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="11. Directory content" href="cime-dir.html" />
    <link rel="prev" title="9. Multi-instance component functionality" href="multi-instance.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            CIME
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../what_cime/index.html">What is CIME?</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html">Using the Case Control System</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html#configuring-the-case-control-system">Configuring the Case Control System</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="cime-internals.html">1. Main Configuration File</a></li>
<li class="toctree-l2"><a class="reference internal" href="components.html">2. Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="compsets.html">3. Component sets</a></li>
<li class="toctree-l2"><a class="reference internal" href="grids.html">4. Model grids</a></li>
<li class="toctree-l2"><a class="reference internal" href="machine.html">5. Defining the machine</a></li>
<li class="toctree-l2"><a class="reference internal" href="pes-threads.html">6. Controlling processors and threads</a></li>
<li class="toctree-l2"><a class="reference internal" href="porting-cime.html">7. Porting and validating CIME on a new platform</a></li>
<li class="toctree-l2"><a class="reference internal" href="unit_testing.html">8. Fortran Unit Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="multi-instance.html">9. Multi-instance component functionality</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">10. Workflows</a></li>
<li class="toctree-l2"><a class="reference internal" href="cime-dir.html">11. Directory content</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#indices-and-tables">Indices and tables</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../build_cpl/index.html">Building a Coupled Model with CIME</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc_tools/index.html">Miscellaneous Tools</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../glossary/index.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tools_user/index.html">User Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../xml_files/index.html">XML Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CIME_api/modules.html">CIME</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tools_api/modules.html">Tools</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">CIME</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Using the Case Control System</a></li>
      <li class="breadcrumb-item active"><span class="section-number">10. </span>Workflows</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/users_guide/workflows.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="workflows">
<span id="id1"></span><h1><span class="section-number">10. </span>Workflows<a class="headerlink" href="#workflows" title="Link to this heading"></a></h1>
<p>Currently, there are three kinds of workflow controls available in CIME.</p>
<ol class="arabic">
<li><p>Multiple jobs workflow</p>
<p>The file, <strong>$CIMEROOT/config/$model/machines/config_batch.xml</strong>, contains a section called <code class="docutils literal notranslate"><span class="pre">&lt;batch_jobs&gt;</span></code> which defines the submit script templates and the pre-requisites for running them.
As an example, in cesm, the default <code class="docutils literal notranslate"><span class="pre">&lt;batch_jobs&gt;</span></code> section is the following, with an explanation give by the NOTES additions.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;batch_jobs&gt;
   &lt;!-- order matters, with no-batch jobs will be run in the order listed here --&gt;
   &lt;job name=&quot;case.run&quot;&gt;
     &lt;template&gt;template.case.run&lt;/template&gt;
     &lt;prereq&gt;$BUILD_COMPLETE and not $TEST&lt;/prereq&gt;
   &lt;/job&gt;
   &lt;job name=&quot;case.test&quot;&gt;
      &lt;template&gt;template.case.test&lt;/template&gt;
      &lt;prereq&gt;$BUILD_COMPLETE and $TEST&lt;/prereq&gt;
   &lt;/job&gt;
   &lt;job name=&quot;case.st_archive&quot;&gt;
      &lt;template&gt;template.st_archive&lt;/template&gt;
      &lt;task_count&gt;1&lt;/task_count&gt;
      &lt;walltime&gt;0:20:00&lt;/walltime&gt;
      &lt;!-- If DOUT_S is true and case.run (or case.test) exits successfully then run st_archive--&gt;
      &lt;dependency&gt;case.run or case.test&lt;/dependency&gt;
      &lt;prereq&gt;$DOUT_S&lt;/prereq&gt;
   &lt;/job&gt;
&lt;/batch_jobs&gt;
</pre></div>
</div>
<p>The elements that can be contained in the <code class="docutils literal notranslate"><span class="pre">&lt;batch_jobs&gt;</span></code> section are:</p>
<ul class="simple">
<li><p>&lt;job name=”NAME”&gt; : the name of the batch job.</p></li>
</ul>
<p>Batch jobs can contain one or more jobs, and each job has the following elements:</p>
<ul class="simple">
<li><p>&lt;template&gt; : required, the associated template that is used to create the job.</p></li>
<li><p>&lt;prepreq&gt; : required, the pre-requiste settings of xml variables that determine whether the job will be run.</p></li>
<li><p>&lt;task_count&gt; : optional, the number of tasks the job should use.</p></li>
<li><p>&lt;walltime&gt; : optional, the maximum walltime the job should require.</p></li>
<li><p>&lt;dependency&gt; : optional, the previous job expected to complete before this job can start.</p></li>
</ul>
<p>In the above the scripts for each <code class="docutils literal notranslate"><span class="pre">&lt;job&gt;</span></code> entry,
i.e. <code class="docutils literal notranslate"><span class="pre">case.run</span></code>, <code class="docutils literal notranslate"><span class="pre">case.test</span></code> and <code class="docutils literal notranslate"><span class="pre">case.st_archive</span></code> are
created from their respective templates the corresponding
<code class="docutils literal notranslate"><span class="pre">&lt;template&gt;</span></code> entry. The templates are located in the
<strong>$CIMEROOT/config/$model/machines</strong> directory.</p>
<p>Furthermore, in the above <code class="docutils literal notranslate"><span class="pre">case.run</span></code> will be run if the xml
variables <code class="docutils literal notranslate"><span class="pre">BUILD_COMPLETE</span></code> is true and <code class="docutils literal notranslate"><span class="pre">TEST</span></code> is false.  On the
other hand, if <code class="docutils literal notranslate"><span class="pre">BUILD_COMPLETE</span></code> is true and <code class="docutils literal notranslate"><span class="pre">TEST</span></code> is true then
<code class="docutils literal notranslate"><span class="pre">case.test</span></code> will be run.  In addition, if <code class="docutils literal notranslate"><span class="pre">DOUT_S</span></code> is true,
then <code class="docutils literal notranslate"><span class="pre">case.st_archive</span></code> will be run <strong>after</strong> either <code class="docutils literal notranslate"><span class="pre">case.run</span></code>
or <code class="docutils literal notranslate"><span class="pre">case.test</span></code> successfully completes. Also note that
<code class="docutils literal notranslate"><span class="pre">case.st_archive</span></code> is a separate job that only requests a single
task.</p>
<p>Users can extend the above workflow with their own custom needs.</p>
</li>
<li><p>Pre-run and post-run script</p>
<p>CIME provides the ability to execute user-defined scripts during
the execution of <code class="docutils literal notranslate"><span class="pre">case.run</span></code>. These user-defined scripts can be
invoked either before and/or after the model is run. The xml variables that controls this capability are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">PRERUN_SCRIPT</span></code>: points to an external script to be run before model execution.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">POSTRUN_SCRIPT</span></code>: points to an external script to be run after successful model completion.</p></li>
</ul>
<p>Note, that when these scripts are called, the full processor allocation for the job will be used - even if only 1 processor actually is invoked for the external script.</p>
</li>
<li><p>Data assimilation controls</p></li>
</ol>
<blockquote>
<div><p>CIME provides the ability to hook in a data assimilation utility via a set of xml variables:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">DATA_ASSIMILATION_SCRIPT</span></code>:  points to an external script to be run <strong>after</strong> model completion</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DATA_ASSIMILATION_CYCLES</span></code>: integer that controls the number of data assimilation cycles. The run script
will loop over these number of data assimilation cycles and for each cycle will run the model and subsequently run the data assimilation script.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DATA_ASSIMILATION</span></code>: if set to TRUE for a given component, then
a resume signal will be sent to that component at
initialization. If set, the component will execute special post
data assimilation logic on initialization.  See the component
documentation for details. This flag is a bit subtle in that it is a per-component flag, not a model wide flag.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">To</span> <span class="n">see</span> <span class="n">what</span> <span class="n">the</span> <span class="n">component</span> <span class="n">flags</span> <span class="n">are</span> <span class="n">call</span>
 <span class="o">&gt;</span> <span class="o">./</span><span class="n">xmlquery</span> <span class="n">DATA_ASSIMILATION</span>

<span class="n">The</span> <span class="n">output</span> <span class="n">will</span> <span class="n">look</span> <span class="n">like</span>
 <span class="o">&gt;</span>   <span class="n">DATA_ASSIMILATION</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;CPL:FALSE&#39;</span><span class="p">,</span> <span class="s1">&#39;ATM:TRUE&#39;</span><span class="p">,</span> <span class="s1">&#39;LND:FALSE&#39;</span><span class="p">,</span> <span class="s1">&#39;ICE:FALSE&#39;</span><span class="p">,</span> <span class="s1">&#39;OCN:FALSE&#39;</span><span class="p">,</span> <span class="s1">&#39;ROF:FALSE&#39;</span><span class="p">,</span> <span class="s1">&#39;GLC:FALSE&#39;</span><span class="p">,</span> <span class="s1">&#39;WAV:FALSE&#39;</span><span class="p">]</span>

 <span class="n">To</span> <span class="n">change</span> <span class="n">the</span> <span class="n">LND</span> <span class="n">value</span> <span class="n">to</span> <span class="n">TRUE</span> <span class="n">issue</span>
 <span class="o">&gt;</span> <span class="o">./</span><span class="n">xmlchange</span> <span class="n">DATA_ASSIMILATION_LND</span><span class="o">=</span><span class="n">TRUE</span>
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="multi-instance.html" class="btn btn-neutral float-left" title="9. Multi-instance component functionality" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="cime-dir.html" class="btn btn-neutral float-right" title="11. Directory content" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017, U.S. National Science Foundation and U.S. Department of Energy.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
     
<script>var version_json_loc = "../../../versions.json";</script>


</footer>
        </div>
      </div>
    </section>
  </div>
  

  <script type="text/javascript">
    let baseUriRegex = /(.*\/cime)\/.*/g;
    let parsedUri = baseUriRegex.exec(document.baseURI);

    if (parsedUri != null && parsedUri.length == 2) {
      let baseUri = parsedUri[1];

      $.get(`${baseUri}/versions/versions.json`, function(data) {
        let versionElement = $("#versions");

        Object.keys(data).forEach(function(key) {
          let value = data[key];

          let item = `<dd><a href="${baseUri}/versions/${key}/html/">${value}</a></dd>`

          versionElement.append(item);
        });
      });
    }
  </script>
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: master
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <dl id="versions">
        <dt>Versions</dt>
      </dl>
      
      
    </div>
  </div>
<script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>