

<!doctype html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>4. Troubleshooting &#8212; on  documentation</title>
    
    <link rel="stylesheet" href="../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="5. FAQ" href="faq/faq.html" />
    <link rel="prev" title="3. Adding new cases" href="adding-cases.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="faq/faq.html" title="5. FAQ"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="adding-cases.html" title="3. Adding new cases"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">on  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">CIME User&#8217;s Guide Part 1: Basic Use</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">4. Troubleshooting</a><ul>
<li><a class="reference internal" href="#troubleshooting-case-creation">4.1. Troubleshooting case creation</a></li>
<li><a class="reference internal" href="#troubleshooting-job-submission">4.2. Troubleshooting job submission</a></li>
<li><a class="reference internal" href="#troubleshooting-run-time-problems">4.3. Troubleshooting run-time problems</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="adding-cases.html"
                        title="previous chapter">3. Adding new cases</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="faq/faq.html"
                        title="next chapter">5. FAQ</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/users_guide/troubleshooting.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="troubleshooting">
<span id="id1"></span><h1>4. Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h1>
<div class="section" id="troubleshooting-case-creation">
<h2>4.1. Troubleshooting case creation<a class="headerlink" href="#troubleshooting-case-creation" title="Permalink to this headline">¶</a></h2>
<p>Generally, <strong>create_newcase</strong> errors are reported to the terminal and should provide some guidance about what caused the error.</p>
<p>If <strong>create_newcase</strong> fails on a relatively generic error, first check carefully that the command line arguments match the interfaces specification. Type:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">create_newcase</span> <span class="o">--</span><span class="n">help</span>
</pre></div>
</div>
<p>and review usage.</p>
</div>
<div class="section" id="troubleshooting-job-submission">
<h2>4.2. Troubleshooting job submission<a class="headerlink" href="#troubleshooting-job-submission" title="Permalink to this headline">¶</a></h2>
<p>Most of the problems associated with submission or launch are very site specific.
The batch and run aspects of the <code class="docutils literal"><span class="pre">case.submit</span></code> script is created by parsing the xml variables in <code class="docutils literal"><span class="pre">$CASEROOT/env_batch.xml</span></code>.</p>
<p>First, review the batch submission options being used. These are found in <code class="docutils literal"><span class="pre">$CASEROOT/env_batch.xml</span></code>.
Confirm that the options are consistent with the site specific batch environment, and that the queue names, time limits, and hardware processor request makes sense and is consistent with the case running.</p>
<p>Second, make sure that <code class="docutils literal"><span class="pre">case.submit</span></code> submits the script <code class="docutils literal"><span class="pre">case.run</span></code> with the correct batch job submission tool, whether that&#8217;s qsub, bsub, or something else, and for instance, whether a redirection &#8220;&lt;&#8221; character is required or not.
The information for how <code class="docutils literal"><span class="pre">case.submit</span></code> submit jobs appears at the end of the standard output stream.</p>
</div>
<div class="section" id="troubleshooting-run-time-problems">
<h2>4.3. Troubleshooting run-time problems<a class="headerlink" href="#troubleshooting-run-time-problems" title="Permalink to this headline">¶</a></h2>
<p>To check that a run completed successfully, check the last several lines of the cpl.log file for the string <code class="docutils literal"><span class="pre">SUCCESSFUL</span> <span class="pre">TERMINATION</span> <span class="pre">OF</span> <span class="pre">CPL7-CCSM</span></code>. A successful job also usually copies the log files to the directory $CASEROOT/logs.</p>
<p><strong>Note</strong>: The first things to check if a job fails are:
- whether the model timed out
- whether a disk quota limit was hit
- whether a machine went down,
- whether a file system became full.</p>
<p>If any of those things happened, take appropriate corrective action and resubmit the job.</p>
<p>If it is not clear any of the above caused a case to fail, then there are several places to look for error messages.</p>
<ul class="simple">
<li>Check component log files in <code class="docutils literal"><span class="pre">$RUNDIR</span></code>.
This directory is set in the <code class="docutils literal"><span class="pre">env_run.xml</span></code> and is where the model is run.
Each component writes its own log file, and there should be log files there for every component (i.e. of the form cpl.log.yymmdd-hhmmss).
Check log file for each component for an error message, especially at the end or near the end of each file.</li>
<li>Check for a standard out and/or standard error file in <code class="docutils literal"><span class="pre">$CASEROOT</span></code>.
The standard out/err file often captures a significant amount of extra model output and also often contains significant system output when the job terminates.
Sometimes, a useful error message can be found well above the bottom of a large standard out/err file.
Backtrack from the bottom in search of an error message.</li>
<li>Check for core files in $RUNDIR and review them using an appropriate tool.</li>
<li>Check any automated email from the job about why a job failed. This is sent by the batch scheduler and is a site specific feature that may or may not exist.</li>
<li>Check the archive directory.
If a case failed, the log files or data may still have been archived.
The archiver is turned on if DOUT_S is set to TRUE in env_run.xml.
The archive directory is set by the env variable DOUT_S_ROOT and the directory to check is $DOUT_S_ROOT/$CASE.</li>
</ul>
<p>A common error is for the job to time out which often produces minimal error messages.
By reviewing the daily model date stamps in the cpl.log file and the time stamps of files in the $RUNDIR directory, there should be enough information to deduce the start and stop time of a run.
If the model was running fine, but the batch wall limit was reached, either reduce the run length or increase the batch time limit request.
If the model hangs and then times out, that&#8217;s usually indicative of either a system problem (an MPI or file system problem) or possibly a model problem.
If a system problem is suspected, try to resubmit the job to see if an intermittent problem occurred.
Also send help to local site consultants to provide them with feedback about system problems and to get help.</p>
<p>Another error that can cause a timeout is a slow or intermittently slow node.
The cpl.log file normally outputs the time used for every model simulation day. To review that data, grep the cpl.log file for the string, tStamp</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">grep</span> <span class="n">tStamp</span> <span class="n">cpl</span><span class="o">.</span><span class="n">log</span><span class="o">.*</span> <span class="o">|</span> <span class="n">more</span>
</pre></div>
</div>
<p>which gives output that looks like this::</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">tStamp_write</span><span class="p">:</span> <span class="n">model</span> <span class="n">date</span> <span class="o">=</span> <span class="mi">10120</span> <span class="mi">0</span> <span class="n">wall</span> <span class="n">clock</span> <span class="o">=</span> <span class="mi">2009</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">28</span> <span class="mi">09</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">46</span> <span class="n">avg</span> <span class="n">dt</span> <span class="o">=</span> <span class="mf">58.58</span> <span class="n">dt</span> <span class="o">=</span> <span class="mf">58.18</span>
<span class="n">tStamp_write</span><span class="p">:</span> <span class="n">model</span> <span class="n">date</span> <span class="o">=</span> <span class="mi">10121</span> <span class="mi">0</span> <span class="n">wall</span> <span class="n">clock</span> <span class="o">=</span> <span class="mi">2009</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">28</span> <span class="mi">09</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">32</span> <span class="n">avg</span> <span class="n">dt</span> <span class="o">=</span> <span class="mf">60.10</span> <span class="n">dt</span> <span class="o">=</span> <span class="mf">105.90</span>
</pre></div>
</div>
<p>Review the run times for each model day.
These are indicated at the end of each line.
The &#8220;avg dt = &#8221; is the running average time to simulate a model day in the current run and &#8220;dt = &#8221; is the time needed to simulate the latest model day.
The model date is printed in YYYYMMDD format and the wall clock is the local date and time.
So in this case 10120 is Jan 20, 0001, and it took 58 seconds to run that day.
The next day, Jan 21, took 105.90 seconds.
If a wide variation in the simulation time is observed for typical mid-month model days, then that is suggestive of a system problem.
However, be aware that there are variations in the cost of the model over time.
For instance, on the last day of every simulated month, the model will typically write netcdf files, and this can be a significant intermittent cost.
Also, some model configurations read data mid- month or run physics intermittently at a timestep longer than one day.
In those cases, some run time variability would be observed and it would be caused by CESM1, not system variability.
With system performance variability, the time variation is typically quite erratic and unpredictable.</p>
<p>Sometimes when a job times out, or it overflows disk space, the restart files will get mangled.
With the exception of the CAM and CLM history files, all the restart files have consistent sizes.
Compare the restart files against the sizes of a previous restart.
If they don&#8217;t match, then remove them and move the previous restart into place before resubmitting the job.
Please see <a class="reference external" href="http://www.cesm.ucar.edu/models/cesm2.0/external-link-here">restarting a run</a>.</p>
<p>On HPC systems, it is not completely uncommon for nodes to fail or for access to large file systems to hang.
Please make sure a case fails consistently in the same place before filing a bug report.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="faq/faq.html" title="5. FAQ"
             >next</a> |</li>
        <li class="right" >
          <a href="adding-cases.html" title="3. Adding new cases"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">on  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >CIME User&#8217;s Guide Part 1: Basic Use</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Mariana Vertenstein, Rob Jacob, Jim Edwards, Jim Foucar, Alice Bertini.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.2.
    </div>
  </body>
</html>