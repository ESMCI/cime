<?xml version="1.0"?>

<config_test>

  <test NAME="APT">
    <DESC>auto promotion test (to be deleted)</DESC>
    <INFO_DBUG>1</INFO_DBUG>
    <CCSM_TCOST>0</CCSM_TCOST>
    <DOUT_S>FALSE</DOUT_S>
  </test>

  <test NAME="CME">
    <DESC>compare mct and esmf interfaces (default is 10 days for each)</DESC>
    <COMP_INTERFACE>MCT</COMP_INTERFACE>
    <USE_ESMF_LIB>TRUE</USE_ESMF_LIB>
    <STOP_OPTION>ndays</STOP_OPTION>
    <STOP_N>10</STOP_N>
    <REST_OPTION>none</REST_OPTION>
    <INFO_DBUG>1</INFO_DBUG>
    <CCSM_TCOST>4</CCSM_TCOST>
    <DOUT_S>FALSE</DOUT_S>
  </test>

  <test NAME="ERI">
    <DESC>hybrid/branch/exact restart test, default 3+19/10+9/5+4 days</DESC>
    <INFO_DBUG>1</INFO_DBUG>
    <STOP_OPTION>ndays</STOP_OPTION>
    <STOP_N>22</STOP_N>
    <CCSM_TCOST>0</CCSM_TCOST>
    <DOUT_S>FALSE</DOUT_S>
    <GET_REFCASE>FALSE</GET_REFCASE>
    <BUILD phase="1"/>
    <RUN phase="1" clone="$CASEROOT.ref1">
      <STOP_N>$STOP_N / 6</STOP_N>
      <REST_N>$STOP_N</REST_N>
      <CONTINUE_RUN>FALSE</CONTINUE_RUN>
    </RUN>
    <RUN phase="2" clone="$CASEROOT.ref2">
      <STOP_N>$STOP_N - $STOP_N / 6</STOP_N>
      <REST_N>$STOP_N / 2 + 1</REST_N>
      <HIST_N>$STOP_N</HIST_N>
      <RUN_REFCASE>$CASEROOT.ref1</RUN_REFCASE>
      <RUN_TYPE>hybrid</RUN_TYPE>
      <RUN_STARTDATE>0003-01-01</RUN_STARTDATE>
    </RUN>
    <RUN phase="3">
      <CONTINUE_RUN>TRUE</CONTINUE_RUN>
      <RUN_TYPE>branch</RUN_TYPE>
      <RUN_REFCASE>$CASEROOT.ref2</RUN_REFCASE>
    </RUN>
  </test>

  <test NAME="ERP">
    <DESC>pes counts hybrid (open-MP/MPI) restart bfb test from startup, default 6 days + 5 days</DESC>
    <INFO_DBUG>1</INFO_DBUG>
    <BFBFLAG>TRUE</BFBFLAG>
    <CCSM_TCOST>1</CCSM_TCOST>
    <STOP_OPTION>ndays</STOP_OPTION>
    <STOP_N>11</STOP_N>
    <DOUT_S>FALSE</DOUT_S>
  </test>

  <test NAME="ERS">
    <DESC>exact restart from startup, default 6 days + 5 days</DESC>
    <INFO_DBUG>1</INFO_DBUG>
    <CCSM_TCOST>0</CCSM_TCOST>
    <STOP_OPTION>ndays</STOP_OPTION>
    <STOP_N>11</STOP_N>
    <DOUT_S>FALSE</DOUT_S>
    <REST_OPTION>$STOP_OPTION</REST_OPTION>
    <BUILD phase="1"/>
    <RUN phase="1">
      <REST_N>$STOP_N / 2 + 1</REST_N>
      <HIST_N>$STOP_N</HIST_N>
      <CONTINUE_RUN>FALSE</CONTINUE_RUN>
    </RUN>
    <RUN phase="2">
      <CONTINUE_RUN>TRUE</CONTINUE_RUN>
      <STOP_N>$STOP_N-$REST_N</STOP_N>
      <REST_OPTION>never</REST_OPTION>
      <HIST_OPTION>$STOP_OPTION</HIST_OPTION>
    </RUN>
  </test>

  <test NAME="ERR">
    <DESC>exact restart from startup with resubmit, default 4 days + 3 days</DESC>
    <INFO_DBUG>1</INFO_DBUG>
    <CCSM_TCOST>0</CCSM_TCOST>
    <STOP_OPTION>ndays</STOP_OPTION>
    <STOP_N>7</STOP_N>
    <DOUT_S>TRUE</DOUT_S>
    <!-- putting RESUBMIT in the BUILD stanza prevents this test running away
	 but also requires that you rebuild the test before you can run it a second time -->
    <BUILD phase="1">
      <RESUBMIT>1</RESUBMIT>
    </BUILD>
    <RUN phase="1">
      <REST_N>$STOP_N/2 + 1 </REST_N>
      <REST_OPTION>$STOP_OPTION</REST_OPTION>
    </RUN>
  </test>

  <test NAME="ERT">
    <DESC>exact restart from startup, default 2 month + 1 month (ERS with info dbug = 1)</DESC>
    <INFO_DBUG>1</INFO_DBUG>
    <CCSM_TCOST>0</CCSM_TCOST>
    <STOP_OPTION>nmonths</STOP_OPTION>
    <STOP_N></STOP_N>
    <AVGHIST_OPTION>nmonths</AVGHIST_OPTION>
    <AVGHIST_N>1</AVGHIST_N>
    <DOUT_S>FALSE</DOUT_S>
  </test>

  <test NAME="TESTBUILDFAIL">
    <DESC>For testing infra only. Insta-fail build step.</DESC>
    <BUILD phase="1">
      <eval>echo "ERROR: Intentional fail for testing infrastructure" | tee $EXEROOT/${MODEL}.bldlog.$TEST_TESTID</eval>
    </BUILD>
  </test>

  <test NAME="TESTRUNFAIL">
    <DESC>For testing infra only. Insta-fail run step.</DESC>
    <BUILD phase="1">
      <eval> echo "#! /bin/bash" > $EXEROOT/${MODEL}.exe </eval>
      <eval> echo "echo Insta fail" >> $EXEROOT/${MODEL}.exe</eval>
      <eval> echo -n "echo Insta fail > $RUNDIR/cpl.log." >> $EXEROOT/${MODEL}.exe </eval>
      <eval> echo '$LID' >> $EXEROOT/${MODEL}.exe </eval>
      <eval> echo "exit -1" >> $EXEROOT/${MODEL}.exe</eval>
      <eval> chmod +x $EXEROOT/${MODEL}.exe</eval>
      <BUILD_COMPLETE>TRUE</BUILD_COMPLETE>
      </BUILD>
      <RUN phase="1"/>
  </test>

  <test NAME="TESTRUNPASS">
    <DESC>For testing infra only. Insta-pass run step.</DESC>
    <BUILD phase="1">
      <eval> echo "#! /bin/bash" > $EXEROOT/${MODEL}.exe </eval>
      <eval> echo "echo Insta pass" >> $EXEROOT/${MODEL}.exe</eval>
      <eval> echo -n "echo SUCCESSFUL TERMINATION > $RUNDIR/cpl.log." >> $EXEROOT/${MODEL}.exe </eval>
      <eval> echo '$LID' >> $EXEROOT/${MODEL}.exe </eval>
      <eval> echo "exit 0" >> $EXEROOT/${MODEL}.exe </eval>
      <eval> chmod +x $EXEROOT/${MODEL}.exe</eval>
      <BUILD_COMPLETE>TRUE</BUILD_COMPLETE>
      </BUILD>
      <RUN phase="1"/>

  </test>

  <test NAME="TESTRUNDIFF">
    <DESC>For testing infra only. Produces a canned hist file.</DESC>
    <BUILD phase="1">
      <eval> echo "#! /bin/bash" > $EXEROOT/${MODEL}.exe </eval>
      <eval> echo "echo Insta pass" >> $EXEROOT/${MODEL}.exe</eval>
      <eval> echo -n "echo SUCCESSFUL TERMINATION > $RUNDIR/cpl.log." >> $EXEROOT/${MODEL}.exe </eval>
      <eval> echo '$LID' >> $EXEROOT/${MODEL}.exe </eval>
      <eval> echo "cp $CIMEROOT/utils/python/tests/cpl.hi1.nc.test $RUNDIR/$CASE.cpl.hi.0.nc.base" >> $EXEROOT/${MODEL}.exe</eval>
      <eval> echo "exit 0" >> $EXEROOT/${MODEL}.exe </eval>
      <eval> chmod +x $EXEROOT/${MODEL}.exe</eval>
      <BUILD_COMPLETE>TRUE</BUILD_COMPLETE>
      </BUILD>
    <!-- need two run phases to trigger compare tests -->
      <RUN phase="1"/>
      <RUN phase="2"/>
  </test>

  <test NAME="TESTRUNSLOWPASS">
    <DESC>For testing infra only. After 5 minutes of sleep, pass run step.</DESC>
    <INFO_DBUG>1</INFO_DBUG>
    <CCSM_TCOST>0</CCSM_TCOST>
    <STOP_OPTION>ndays</STOP_OPTION>
    <STOP_N>11</STOP_N>
    <CHECK_TIMING>FALSE</CHECK_TIMING>
    <DOUT_S>FALSE</DOUT_S>
  </test>

  <test NAME="ICP">
    <DESC>cice performance test</DESC>
    <INFO_DBUG>1</INFO_DBUG>
    <STOP_OPTION>ndays</STOP_OPTION>
    <STOP_N>0</STOP_N>
    <REST_OPTION>none</REST_OPTION>
    <COMP_RUN_BARRIERS>TRUE</COMP_RUN_BARRIERS>
    <TIMER_LEVEL>12</TIMER_LEVEL>
    <CCSM_TCOST>4</CCSM_TCOST>
    <DOUT_S>FALSE</DOUT_S>
  </test>

  <test NAME="LAR">
    <DESC>long term archive test</DESC>
    <INFO_DBUG>1</INFO_DBUG>
    <STOP_OPTION>nmonths</STOP_OPTION>
    <STOP_N></STOP_N>
    <CCSM_TCOST>4</CCSM_TCOST>
    <DOUT_L_MS>TRUE</DOUT_L_MS>
    <DOUT_S>TRUE</DOUT_S>
  </test>

  <test NAME="LII">
    <DESC>CLM initial condition interpolation test (requires configuration with non-blank finidat)</DESC>
    <INFO_DBUG>1</INFO_DBUG>
    <CCSM_TCOST>0</CCSM_TCOST>
    <REST_OPTION>none</REST_OPTION>
    <DOUT_S>FALSE</DOUT_S>
  </test>

  <test NAME="PEA">
    <DESC>single pe bfb test (default length)</DESC>
    <INFO_DBUG>1</INFO_DBUG>
    <REST_OPTION>never</REST_OPTION>
    <CCSM_TCOST>1</CCSM_TCOST>
    <DOUT_S>FALSE</DOUT_S>
  </test>

  <test NAME="PEM">
    <DESC>pes counts mpi bfb test (seq tests; default length)</DESC>
    <INFO_DBUG>1</INFO_DBUG>
    <BFBFLAG>TRUE</BFBFLAG>
    <REST_OPTION>never</REST_OPTION>
    <CCSM_TCOST>1</CCSM_TCOST>
    <DOUT_S>FALSE</DOUT_S>
  </test>

  <test NAME="PET">
    <DESC>openmp bfb test (seq tests; default length)</DESC>
    <INFO_DBUG>1</INFO_DBUG>
    <BFBFLAG>TRUE</BFBFLAG>
    <BUILD_THREADED>TRUE</BUILD_THREADED>
    <REST_OPTION>never</REST_OPTION>
    <CCSM_TCOST>1</CCSM_TCOST>
    <DOUT_S>FALSE</DOUT_S>
  </test>

  <test NAME="PFS">
    <DESC>performance test setup</DESC>
    <INFO_DBUG>1</INFO_DBUG>
    <STOP_OPTION>ndays</STOP_OPTION>
    <STOP_N>20</STOP_N>
    <REST_OPTION>none</REST_OPTION>
    <CCSM_TCOST>0</CCSM_TCOST>
    <DOUT_S>FALSE</DOUT_S>
    <BUILD phase="1"/>
    <RUN phase="1"/>
  </test>

  <test NAME="NCK">
    <DESC>multi-instance validation vs single instance (default length)</DESC>
    <INFO_DBUG>1</INFO_DBUG>
    <CCSM_TCOST>-1</CCSM_TCOST>
    <DOUT_S>FALSE</DOUT_S>
    <ROOTPE_ATM>0</ROOTPE_ATM>
    <ROOTPE_CPL>0</ROOTPE_CPL>
    <ROOTPE_OCN>0</ROOTPE_OCN>
    <ROOTPE_WAV>0</ROOTPE_WAV>
    <ROOTPE_GLC>0</ROOTPE_GLC>
    <ROOTPE_ICE>0</ROOTPE_ICE>
    <ROOTPE_ROF>0</ROOTPE_ROF>
    <ROOTPE_LND>0</ROOTPE_LND>
    <BUILD phase="1">
      <NINST_ATM>1</NINST_ATM>
      <NINST_OCN>1</NINST_OCN>
      <NINST_WAV>1</NINST_WAV>
      <NINST_GLC>1</NINST_GLC>
      <NINST_ICE>1</NINST_ICE>
      <NINST_ROF>1</NINST_ROF>
      <NINST_LND>1</NINST_LND>
      <NINST_BLD>0</NINST_BLD>
      <NTASKS_ATM>$NTASKS_ATM*2</NTASKS_ATM>
      <NTASKS_OCN>$NTASKS_OCN*2</NTASKS_OCN>
      <NTASKS_WAV>$NTASKS_WAV*2</NTASKS_WAV>
      <NTASKS_GLC>$NTASKS_GLC*2</NTASKS_GLC>
      <NTASKS_ICE>$NTASKS_ICE*2</NTASKS_ICE>
      <NTASKS_ROF>$NTASKS_ROF*2</NTASKS_ROF>
      <NTASKS_LND>$NTASKS_LND*2</NTASKS_LND>
      <EXEC_SE>${CIME_MODEL}.exe.1</EXEC_SE>
    </BUILD>
    <BUILD phase="2">
      <NINST_ATM>2</NINST_ATM>
      <NINST_OCN>2</NINST_OCN>
      <NINST_WAV>2</NINST_WAV>
      <NINST_GLC>2</NINST_GLC>
      <NINST_ICE>2</NINST_ICE>
      <NINST_ROF>2</NINST_ROF>
      <NINST_LND>2</NINST_LND>
      <NINST_BLD>0</NINST_BLD>
      <EXEC_SE>${CIME_MODEL}.exe.2</EXEC_SE>
    </BUILD>
    <RUN phase="1">
      <EXEC_SE>${CIME_MODEL}.exe.1</EXEC_SE>
    </RUN>
    <RUN phase="2">
      <EXEC_SE>${CIME_MODEL}.exe.2</EXEC_SE>
    </RUN>


  </test>

  <test NAME="NCR">
    <DESC>multi-instance validation sequential vs concurrent (default length)</DESC>
    <INFO_DBUG>1</INFO_DBUG>
    <CCSM_TCOST>-1</CCSM_TCOST>
    <DOUT_S>FALSE</DOUT_S>
  </test>

  <test NAME="NOC">
    <DESC>multi-instance validation for single instance ocean (default length)</DESC>
    <INFO_DBUG>1</INFO_DBUG>
    <CCSM_TCOST>-1</CCSM_TCOST>
    <DOUT_S>FALSE</DOUT_S>
  </test>

  <test NAME="OCP">
    <DESC>pop performance test</DESC>
    <INFO_DBUG>1</INFO_DBUG>
    <STOP_OPTION>ndays</STOP_OPTION>
    <STOP_N>10</STOP_N>
    <REST_OPTION>none</REST_OPTION>
    <COMP_RUN_BARRIERS>TRUE</COMP_RUN_BARRIERS>
    <TIMER_LEVEL>12</TIMER_LEVEL>
    <CCSM_TCOST>4</CCSM_TCOST>
    <DOUT_S>FALSE</DOUT_S>
  </test>

  <test NAME="PMT">
    <DESC>modified-task/modified-thread count BFB test </DESC>
    <INFO_DBUG>1</INFO_DBUG>
    <STOP_OPTION>ndays</STOP_OPTION>
    <STOP_N>10</STOP_N>
    <REST_OPTION>none</REST_OPTION>
    <TIMER_LEVEL>12</TIMER_LEVEL>
    <CCSM_TCOST>4</CCSM_TCOST>
    <DOUT_S>FALSE</DOUT_S>
  </test>

  <test NAME="SBN">
    <DESC>smoke build-namelist test (just run preview_namelist and check_input_data)</DESC>
    <INFO_DBUG>1</INFO_DBUG>
    <CCSM_TCOST>-1</CCSM_TCOST>
    <DOUT_S>FALSE</DOUT_S>
  </test>

  <test NAME="SEQ">
    <DESC>sequencing bfb test (10 day seq,conc tests)</DESC>
    <INFO_DBUG>1</INFO_DBUG>
    <STOP_OPTION>ndays</STOP_OPTION>
    <STOP_N>10</STOP_N>
    <REST_OPTION>never</REST_OPTION>
    <CCSM_TCOST>0</CCSM_TCOST>
    <DOUT_S>FALSE</DOUT_S>
    <ROOTPE_ATM>0</ROOTPE_ATM>
    <ROOTPE_CPL>2</ROOTPE_CPL>
    <ROOTPE_OCN>4</ROOTPE_OCN>
    <ROOTPE_WAV>6</ROOTPE_WAV>
    <ROOTPE_GLC>8</ROOTPE_GLC>
    <ROOTPE_ICE>10</ROOTPE_ICE>
    <ROOTPE_ROF>12</ROOTPE_ROF>
    <ROOTPE_LND>14</ROOTPE_LND>
    <NTASKS_ATM>2</NTASKS_ATM>
    <NTASKS_CPL>2</NTASKS_CPL>
    <NTASKS_OCN>2</NTASKS_OCN>
    <NTASKS_WAV>2</NTASKS_WAV>
    <NTASKS_GLC>2</NTASKS_GLC>
    <NTASKS_ICE>2</NTASKS_ICE>
    <NTASKS_ROF>2</NTASKS_ROF>
    <NTASKS_LND>2</NTASKS_LND>
    <BUILD phase="1"/>
    <RUN phase="1">
      <HIST_N>$STOP_N</HIST_N>
      <HIST_OPTION>$STOP_OPTION</HIST_OPTION>
    </RUN>
    <RUN phase="2">
      <ROOTPE_ATM>0</ROOTPE_ATM>
      <ROOTPE_CPL>0</ROOTPE_CPL>
      <ROOTPE_OCN>0</ROOTPE_OCN>
      <ROOTPE_WAV>0</ROOTPE_WAV>
      <ROOTPE_GLC>0</ROOTPE_GLC>
      <ROOTPE_ICE>0</ROOTPE_ICE>
      <ROOTPE_ROF>0</ROOTPE_ROF>
      <ROOTPE_LND>0</ROOTPE_LND>
      </RUN>
  </test>

  <test NAME="SMS">
    <DESC>startup smoke test (default length)</DESC>
    <INFO_DBUG>1</INFO_DBUG>
    <CCSM_TCOST>-1</CCSM_TCOST>
    <DOUT_S>FALSE</DOUT_S>
    <BUILD phase="1"/>
    <RUN phase="1">
      <CONTINUE_RUN>FALSE</CONTINUE_RUN>
      <REST_OPTION>none</REST_OPTION>
      <HIST_OPTION>$STOP_OPTION</HIST_OPTION>
      <HIST_N>$STOP_N</HIST_N>
    </RUN>
  </test>

  <test NAME="SSP">
    <DESC>smoke CLM spinup test (only valid for CLM compsets with CLM45 and CN or BGC)</DESC>
    <INFO_DBUG>1</INFO_DBUG>
    <CCSM_TCOST>-1</CCSM_TCOST>
    <STOP_OPTION>ndays</STOP_OPTION>
    <RUN_TYPE>startup</RUN_TYPE>
    <STOP_N>4</STOP_N>
    <DOUT_S>FALSE</DOUT_S>
  </test>

  <test NAME="STA">
    <DESC>Short-term archiving restart test</DESC>
    <INFO_DBUG>1</INFO_DBUG>
    <CCSM_TCOST>-1</CCSM_TCOST>
    <DOUT_S>FALSE</DOUT_S>
  </test>

</config_test>
