! DON'T MODIFY THIS FILE, ALL YOUR CHANGES WILL BE LOST
! This file is generated by ../../../tests/general/util/pio_tf_f90gen.pl
! from /home/ed/tmp/ParallelIO/tests/general/ncdf_simple_tests.F90.in

MODULE ncdf_simple_tests_tgv   ! ncdf_simple_tests.F90.in:1
  use pio_tutil   ! ncdf_simple_tests.F90.in:2
  ! tgv in prefix corresponds to module name (ncdf_simple_tests_tgv)
  character(len=PIO_TF_MAX_STR_LEN), parameter :: tgv_fname = "pio_ncdf_test_file.nc"   ! ncdf_simple_tests.F90.in:4
  integer :: tgv_iotype   ! ncdf_simple_tests.F90.in:5
END MODULE ncdf_simple_tests_tgv   ! ncdf_simple_tests.F90.in:6


SUBROUTINE test_clobber
  USE pio_tutil
   ! ncdf_simple_tests.F90.in:8
  use ncdf_simple_tests_tgv   ! ncdf_simple_tests.F90.in:9
  Implicit none   ! ncdf_simple_tests.F90.in:10
  type(file_desc_t) :: pio_file   ! ncdf_simple_tests.F90.in:11
  character(len=PIO_TF_MAX_STR_LEN), parameter :: clob_fname = "pio_test_clobber.nc"   ! ncdf_simple_tests.F90.in:12
  integer :: ret   ! ncdf_simple_tests.F90.in:13


  ! Default is NOCLOBBER
  ret = PIO_createfile(pio_tf_iosystem_, pio_file, tgv_iotype, clob_fname)   ! ncdf_simple_tests.F90.in:16
  
  IF (.NOT. (PIO_TF_Passert_((ret) == PIO_NOERR, pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: PIO Function failed:",&
         "Failed to create:" // trim(clob_fname),&
        ":", __FILE__, ":", __LINE__,&
        "(ncdf_simple_tests.F90.in:17)"
    END IF
    RETURN
  END IF   ! ncdf_simple_tests.F90.in:17


  call PIO_closefile(pio_file)   ! ncdf_simple_tests.F90.in:19


  ! Recrate with CLOBBER option - should erase existing file and create new one
  ret = PIO_createfile(pio_tf_iosystem_, pio_file, tgv_iotype, clob_fname, PIO_CLOBBER)   ! ncdf_simple_tests.F90.in:22
  
  IF (.NOT. (PIO_TF_Passert_((ret) == PIO_NOERR, pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: PIO Function failed:",&
         "Failed to create (with CLOBBER):" // trim(clob_fname),&
        ":", __FILE__, ":", __LINE__,&
        "(ncdf_simple_tests.F90.in:23)"
    END IF
    RETURN
  END IF   ! ncdf_simple_tests.F90.in:23


  call PIO_closefile(pio_file)   ! ncdf_simple_tests.F90.in:25
  call PIO_deletefile(pio_tf_iosystem_, clob_fname)   ! ncdf_simple_tests.F90.in:26


END SUBROUTINE test_clobber   ! ncdf_simple_tests.F90.in:28


SUBROUTINE test_redef_enddef
  USE pio_tutil
   ! ncdf_simple_tests.F90.in:30
  use ncdf_simple_tests_tgv   ! ncdf_simple_tests.F90.in:31
  Implicit none   ! ncdf_simple_tests.F90.in:32
  type(file_desc_t) :: pio_file   ! ncdf_simple_tests.F90.in:33
  integer :: ret   ! ncdf_simple_tests.F90.in:34


  ret = PIO_openfile(pio_tf_iosystem_, pio_file, tgv_iotype, tgv_fname, PIO_write)   ! ncdf_simple_tests.F90.in:36
  
  IF (.NOT. (PIO_TF_Passert_((ret) == PIO_NOERR, pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: PIO Function failed:",&
         "Failed to open:" // trim(tgv_fname),&
        ":", __FILE__, ":", __LINE__,&
        "(ncdf_simple_tests.F90.in:37)"
    END IF
    RETURN
  END IF   ! ncdf_simple_tests.F90.in:37


  ! A simple redef and then enddef
  ret = PIO_redef(pio_file)   ! ncdf_simple_tests.F90.in:40
  
  IF (.NOT. (PIO_TF_Passert_((ret) == PIO_NOERR, pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: PIO Function failed:",&
         "Failed to redef:" // trim(tgv_fname),&
        ":", __FILE__, ":", __LINE__,&
        "(ncdf_simple_tests.F90.in:41)"
    END IF
    RETURN
  END IF   ! ncdf_simple_tests.F90.in:41


  ret = PIO_enddef(pio_file)   ! ncdf_simple_tests.F90.in:43
  
  IF (.NOT. (PIO_TF_Passert_((ret) == PIO_NOERR, pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: PIO Function failed:",&
         "Failed to enddef:" // trim(tgv_fname),&
        ":", __FILE__, ":", __LINE__,&
        "(ncdf_simple_tests.F90.in:44)"
    END IF
    RETURN
  END IF   ! ncdf_simple_tests.F90.in:44


  call PIO_closefile(pio_file)   ! ncdf_simple_tests.F90.in:46


END SUBROUTINE test_redef_enddef   ! ncdf_simple_tests.F90.in:48


SUBROUTINE test_def_dim
  USE pio_tutil
   ! ncdf_simple_tests.F90.in:50
  use ncdf_simple_tests_tgv   ! ncdf_simple_tests.F90.in:51
  Implicit none   ! ncdf_simple_tests.F90.in:52
  type(file_desc_t) :: pio_file   ! ncdf_simple_tests.F90.in:53
  integer :: pio_dim   ! ncdf_simple_tests.F90.in:54
  integer :: ret   ! ncdf_simple_tests.F90.in:55


  ret = PIO_openfile(pio_tf_iosystem_, pio_file, tgv_iotype, tgv_fname, PIO_write)   ! ncdf_simple_tests.F90.in:57
  
  IF (.NOT. (PIO_TF_Passert_((ret) == PIO_NOERR, pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: PIO Function failed:",&
         "Failed to open:" // trim(tgv_fname),&
        ":", __FILE__, ":", __LINE__,&
        "(ncdf_simple_tests.F90.in:58)"
    END IF
    RETURN
  END IF   ! ncdf_simple_tests.F90.in:58


  ! A simple redef and then enddef
  ret = PIO_redef(pio_file)   ! ncdf_simple_tests.F90.in:61
  
  IF (.NOT. (PIO_TF_Passert_((ret) == PIO_NOERR, pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: PIO Function failed:",&
         "Failed to redef:" // trim(tgv_fname),&
        ":", __FILE__, ":", __LINE__,&
        "(ncdf_simple_tests.F90.in:62)"
    END IF
    RETURN
  END IF   ! ncdf_simple_tests.F90.in:62


  ret = PIO_def_dim(pio_file, 'dummy_dim_def_dim', 100, pio_dim)   ! ncdf_simple_tests.F90.in:64
  
  IF (.NOT. (PIO_TF_Passert_((ret) == PIO_NOERR, pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: PIO Function failed:",&
         "Failed to define dim:" // trim(tgv_fname),&
        ":", __FILE__, ":", __LINE__,&
        "(ncdf_simple_tests.F90.in:65)"
    END IF
    RETURN
  END IF   ! ncdf_simple_tests.F90.in:65


  ret = PIO_enddef(pio_file)   ! ncdf_simple_tests.F90.in:67
  
  IF (.NOT. (PIO_TF_Passert_((ret) == PIO_NOERR, pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: PIO Function failed:",&
         "Failed to enddef:" // trim(tgv_fname),&
        ":", __FILE__, ":", __LINE__,&
        "(ncdf_simple_tests.F90.in:68)"
    END IF
    RETURN
  END IF   ! ncdf_simple_tests.F90.in:68


  call PIO_closefile(pio_file)   ! ncdf_simple_tests.F90.in:70


END SUBROUTINE test_def_dim   ! ncdf_simple_tests.F90.in:72


SUBROUTINE test_def_var
  USE pio_tutil
   ! ncdf_simple_tests.F90.in:74
  use ncdf_simple_tests_tgv   ! ncdf_simple_tests.F90.in:75
  Implicit none   ! ncdf_simple_tests.F90.in:76
  type(file_desc_t) :: pio_file   ! ncdf_simple_tests.F90.in:77
  type(var_desc_t)  :: pio_var   ! ncdf_simple_tests.F90.in:78
  integer :: pio_dim   ! ncdf_simple_tests.F90.in:79
  integer :: ret   ! ncdf_simple_tests.F90.in:80


  ret = PIO_openfile(pio_tf_iosystem_, pio_file, tgv_iotype, tgv_fname, PIO_write)   ! ncdf_simple_tests.F90.in:82
  
  IF (.NOT. (PIO_TF_Passert_((ret) == PIO_NOERR, pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: PIO Function failed:",&
         "Failed to open:" // trim(tgv_fname),&
        ":", __FILE__, ":", __LINE__,&
        "(ncdf_simple_tests.F90.in:83)"
    END IF
    RETURN
  END IF   ! ncdf_simple_tests.F90.in:83


  ! A simple redef and then enddef
  ret = PIO_redef(pio_file)   ! ncdf_simple_tests.F90.in:86
  
  IF (.NOT. (PIO_TF_Passert_((ret) == PIO_NOERR, pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: PIO Function failed:",&
         "Failed to redef:" // trim(tgv_fname),&
        ":", __FILE__, ":", __LINE__,&
        "(ncdf_simple_tests.F90.in:87)"
    END IF
    RETURN
  END IF   ! ncdf_simple_tests.F90.in:87


  ret = PIO_def_dim(pio_file, 'dummy_dim_def_var', 100, pio_dim)   ! ncdf_simple_tests.F90.in:89
  
  IF (.NOT. (PIO_TF_Passert_((ret) == PIO_NOERR, pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: PIO Function failed:",&
         "Failed to define dim:" // trim(tgv_fname),&
        ":", __FILE__, ":", __LINE__,&
        "(ncdf_simple_tests.F90.in:90)"
    END IF
    RETURN
  END IF   ! ncdf_simple_tests.F90.in:90


  ret = PIO_def_var(pio_file, 'dummy_var_def_var', PIO_int, (/pio_dim/), pio_var)   ! ncdf_simple_tests.F90.in:92
  
  IF (.NOT. (PIO_TF_Passert_((ret) == PIO_NOERR, pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: PIO Function failed:",&
         "Failed to define var:" // trim(tgv_fname),&
        ":", __FILE__, ":", __LINE__,&
        "(ncdf_simple_tests.F90.in:93)"
    END IF
    RETURN
  END IF   ! ncdf_simple_tests.F90.in:93


  ret = PIO_enddef(pio_file)   ! ncdf_simple_tests.F90.in:95
  
  IF (.NOT. (PIO_TF_Passert_((ret) == PIO_NOERR, pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: PIO Function failed:",&
         "Failed to enddef:" // trim(tgv_fname),&
        ":", __FILE__, ":", __LINE__,&
        "(ncdf_simple_tests.F90.in:96)"
    END IF
    RETURN
  END IF   ! ncdf_simple_tests.F90.in:96


  call PIO_closefile(pio_file)   ! ncdf_simple_tests.F90.in:98


END SUBROUTINE test_def_var   ! ncdf_simple_tests.F90.in:100




SUBROUTINE test_data_conversion_PIO_int_integer__
USE pio_tutil

  use ncdf_simple_tests_tgv
  implicit none
  integer, parameter :: VEC_LOCAL_SZ = 7
  type(var_desc_t)  :: pio_var
  type(file_desc_t) :: pio_file
  character(len=PIO_TF_MAX_STR_LEN) :: data_fname = "pio_test_data_conversion_PIO_int_integer__.nc"
  type(io_desc_t) :: wiodesc, riodesc
  integer, dimension(VEC_LOCAL_SZ) :: compdof, compdof_rel_disps
  integer, dimension(VEC_LOCAL_SZ) :: wbuf
  integer, dimension(VEC_LOCAL_SZ) :: rbuf, exp_val
  integer, dimension(1) :: dims
  integer :: pio_dim
  integer :: i, ierr
   ! ncdf_simple_tests.F90.in:117
   ! ncdf_simple_tests.F90.in:118
  do i=1,VEC_LOCAL_SZ
    compdof_rel_disps(i) = i
  end do
  dims(1) = VEC_LOCAL_SZ * pio_tf_world_sz_
  compdof = VEC_LOCAL_SZ * pio_tf_world_rank_ + compdof_rel_disps
  wbuf = pio_tf_world_rank_;
  exp_val = pio_tf_world_rank_;
   ! ncdf_simple_tests.F90.in:126
  ! Set the decomposition for writing data as PIO_int
  call PIO_initdecomp(pio_tf_iosystem_, PIO_int, dims, compdof, wiodesc)
   ! ncdf_simple_tests.F90.in:129
  ! Set the decomposition for reading data as various types 
  call PIO_initdecomp(pio_tf_iosystem_, PIO_int, dims, compdof, riodesc)
   ! ncdf_simple_tests.F90.in:132
  ierr = PIO_createfile(pio_tf_iosystem_, pio_file, tgv_iotype, data_fname, PIO_CLOBBER) 
  
  IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: PIO Function failed:",&
         "Could not create file " // trim(data_fname),&
        ":", __FILE__, ":", __LINE__,&
        "(ncdf_simple_tests.F90.in:134)"
    END IF
    RETURN
  END IF
   ! ncdf_simple_tests.F90.in:135
  ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim', dims(1), pio_dim)
  
  IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: PIO Function failed:",&
         "Failed to define a dim : " // trim(data_fname),&
        ":", __FILE__, ":", __LINE__,&
        "(ncdf_simple_tests.F90.in:137)"
    END IF
    RETURN
  END IF
   ! ncdf_simple_tests.F90.in:138
  ierr = PIO_def_var(pio_file, 'PIO_TF_test_var', PIO_int, (/pio_dim/), pio_var)
  
  IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: PIO Function failed:",&
         "Failed to define a var : " // trim(data_fname),&
        ":", __FILE__, ":", __LINE__,&
        "(ncdf_simple_tests.F90.in:140)"
    END IF
    RETURN
  END IF
   ! ncdf_simple_tests.F90.in:141
  ierr = PIO_enddef(pio_file)
  
  IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: PIO Function failed:",&
         "Failed to end redef mode : " // trim(data_fname),&
        ":", __FILE__, ":", __LINE__,&
        "(ncdf_simple_tests.F90.in:143)"
    END IF
    RETURN
  END IF
   ! ncdf_simple_tests.F90.in:144
  ! Write the variable out
  call PIO_write_darray(pio_file, pio_var, wiodesc, wbuf, ierr)
  
  IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: PIO Function failed:",&
         "Failed to write darray : " // trim(data_fname),&
        ":", __FILE__, ":", __LINE__,&
        "(ncdf_simple_tests.F90.in:147)"
    END IF
    RETURN
  END IF
   ! ncdf_simple_tests.F90.in:148
  call PIO_syncfile(pio_file)
   ! ncdf_simple_tests.F90.in:150
  if (tgv_iotype .eq. PIO_iotype_pnetcdf) then

     IF (pio_tf_world_rank_ == 0) THEN
       IF (pio_tf_log_level_ >= 0) THEN
         WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
         WRITE(*,*)  "WARNING: Data type conversion not supported in pnetcdf vard interface, skipping test"
       END IF
     END IF
  else
     ! Read the variable back (data conversion might occur)
     call PIO_read_darray(pio_file, pio_var, riodesc, rbuf, ierr)
     
     IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
       pio_tf_retval_utest_ = -1
       IF (pio_tf_world_rank_ == 0) THEN
         PRINT *, "PIO_TF: PIO Function failed:",&
            "Failed to read darray : " // trim(data_fname),&
           ":", __FILE__, ":", __LINE__,&
           "(ncdf_simple_tests.F90.in:156)"
       END IF
       RETURN
     END IF
     
     IF (.NOT. PIO_TF_Check_val_(rbuf, exp_val)) THEN
       pio_tf_retval_utest_ = -1
       IF (pio_tf_world_rank_ == 0) THEN
         PRINT *, "PIO_TF: PIO Check failed:",&
            "Got wrong val",&
           ":", __FILE__, ":", __LINE__,&
           "(ncdf_simple_tests.F90.in:157)"
       END IF
       RETURN
     END IF
  endif
   ! ncdf_simple_tests.F90.in:159
  call PIO_closefile(pio_file)
  call PIO_deletefile(pio_tf_iosystem_, data_fname);
   ! ncdf_simple_tests.F90.in:162
  call PIO_freedecomp(pio_tf_iosystem_, wiodesc)
  call PIO_freedecomp(pio_tf_iosystem_, riodesc)
   ! ncdf_simple_tests.F90.in:165
END SUBROUTINE test_data_conversion_PIO_int_integer__


SUBROUTINE test_data_conversion_PIO_real_real_kind_fc_real___
USE pio_tutil

  use ncdf_simple_tests_tgv
  implicit none
  integer, parameter :: VEC_LOCAL_SZ = 7
  type(var_desc_t)  :: pio_var
  type(file_desc_t) :: pio_file
  character(len=PIO_TF_MAX_STR_LEN) :: data_fname = "pio_test_data_conversion_PIO_real_real_kind_fc_real___.nc"
  type(io_desc_t) :: wiodesc, riodesc
  integer, dimension(VEC_LOCAL_SZ) :: compdof, compdof_rel_disps
  integer, dimension(VEC_LOCAL_SZ) :: wbuf
  real(kind=fc_real), dimension(VEC_LOCAL_SZ) :: rbuf, exp_val
  integer, dimension(1) :: dims
  integer :: pio_dim
  integer :: i, ierr
   ! ncdf_simple_tests.F90.in:117
   ! ncdf_simple_tests.F90.in:118
  do i=1,VEC_LOCAL_SZ
    compdof_rel_disps(i) = i
  end do
  dims(1) = VEC_LOCAL_SZ * pio_tf_world_sz_
  compdof = VEC_LOCAL_SZ * pio_tf_world_rank_ + compdof_rel_disps
  wbuf = pio_tf_world_rank_;
  exp_val = pio_tf_world_rank_;
   ! ncdf_simple_tests.F90.in:126
  ! Set the decomposition for writing data as PIO_int
  call PIO_initdecomp(pio_tf_iosystem_, PIO_int, dims, compdof, wiodesc)
   ! ncdf_simple_tests.F90.in:129
  ! Set the decomposition for reading data as various types 
  call PIO_initdecomp(pio_tf_iosystem_, PIO_real, dims, compdof, riodesc)
   ! ncdf_simple_tests.F90.in:132
  ierr = PIO_createfile(pio_tf_iosystem_, pio_file, tgv_iotype, data_fname, PIO_CLOBBER) 
  
  IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: PIO Function failed:",&
         "Could not create file " // trim(data_fname),&
        ":", __FILE__, ":", __LINE__,&
        "(ncdf_simple_tests.F90.in:134)"
    END IF
    RETURN
  END IF
   ! ncdf_simple_tests.F90.in:135
  ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim', dims(1), pio_dim)
  
  IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: PIO Function failed:",&
         "Failed to define a dim : " // trim(data_fname),&
        ":", __FILE__, ":", __LINE__,&
        "(ncdf_simple_tests.F90.in:137)"
    END IF
    RETURN
  END IF
   ! ncdf_simple_tests.F90.in:138
  ierr = PIO_def_var(pio_file, 'PIO_TF_test_var', PIO_int, (/pio_dim/), pio_var)
  
  IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: PIO Function failed:",&
         "Failed to define a var : " // trim(data_fname),&
        ":", __FILE__, ":", __LINE__,&
        "(ncdf_simple_tests.F90.in:140)"
    END IF
    RETURN
  END IF
   ! ncdf_simple_tests.F90.in:141
  ierr = PIO_enddef(pio_file)
  
  IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: PIO Function failed:",&
         "Failed to end redef mode : " // trim(data_fname),&
        ":", __FILE__, ":", __LINE__,&
        "(ncdf_simple_tests.F90.in:143)"
    END IF
    RETURN
  END IF
   ! ncdf_simple_tests.F90.in:144
  ! Write the variable out
  call PIO_write_darray(pio_file, pio_var, wiodesc, wbuf, ierr)
  
  IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: PIO Function failed:",&
         "Failed to write darray : " // trim(data_fname),&
        ":", __FILE__, ":", __LINE__,&
        "(ncdf_simple_tests.F90.in:147)"
    END IF
    RETURN
  END IF
   ! ncdf_simple_tests.F90.in:148
  call PIO_syncfile(pio_file)
   ! ncdf_simple_tests.F90.in:150
  if (tgv_iotype .eq. PIO_iotype_pnetcdf) then

     IF (pio_tf_world_rank_ == 0) THEN
       IF (pio_tf_log_level_ >= 0) THEN
         WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
         WRITE(*,*)  "WARNING: Data type conversion not supported in pnetcdf vard interface, skipping test"
       END IF
     END IF
  else
     ! Read the variable back (data conversion might occur)
     call PIO_read_darray(pio_file, pio_var, riodesc, rbuf, ierr)
     
     IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
       pio_tf_retval_utest_ = -1
       IF (pio_tf_world_rank_ == 0) THEN
         PRINT *, "PIO_TF: PIO Function failed:",&
            "Failed to read darray : " // trim(data_fname),&
           ":", __FILE__, ":", __LINE__,&
           "(ncdf_simple_tests.F90.in:156)"
       END IF
       RETURN
     END IF
     
     IF (.NOT. PIO_TF_Check_val_(rbuf, exp_val)) THEN
       pio_tf_retval_utest_ = -1
       IF (pio_tf_world_rank_ == 0) THEN
         PRINT *, "PIO_TF: PIO Check failed:",&
            "Got wrong val",&
           ":", __FILE__, ":", __LINE__,&
           "(ncdf_simple_tests.F90.in:157)"
       END IF
       RETURN
     END IF
  endif
   ! ncdf_simple_tests.F90.in:159
  call PIO_closefile(pio_file)
  call PIO_deletefile(pio_tf_iosystem_, data_fname);
   ! ncdf_simple_tests.F90.in:162
  call PIO_freedecomp(pio_tf_iosystem_, wiodesc)
  call PIO_freedecomp(pio_tf_iosystem_, riodesc)
   ! ncdf_simple_tests.F90.in:165
END SUBROUTINE test_data_conversion_PIO_real_real_kind_fc_real___


SUBROUTINE test_data_conversion_PIO_double_real_kind_fc_double___
USE pio_tutil

  use ncdf_simple_tests_tgv
  implicit none
  integer, parameter :: VEC_LOCAL_SZ = 7
  type(var_desc_t)  :: pio_var
  type(file_desc_t) :: pio_file
  character(len=PIO_TF_MAX_STR_LEN) :: data_fname = "pio_test_data_conversion_PIO_double_real_kind_fc_double___.nc"
  type(io_desc_t) :: wiodesc, riodesc
  integer, dimension(VEC_LOCAL_SZ) :: compdof, compdof_rel_disps
  integer, dimension(VEC_LOCAL_SZ) :: wbuf
  real(kind=fc_double), dimension(VEC_LOCAL_SZ) :: rbuf, exp_val
  integer, dimension(1) :: dims
  integer :: pio_dim
  integer :: i, ierr
   ! ncdf_simple_tests.F90.in:117
   ! ncdf_simple_tests.F90.in:118
  do i=1,VEC_LOCAL_SZ
    compdof_rel_disps(i) = i
  end do
  dims(1) = VEC_LOCAL_SZ * pio_tf_world_sz_
  compdof = VEC_LOCAL_SZ * pio_tf_world_rank_ + compdof_rel_disps
  wbuf = pio_tf_world_rank_;
  exp_val = pio_tf_world_rank_;
   ! ncdf_simple_tests.F90.in:126
  ! Set the decomposition for writing data as PIO_int
  call PIO_initdecomp(pio_tf_iosystem_, PIO_int, dims, compdof, wiodesc)
   ! ncdf_simple_tests.F90.in:129
  ! Set the decomposition for reading data as various types 
  call PIO_initdecomp(pio_tf_iosystem_, PIO_double, dims, compdof, riodesc)
   ! ncdf_simple_tests.F90.in:132
  ierr = PIO_createfile(pio_tf_iosystem_, pio_file, tgv_iotype, data_fname, PIO_CLOBBER) 
  
  IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: PIO Function failed:",&
         "Could not create file " // trim(data_fname),&
        ":", __FILE__, ":", __LINE__,&
        "(ncdf_simple_tests.F90.in:134)"
    END IF
    RETURN
  END IF
   ! ncdf_simple_tests.F90.in:135
  ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim', dims(1), pio_dim)
  
  IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: PIO Function failed:",&
         "Failed to define a dim : " // trim(data_fname),&
        ":", __FILE__, ":", __LINE__,&
        "(ncdf_simple_tests.F90.in:137)"
    END IF
    RETURN
  END IF
   ! ncdf_simple_tests.F90.in:138
  ierr = PIO_def_var(pio_file, 'PIO_TF_test_var', PIO_int, (/pio_dim/), pio_var)
  
  IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: PIO Function failed:",&
         "Failed to define a var : " // trim(data_fname),&
        ":", __FILE__, ":", __LINE__,&
        "(ncdf_simple_tests.F90.in:140)"
    END IF
    RETURN
  END IF
   ! ncdf_simple_tests.F90.in:141
  ierr = PIO_enddef(pio_file)
  
  IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: PIO Function failed:",&
         "Failed to end redef mode : " // trim(data_fname),&
        ":", __FILE__, ":", __LINE__,&
        "(ncdf_simple_tests.F90.in:143)"
    END IF
    RETURN
  END IF
   ! ncdf_simple_tests.F90.in:144
  ! Write the variable out
  call PIO_write_darray(pio_file, pio_var, wiodesc, wbuf, ierr)
  
  IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: PIO Function failed:",&
         "Failed to write darray : " // trim(data_fname),&
        ":", __FILE__, ":", __LINE__,&
        "(ncdf_simple_tests.F90.in:147)"
    END IF
    RETURN
  END IF
   ! ncdf_simple_tests.F90.in:148
  call PIO_syncfile(pio_file)
   ! ncdf_simple_tests.F90.in:150
  if (tgv_iotype .eq. PIO_iotype_pnetcdf) then

     IF (pio_tf_world_rank_ == 0) THEN
       IF (pio_tf_log_level_ >= 0) THEN
         WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
         WRITE(*,*)  "WARNING: Data type conversion not supported in pnetcdf vard interface, skipping test"
       END IF
     END IF
  else
     ! Read the variable back (data conversion might occur)
     call PIO_read_darray(pio_file, pio_var, riodesc, rbuf, ierr)
     
     IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
       pio_tf_retval_utest_ = -1
       IF (pio_tf_world_rank_ == 0) THEN
         PRINT *, "PIO_TF: PIO Function failed:",&
            "Failed to read darray : " // trim(data_fname),&
           ":", __FILE__, ":", __LINE__,&
           "(ncdf_simple_tests.F90.in:156)"
       END IF
       RETURN
     END IF
     
     IF (.NOT. PIO_TF_Check_val_(rbuf, exp_val)) THEN
       pio_tf_retval_utest_ = -1
       IF (pio_tf_world_rank_ == 0) THEN
         PRINT *, "PIO_TF: PIO Check failed:",&
            "Got wrong val",&
           ":", __FILE__, ":", __LINE__,&
           "(ncdf_simple_tests.F90.in:157)"
       END IF
       RETURN
     END IF
  endif
   ! ncdf_simple_tests.F90.in:159
  call PIO_closefile(pio_file)
  call PIO_deletefile(pio_tf_iosystem_, data_fname);
   ! ncdf_simple_tests.F90.in:162
  call PIO_freedecomp(pio_tf_iosystem_, wiodesc)
  call PIO_freedecomp(pio_tf_iosystem_, riodesc)
   ! ncdf_simple_tests.F90.in:165
END SUBROUTINE test_data_conversion_PIO_double_real_kind_fc_double___
   ! ncdf_simple_tests.F90.in:166


SUBROUTINE PIO_TF_Test_driver_
  USE pio_tutil
   ! ncdf_simple_tests.F90.in:168
  use ncdf_simple_tests_tgv   ! ncdf_simple_tests.F90.in:169
  Implicit none   ! ncdf_simple_tests.F90.in:170
  type(file_desc_t) :: pio_file   ! ncdf_simple_tests.F90.in:171
  integer :: ret, i   ! ncdf_simple_tests.F90.in:172
  ! iotypes = valid NC types
  integer, dimension(:), allocatable :: iotypes   ! ncdf_simple_tests.F90.in:174
  character(len=PIO_TF_MAX_STR_LEN), dimension(:), allocatable :: iotype_descs   ! ncdf_simple_tests.F90.in:175
  integer :: num_iotypes   ! ncdf_simple_tests.F90.in:176


  num_iotypes = 0   ! ncdf_simple_tests.F90.in:178
  call PIO_TF_Get_nc_iotypes(iotypes, iotype_descs, num_iotypes)    ! ncdf_simple_tests.F90.in:179
  do i=1,num_iotypes   ! ncdf_simple_tests.F90.in:180
    tgv_iotype = iotypes(i)   ! ncdf_simple_tests.F90.in:181
    ret = PIO_createfile(pio_tf_iosystem_, pio_file, tgv_iotype, tgv_fname)   ! ncdf_simple_tests.F90.in:182
    
    IF (.NOT. (PIO_TF_Passert_((ret) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to create:"//trim(iotype_descs(i))//":"//trim(tgv_fname),&
          ":", __FILE__, ":", __LINE__,&
          "(ncdf_simple_tests.F90.in:183)"
      END IF
      RETURN
    END IF   ! ncdf_simple_tests.F90.in:183


    call PIO_closefile(pio_file)   ! ncdf_simple_tests.F90.in:185


    ! Make sure that global variables are set correctly before running the tests
    
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: Running AUTO tests: ", trim(iotype_descs(i))
      END IF
      pio_tf_retval_utest_ = 0
      pio_tf_tmp_log_str_="test_data_conversion_PIO_int_integer__"//"("//trim(iotype_descs(i))//")"
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: Starting test_data_conversion_PIO_int_integer__"
      END IF
      CALL test_data_conversion_PIO_int_integer__()
      IF (pio_tf_retval_utest_ /= 0) THEN
        pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
      END IF
      IF (pio_tf_world_rank_ == 0) THEN
        IF (pio_tf_retval_utest_ == 0) THEN
          WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 1:",&
            pio_tf_tmp_log_str_,&
            "---------","PASSED"
        ELSE
          WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 1:",&
            pio_tf_tmp_log_str_,&
            "---------","FAILED"
        END IF
      END IF
      pio_tf_retval_utest_ = 0
      pio_tf_tmp_log_str_="test_data_conversion_PIO_real_real_kind_fc_real___"//"("//trim(iotype_descs(i))//")"
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: Starting test_data_conversion_PIO_real_real_kind_fc_real___"
      END IF
      CALL test_data_conversion_PIO_real_real_kind_fc_real___()
      IF (pio_tf_retval_utest_ /= 0) THEN
        pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
      END IF
      IF (pio_tf_world_rank_ == 0) THEN
        IF (pio_tf_retval_utest_ == 0) THEN
          WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 2:",&
            pio_tf_tmp_log_str_,&
            "---------","PASSED"
        ELSE
          WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 2:",&
            pio_tf_tmp_log_str_,&
            "---------","FAILED"
        END IF
      END IF
      pio_tf_retval_utest_ = 0
      pio_tf_tmp_log_str_="test_data_conversion_PIO_double_real_kind_fc_double___"//"("//trim(iotype_descs(i))//")"
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: Starting test_data_conversion_PIO_double_real_kind_fc_double___"
      END IF
      CALL test_data_conversion_PIO_double_real_kind_fc_double___()
      IF (pio_tf_retval_utest_ /= 0) THEN
        pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
      END IF
      IF (pio_tf_world_rank_ == 0) THEN
        IF (pio_tf_retval_utest_ == 0) THEN
          WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 3:",&
            pio_tf_tmp_log_str_,&
            "---------","PASSED"
        ELSE
          WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 3:",&
            pio_tf_tmp_log_str_,&
            "---------","FAILED"
        END IF
      END IF
      pio_tf_retval_utest_ = 0
      pio_tf_tmp_log_str_="test_clobber"//"("//trim(iotype_descs(i))//")"
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: Starting test_clobber"
      END IF
      CALL test_clobber()
      IF (pio_tf_retval_utest_ /= 0) THEN
        pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
      END IF
      IF (pio_tf_world_rank_ == 0) THEN
        IF (pio_tf_retval_utest_ == 0) THEN
          WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 4:",&
            pio_tf_tmp_log_str_,&
            "---------","PASSED"
        ELSE
          WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 4:",&
            pio_tf_tmp_log_str_,&
            "---------","FAILED"
        END IF
      END IF
      pio_tf_retval_utest_ = 0
      pio_tf_tmp_log_str_="test_redef_enddef"//"("//trim(iotype_descs(i))//")"
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: Starting test_redef_enddef"
      END IF
      CALL test_redef_enddef()
      IF (pio_tf_retval_utest_ /= 0) THEN
        pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
      END IF
      IF (pio_tf_world_rank_ == 0) THEN
        IF (pio_tf_retval_utest_ == 0) THEN
          WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 5:",&
            pio_tf_tmp_log_str_,&
            "---------","PASSED"
        ELSE
          WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 5:",&
            pio_tf_tmp_log_str_,&
            "---------","FAILED"
        END IF
      END IF
      pio_tf_retval_utest_ = 0
      pio_tf_tmp_log_str_="test_def_dim"//"("//trim(iotype_descs(i))//")"
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: Starting test_def_dim"
      END IF
      CALL test_def_dim()
      IF (pio_tf_retval_utest_ /= 0) THEN
        pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
      END IF
      IF (pio_tf_world_rank_ == 0) THEN
        IF (pio_tf_retval_utest_ == 0) THEN
          WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 6:",&
            pio_tf_tmp_log_str_,&
            "---------","PASSED"
        ELSE
          WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 6:",&
            pio_tf_tmp_log_str_,&
            "---------","FAILED"
        END IF
      END IF
      pio_tf_retval_utest_ = 0
      pio_tf_tmp_log_str_="test_def_var"//"("//trim(iotype_descs(i))//")"
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: Starting test_def_var"
      END IF
      CALL test_def_var()
      IF (pio_tf_retval_utest_ /= 0) THEN
        pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
      END IF
      IF (pio_tf_world_rank_ == 0) THEN
        IF (pio_tf_retval_utest_ == 0) THEN
          WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 7:",&
            pio_tf_tmp_log_str_,&
            "---------","PASSED"
        ELSE
          WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 7:",&
            pio_tf_tmp_log_str_,&
            "---------","FAILED"
        END IF
      END IF
   ! ncdf_simple_tests.F90.in:188


    call PIO_deletefile(pio_tf_iosystem_, tgv_fname)   ! ncdf_simple_tests.F90.in:190
  end do   ! ncdf_simple_tests.F90.in:191
  if(allocated(iotypes)) then   ! ncdf_simple_tests.F90.in:192
    deallocate(iotypes)   ! ncdf_simple_tests.F90.in:193
    deallocate(iotype_descs)   ! ncdf_simple_tests.F90.in:194
  end if   ! ncdf_simple_tests.F90.in:195



END SUBROUTINE PIO_TF_Test_driver_   ! ncdf_simple_tests.F90.in:197


  PROGRAM PIO_TF_Test_main_
    USE pio_tutil
    IMPLICIT NONE
    INTEGER, PARAMETER :: NREARRS = 2
    INTEGER :: rearrs(NREARRS) = (/pio_rearr_subset,pio_rearr_box/)
    CHARACTER(LEN=PIO_TF_MAX_STR_LEN) :: rearrs_info(NREARRS) = (/"PIO_REARR_SUBSET","PIO_REARR_BOX   "/)
    INTEGER i, ierr

    pio_tf_nerrs_total_=0
    pio_tf_retval_utest_=0
    CALL MPI_Init(ierr)
    DO i=1,SIZE(rearrs)
      CALL PIO_TF_Init_(rearrs(i))
      IF (pio_tf_world_rank_ == 0) THEN
        WRITE(*,*) "PIO_TF: Testing : ", trim(rearrs_info(i))
      END IF
      CALL PIO_TF_Test_driver_()
      CALL PIO_TF_Finalize_()
    END DO
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_nerrs_total_ == 0) THEN
        IF (pio_tf_retval_utest_ == 0) THEN
          WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF: ",&
           "All tests", "---------", "PASSED"
        ELSE
          pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
          WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF: ",&
           "Test driver", "---------", "FAILED"
        END IF
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT2) "PIO_TF:[",&
          pio_tf_nerrs_total_,"] Tests",&
          "----- FAILED"
      END IF
    END IF
    CALL MPI_Finalize(ierr)
    IF (pio_tf_nerrs_total_ /= 0) THEN
      STOP 99
    END IF
  END PROGRAM
