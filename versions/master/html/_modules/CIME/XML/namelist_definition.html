<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CIME.XML.namelist_definition &mdash; CIME master documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=30d551ce"></script>
        <script src="../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../../_static/pop_ver.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            CIME
          </a>
              <div class="version">
                master
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../what_cime/index.html">What is CIME?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../users_guide/index.html">Case Control System Part 1: Basic Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../users_guide/index.html#case-control-system-part-2-configuration-porting-testing-and-use-cases">Case Control System Part 2: Configuration, Porting, Testing and Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../build_cpl/index.html">Building a Coupled Model with CIME</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc_tools/index.html">Miscellaneous Tools</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary/index.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Tools_user/index.html">User Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../xml_files/index.html">XML Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../CIME_api/modules.html">CIME</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Tools_api/modules.html">Tools</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">CIME</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">CIME.XML.namelist_definition</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for CIME.XML.namelist_definition</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Interface to `namelist_definition.xml`.</span>

<span class="sd">This module contains only one class, `NamelistDefinition`, inheriting from</span>
<span class="sd">`EntryID`.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># Warnings we typically ignore.</span>
<span class="c1"># pylint:disable=invalid-name</span>

<span class="c1"># Disable warnings due to using `standard_module_setup`</span>
<span class="c1"># pylint:disable=wildcard-import,unused-wildcard-import</span>

<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">collections</span>

<span class="kn">from</span> <span class="nn">CIME.namelist</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">fortran_namelist_base_value</span><span class="p">,</span>
    <span class="n">is_valid_fortran_namelist_literal</span><span class="p">,</span>
    <span class="n">character_literal_to_string</span><span class="p">,</span>
    <span class="n">expand_literal_list</span><span class="p">,</span>
    <span class="n">Namelist</span><span class="p">,</span>
    <span class="n">get_fortran_name_only</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">CIME.XML.standard_module_setup</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">CIME.XML.entry_id</span> <span class="kn">import</span> <span class="n">EntryID</span>
<span class="kn">from</span> <span class="nn">CIME.XML.files</span> <span class="kn">import</span> <span class="n">Files</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="n">_array_size_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^(?P&lt;type&gt;[^(]+)\((?P&lt;size&gt;[^)]+)\)$&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="CaseInsensitiveDict">
<a class="viewcode-back" href="../../../CIME_api/CIME.XML.html#CIME.XML.namelist_definition.CaseInsensitiveDict">[docs]</a>
<span class="k">class</span> <span class="nc">CaseInsensitiveDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;Basic case insensitive dict with strings only keys.</span>
<span class="sd">    From https://stackoverflow.com/a/27890005&quot;&quot;&quot;</span>

    <span class="n">proxy</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="nb">dict</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proxy</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">proxy</span>

    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proxy</span><span class="p">[</span><span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CaseInsensitiveDict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__delitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">proxy</span><span class="p">[</span><span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proxy</span><span class="p">[</span><span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">CaseInsensitiveDict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

<div class="viewcode-block" id="CaseInsensitiveDict.get">
<a class="viewcode-back" href="../../../CIME_api/CIME.XML.html#CIME.XML.namelist_definition.CaseInsensitiveDict.get">[docs]</a>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">else</span> <span class="n">default</span></div>


    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CaseInsensitiveDict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proxy</span><span class="p">[</span><span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">k</span></div>



<div class="viewcode-block" id="NamelistDefinition">
<a class="viewcode-back" href="../../../CIME_api/CIME.XML.html#CIME.XML.namelist_definition.NamelistDefinition">[docs]</a>
<span class="k">class</span> <span class="nc">NamelistDefinition</span><span class="p">(</span><span class="n">EntryID</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class representing variable definitions for a namelist.</span>
<span class="sd">    This class inherits from `EntryID`, and supports most inherited methods;</span>
<span class="sd">    however, `set_value` is unsupported.</span>

<span class="sd">    Additional public methods:</span>
<span class="sd">    - dict_to_namelist.</span>
<span class="sd">    - is_valid_value</span>
<span class="sd">    - validate</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">infile</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct a `NamelistDefinition` from an XML file.&quot;&quot;&quot;</span>

        <span class="c1"># if the file is invalid we may not be able to check the version</span>
        <span class="c1"># but we need to do it this way until we remove the version 1 files</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">files</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">files</span> <span class="o">=</span> <span class="n">Files</span><span class="p">()</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="n">files</span><span class="o">.</span><span class="n">get_schema</span><span class="p">(</span><span class="s2">&quot;NAMELIST_DEFINITION_FILE&quot;</span><span class="p">)</span>
        <span class="n">expect</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">infile</span><span class="p">),</span> <span class="s2">&quot;File </span><span class="si">{}</span><span class="s2"> does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">infile</span><span class="p">))</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">NamelistDefinition</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entry_nodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entry_ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_valid_values</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entry_types</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_group_names</span> <span class="o">=</span> <span class="n">CaseInsensitiveDict</span><span class="p">({})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nodes</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="NamelistDefinition.set_node_values">
<a class="viewcode-back" href="../../../CIME_api/CIME.XML.html#CIME.XML.namelist_definition.NamelistDefinition.set_node_values">[docs]</a>
    <span class="k">def</span> <span class="nf">set_node_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entry_nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entry_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nodes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entry_types</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_type</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_valid_values</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_valid_values</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_group_names</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_group_name</span><span class="p">(</span><span class="n">node</span><span class="p">)</span></div>


<div class="viewcode-block" id="NamelistDefinition.set_nodes">
<a class="viewcode-back" href="../../../CIME_api/CIME.XML.html#CIME.XML.namelist_definition.NamelistDefinition.set_nodes">[docs]</a>
    <span class="k">def</span> <span class="nf">set_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skip_groups</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        populates the object data types for all nodes that are not part of the skip_groups array</span>
<span class="sd">        returns nodes that do not have attributes of `skip_default_entry` or `per_stream_entry`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">default_nodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_children</span><span class="p">(</span><span class="s2">&quot;entry&quot;</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">)</span>
            <span class="n">skip_default_entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;skip_default_entry&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span>
            <span class="n">per_stream_entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;per_stream_entry&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span>

            <span class="k">if</span> <span class="n">skip_groups</span><span class="p">:</span>
                <span class="n">group_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_group_name</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">group_name</span> <span class="ow">in</span> <span class="n">skip_groups</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">set_node_values</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">skip_default_entry</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">per_stream_entry</span><span class="p">:</span>
                        <span class="n">default_nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_node_values</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">skip_default_entry</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">per_stream_entry</span><span class="p">:</span>
                    <span class="n">default_nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">default_nodes</span></div>


<div class="viewcode-block" id="NamelistDefinition.get_group_name">
<a class="viewcode-back" href="../../../CIME_api/CIME.XML.html#CIME.XML.namelist_definition.NamelistDefinition.get_group_name">[docs]</a>
    <span class="k">def</span> <span class="nf">get_group_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_version</span><span class="p">()</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="n">group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;group&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_version</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mf">2.0</span><span class="p">:</span>
            <span class="n">group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_text</span><span class="p">(</span><span class="s2">&quot;group&quot;</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="n">node</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">group</span></div>


    <span class="k">def</span> <span class="nf">_get_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_version</span><span class="p">()</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="n">type_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_version</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mf">2.0</span><span class="p">:</span>
            <span class="n">type_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_type_info</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">type_info</span>

    <span class="k">def</span> <span class="nf">_get_valid_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="c1"># The &quot;valid_values&quot; attribute is not required, and an empty string has</span>
        <span class="c1"># the same effect as not specifying it.</span>
        <span class="c1"># Returns a list from a comma seperated string in xml</span>
        <span class="n">valid_values</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_version</span><span class="p">()</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="n">valid_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;valid_values&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_version</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mf">2.0</span><span class="p">:</span>
            <span class="n">valid_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_node_element_info</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;valid_values&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">valid_values</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">valid_values</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valid_values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">valid_values</span> <span class="o">=</span> <span class="n">valid_values</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">valid_values</span>

<div class="viewcode-block" id="NamelistDefinition.get_group">
<a class="viewcode-back" href="../../../CIME_api/CIME.XML.html#CIME.XML.namelist_definition.NamelistDefinition.get_group">[docs]</a>
    <span class="k">def</span> <span class="nf">get_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_names</span><span class="p">[</span><span class="n">name</span><span class="p">]</span></div>


<div class="viewcode-block" id="NamelistDefinition.rename_group">
<a class="viewcode-back" href="../../../CIME_api/CIME.XML.html#CIME.XML.namelist_definition.NamelistDefinition.rename_group">[docs]</a>
    <span class="k">def</span> <span class="nf">rename_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oldgroup</span><span class="p">,</span> <span class="n">newgroup</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_names</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_names</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">==</span> <span class="n">oldgroup</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_group_names</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">newgroup</span></div>


<div class="viewcode-block" id="NamelistDefinition.add_attributes">
<a class="viewcode-back" href="../../../CIME_api/CIME.XML.html#CIME.XML.namelist_definition.NamelistDefinition.add_attributes">[docs]</a>
    <span class="k">def</span> <span class="nf">add_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attributes</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span> <span class="o">=</span> <span class="n">attributes</span></div>


<div class="viewcode-block" id="NamelistDefinition.get_attributes">
<a class="viewcode-back" href="../../../CIME_api/CIME.XML.html#CIME.XML.namelist_definition.NamelistDefinition.get_attributes">[docs]</a>
    <span class="k">def</span> <span class="nf">get_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return this object&#39;s attributes dictionary&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span></div>


<div class="viewcode-block" id="NamelistDefinition.get_entry_nodes">
<a class="viewcode-back" href="../../../CIME_api/CIME.XML.html#CIME.XML.namelist_definition.NamelistDefinition.get_entry_nodes">[docs]</a>
    <span class="k">def</span> <span class="nf">get_entry_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entry_nodes</span></div>


<div class="viewcode-block" id="NamelistDefinition.get_per_stream_entries">
<a class="viewcode-back" href="../../../CIME_api/CIME.XML.html#CIME.XML.namelist_definition.NamelistDefinition.get_per_stream_entries">[docs]</a>
    <span class="k">def</span> <span class="nf">get_per_stream_entries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">entries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_children</span><span class="p">(</span><span class="s2">&quot;entry&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
            <span class="n">per_stream_entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;per_stream_entry&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span>
            <span class="k">if</span> <span class="n">per_stream_entry</span><span class="p">:</span>
                <span class="n">entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">entries</span></div>


    <span class="c1"># Currently we don&#39;t use this object to construct new files, and it&#39;s no</span>
    <span class="c1"># good for that purpose anyway, so stop this function from being called.</span>
<div class="viewcode-block" id="NamelistDefinition.set_value">
<a class="viewcode-back" href="../../../CIME_api/CIME.XML.html#CIME.XML.namelist_definition.NamelistDefinition.set_value">[docs]</a>
    <span class="k">def</span> <span class="nf">set_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vid</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">subgroup</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ignore_type</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This function is not implemented.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;NamelistDefinition does not support `set_value`.&quot;</span><span class="p">)</span></div>


    <span class="c1"># In contrast to the entry_id version of this method, this version doesn&#39;t support the</span>
    <span class="c1"># replacement_for_none argument, because it is hard-coded to &#39;&#39;.</span>
    <span class="c1"># pylint: disable=arguments-differ</span>
<div class="viewcode-block" id="NamelistDefinition.get_value_match">
<a class="viewcode-back" href="../../../CIME_api/CIME.XML.html#CIME.XML.namelist_definition.NamelistDefinition.get_value_match">[docs]</a>
    <span class="k">def</span> <span class="nf">get_value_match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vid</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exact_match</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">entry_node</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the default value for the variable named `vid`.</span>

<span class="sd">        The return value is a list of strings corresponding to the</span>
<span class="sd">        comma-separated list of entries for the value (length 1 for scalars). If</span>
<span class="sd">        there is no default value in the file, this returns `None`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Merge internal attributes with those passed in.</span>
        <span class="n">all_attributes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">all_attributes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">attributes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">all_attributes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">entry_node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">entry_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nodes</span><span class="p">[</span><span class="n">vid</span><span class="p">]</span>
        <span class="c1"># NOTE(wjs, 2021-06-04) In the following call, replacement_for_none=&#39;&#39; may not</span>
        <span class="c1"># actually be needed, but I&#39;m setting it to maintain some old logic, to be safe.</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">NamelistDefinition</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_value_match</span><span class="p">(</span>
            <span class="n">vid</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
            <span class="n">attributes</span><span class="o">=</span><span class="n">all_attributes</span><span class="p">,</span>
            <span class="n">exact_match</span><span class="o">=</span><span class="n">exact_match</span><span class="p">,</span>
            <span class="n">entry_node</span><span class="o">=</span><span class="n">entry_node</span><span class="p">,</span>
            <span class="n">replacement_for_none</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_defaults_text</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">value</span></div>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_split_defaults_text</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Take a comma-separated list in a string, and split it into a list.&quot;&quot;&quot;</span>
        <span class="c1"># Some trickiness here; we want to split items on commas, but not inside</span>
        <span class="c1"># quote-delimited strings. Stripping whitespace is also useful.</span>
        <span class="n">value</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">delim</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">char</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">delim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># If not inside a string...</span>
                    <span class="k">if</span> <span class="n">char</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">):</span>
                        <span class="c1"># if we have a quote character, start a string.</span>
                        <span class="n">delim</span> <span class="o">=</span> <span class="n">char</span>
                    <span class="k">elif</span> <span class="n">char</span> <span class="o">==</span> <span class="s2">&quot;,&quot;</span><span class="p">:</span>
                        <span class="c1"># if we have a comma, this is a new value.</span>
                        <span class="n">value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">string</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                        <span class="n">pos</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># If inside a string, the only thing that can happen is the end</span>
                    <span class="c1"># of the string.</span>
                    <span class="k">if</span> <span class="n">char</span> <span class="o">==</span> <span class="n">delim</span><span class="p">:</span>
                        <span class="n">delim</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">string</span><span class="p">[</span><span class="n">pos</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">value</span>

<div class="viewcode-block" id="NamelistDefinition.split_type_string">
<a class="viewcode-back" href="../../../CIME_api/CIME.XML.html#CIME.XML.namelist_definition.NamelistDefinition.split_type_string">[docs]</a>
    <span class="k">def</span> <span class="nf">split_type_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Split a &#39;type&#39; attribute string into its component parts.</span>

<span class="sd">        The `name` argument is the variable name.</span>
<span class="sd">        This is used for error reporting purposes.</span>

<span class="sd">        The return value is a tuple consisting of the type itself, a length</span>
<span class="sd">        (which is an integer for character variables, otherwise `None`), and the</span>
<span class="sd">        size of the array (which is 1 for scalar variables).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">type_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entry_types</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

        <span class="c1"># &#39;char&#39; is frequently used as an abbreviation of &#39;character&#39;.</span>
        <span class="n">type_string</span> <span class="o">=</span> <span class="n">type_string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;char&quot;</span><span class="p">,</span> <span class="s2">&quot;character&quot;</span><span class="p">)</span>

        <span class="c1"># Separate into a size and the rest of the type.</span>
        <span class="n">size_match</span> <span class="o">=</span> <span class="n">_array_size_re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">type_string</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">size_match</span><span class="p">:</span>
            <span class="n">type_string</span> <span class="o">=</span> <span class="n">size_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
            <span class="n">size_string</span> <span class="o">=</span> <span class="n">size_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;size&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">size_string</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">expect</span><span class="p">(</span>
                    <span class="kc">False</span><span class="p">,</span>
                    <span class="s2">&quot;In namelist definition, variable </span><span class="si">{}</span><span class="s2"> had the non-integer string </span><span class="si">{!r}</span><span class="s2"> specified as an array size.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">name</span><span class="p">,</span> <span class="n">size_string</span>
                    <span class="p">),</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Separate into a type and an optional length.</span>
        <span class="n">type_</span><span class="p">,</span> <span class="n">star</span><span class="p">,</span> <span class="n">length</span> <span class="o">=</span> <span class="n">type_string</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">star</span> <span class="o">==</span> <span class="s2">&quot;*&quot;</span><span class="p">:</span>
            <span class="c1"># Length allowed only for character variables.</span>
            <span class="n">expect</span><span class="p">(</span>
                <span class="n">type_</span> <span class="o">==</span> <span class="s2">&quot;character&quot;</span><span class="p">,</span>
                <span class="s2">&quot;In namelist definition, length specified for non-character &quot;</span>
                <span class="s2">&quot;variable </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="c1"># Check that the length is actually an integer, to make the error</span>
            <span class="c1"># message a bit cleaner if the xml input is bad.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">max_len</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">expect</span><span class="p">(</span>
                    <span class="kc">False</span><span class="p">,</span>
                    <span class="s2">&quot;In namelist definition, character variable </span><span class="si">{}</span><span class="s2"> had the non-integer string </span><span class="si">{!r}</span><span class="s2"> specified as a length.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">name</span><span class="p">,</span> <span class="n">length</span>
                    <span class="p">),</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">max_len</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">type_</span><span class="p">,</span> <span class="n">max_len</span><span class="p">,</span> <span class="n">size</span></div>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_canonicalize_value</span><span class="p">(</span><span class="n">type_</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create &#39;canonical&#39; version of a value for comparison purposes.&quot;&quot;&quot;</span>
        <span class="n">canonical_value</span> <span class="o">=</span> <span class="p">[</span><span class="n">fortran_namelist_base_value</span><span class="p">(</span><span class="n">scalar</span><span class="p">)</span> <span class="k">for</span> <span class="n">scalar</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
        <span class="n">canonical_value</span> <span class="o">=</span> <span class="p">[</span><span class="n">scalar</span> <span class="k">for</span> <span class="n">scalar</span> <span class="ow">in</span> <span class="n">canonical_value</span> <span class="k">if</span> <span class="n">scalar</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">type_</span> <span class="o">==</span> <span class="s2">&quot;character&quot;</span><span class="p">:</span>
            <span class="n">canonical_value</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">character_literal_to_string</span><span class="p">(</span><span class="n">scalar</span><span class="p">)</span> <span class="k">for</span> <span class="n">scalar</span> <span class="ow">in</span> <span class="n">canonical_value</span>
            <span class="p">]</span>
        <span class="k">elif</span> <span class="n">type_</span> <span class="o">==</span> <span class="s2">&quot;integer&quot;</span><span class="p">:</span>
            <span class="n">canonical_value</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">scalar</span><span class="p">)</span> <span class="k">for</span> <span class="n">scalar</span> <span class="ow">in</span> <span class="n">canonical_value</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">canonical_value</span>

<div class="viewcode-block" id="NamelistDefinition.is_valid_value">
<a class="viewcode-back" href="../../../CIME_api/CIME.XML.html#CIME.XML.namelist_definition.NamelistDefinition.is_valid_value">[docs]</a>
    <span class="k">def</span> <span class="nf">is_valid_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine whether a value is valid for the named variable.</span>

<span class="sd">        The `value` argument must be a list of strings formatted as they would</span>
<span class="sd">        appear in the namelist (even for scalar variables, in which case the</span>
<span class="sd">        length of the list is always 1).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Separate into a type, optional length, and optional size.</span>
        <span class="n">type_</span><span class="p">,</span> <span class="n">max_len</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_type_string</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">invalid</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Check value against type.</span>
        <span class="k">for</span> <span class="n">scalar</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_valid_fortran_namelist_literal</span><span class="p">(</span><span class="n">type_</span><span class="p">,</span> <span class="n">scalar</span><span class="p">):</span>
                <span class="n">invalid</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scalar</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">invalid</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Invalid values </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">invalid</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Now that we know that the strings as input are valid Fortran, do some</span>
        <span class="c1"># canonicalization for further checks.</span>
        <span class="n">canonical_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_canonicalize_value</span><span class="p">(</span><span class="n">type_</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="c1"># Check maximum length (if applicable).</span>
        <span class="k">if</span> <span class="n">max_len</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">scalar</span> <span class="ow">in</span> <span class="n">canonical_value</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">scalar</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_len</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Check valid value constraints (if applicable).</span>
        <span class="n">valid_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_values</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">valid_values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">expect</span><span class="p">(</span>
                <span class="n">type_</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;integer&quot;</span><span class="p">,</span> <span class="s2">&quot;character&quot;</span><span class="p">),</span>
                <span class="s2">&quot;Found valid_values attribute for variable </span><span class="si">{}</span><span class="s2"> with type </span><span class="si">{}</span><span class="s2">, but valid_values only allowed for character and integer variables.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">name</span><span class="p">,</span> <span class="n">type_</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">type_</span> <span class="o">==</span> <span class="s2">&quot;integer&quot;</span><span class="p">:</span>
                <span class="n">compare_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">vv</span><span class="p">)</span> <span class="k">for</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">valid_values</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">compare_list</span> <span class="o">=</span> <span class="n">valid_values</span>
            <span class="k">for</span> <span class="n">scalar</span> <span class="ow">in</span> <span class="n">canonical_value</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">scalar</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">compare_list</span><span class="p">:</span>
                    <span class="n">invalid</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scalar</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">invalid</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Invalid values </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">invalid</span><span class="p">))</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Check size of input array.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">expand_literal_list</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">size</span><span class="p">:</span>
            <span class="n">expect</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;Value index exceeds variable size for variable </span><span class="si">{}</span><span class="s2">, allowed array length is </span><span class="si">{}</span><span class="s2"> value array size is </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">name</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">expand_literal_list</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
                <span class="p">),</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>


    <span class="k">def</span> <span class="nf">_expect_variable_in_definition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">variable_template</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Used to get a better error message for an unexpected variable.</span>
<span class="sd">        case insensitve match&quot;&quot;&quot;</span>

        <span class="n">expect</span><span class="p">(</span>
            <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entry_ids</span><span class="p">,</span>
            <span class="p">(</span><span class="n">variable_template</span> <span class="o">+</span> <span class="s2">&quot; is not in the namelist definition.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_user_modifiable_in_variable_definition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="c1"># Is name user modifiable?</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_optional_child</span><span class="p">(</span><span class="s2">&quot;entry&quot;</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">})</span>
        <span class="n">user_modifiable_only_by_xml</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;modify_via_xml&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">user_modifiable_only_by_xml</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">expect</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;Cannot change </span><span class="si">{}</span><span class="s2"> in user_nl file: set via xml variable </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">name</span><span class="p">,</span> <span class="n">user_modifiable_only_by_xml</span>
                <span class="p">),</span>
            <span class="p">)</span>
        <span class="n">user_cannot_modify</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;cannot_modify_by_user_nl&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">user_cannot_modify</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">expect</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;Cannot change </span><span class="si">{}</span><span class="s2"> in user_nl file: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">user_cannot_modify</span><span class="p">),</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_generate_variable_template</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="c1"># Improve error reporting when a file name is provided.</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">variable_template</span> <span class="o">=</span> <span class="s2">&quot;Variable </span><span class="si">{!r}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># for the next step we want the name of the original user_nl file not the internal one</span>
            <span class="c1"># We do this by extracting the component name from the filepath string</span>
            <span class="k">if</span> <span class="s2">&quot;Buildconf&quot;</span> <span class="ow">in</span> <span class="n">filename</span> <span class="ow">and</span> <span class="s2">&quot;namelist_infile&quot;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
                <span class="n">msgfn</span> <span class="o">=</span> <span class="s2">&quot;user_nl_&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">])[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msgfn</span> <span class="o">=</span> <span class="n">filename</span>
            <span class="n">variable_template</span> <span class="o">=</span> <span class="s2">&quot;Variable </span><span class="si">{!r}</span><span class="s2"> from file &quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">msgfn</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">variable_template</span>

<div class="viewcode-block" id="NamelistDefinition.validate">
<a class="viewcode-back" href="../../../CIME_api/CIME.XML.html#CIME.XML.namelist_definition.NamelistDefinition.validate">[docs]</a>
    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">namelist</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate a namelist object against this definition.</span>

<span class="sd">        The optional `filename` argument can be used to assist in error</span>
<span class="sd">        reporting when the namelist comes from a specific, known file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">variable_template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_variable_template</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="c1"># Iterate through variables.</span>
        <span class="k">for</span> <span class="n">group_name</span> <span class="ow">in</span> <span class="n">namelist</span><span class="o">.</span><span class="n">get_group_names</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">variable_name</span> <span class="ow">in</span> <span class="n">namelist</span><span class="o">.</span><span class="n">get_variable_names</span><span class="p">(</span><span class="n">group_name</span><span class="p">):</span>
                <span class="c1"># Check that the variable is defined...</span>
                <span class="n">qualified_variable_name</span> <span class="o">=</span> <span class="n">get_fortran_name_only</span><span class="p">(</span><span class="n">variable_name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_expect_variable_in_definition</span><span class="p">(</span>
                    <span class="n">qualified_variable_name</span><span class="p">,</span> <span class="n">variable_template</span>
                <span class="p">)</span>

                <span class="c1"># Check if can actually change this variable via filename change</span>
                <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_user_modifiable_in_variable_definition</span><span class="p">(</span>
                        <span class="n">qualified_variable_name</span>
                    <span class="p">)</span>

                <span class="c1"># and has the right group name...</span>
                <span class="n">var_group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">qualified_variable_name</span><span class="p">)</span>
                <span class="n">expect</span><span class="p">(</span>
                    <span class="n">var_group</span> <span class="o">==</span> <span class="n">group_name</span><span class="p">,</span>
                    <span class="p">(</span>
                        <span class="n">variable_template</span>
                        <span class="o">+</span> <span class="s2">&quot; is in a group named </span><span class="si">{!r}</span><span class="s2">, but should be in </span><span class="si">{!r}</span><span class="s2">.&quot;</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">variable_name</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">group_name</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">var_group</span><span class="p">)),</span>
                <span class="p">)</span>

                <span class="c1"># and has a valid value.</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">namelist</span><span class="o">.</span><span class="n">get_variable_value</span><span class="p">(</span><span class="n">group_name</span><span class="p">,</span> <span class="n">variable_name</span><span class="p">)</span>
                <span class="n">expect</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">is_valid_value</span><span class="p">(</span><span class="n">qualified_variable_name</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">variable_template</span> <span class="o">+</span> <span class="s2">&quot; has invalid value </span><span class="si">{!r}</span><span class="s2">.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">variable_name</span><span class="p">),</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">scalar</span><span class="p">)</span> <span class="k">for</span> <span class="n">scalar</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
                    <span class="p">),</span>
                <span class="p">)</span></div>


<div class="viewcode-block" id="NamelistDefinition.dict_to_namelist">
<a class="viewcode-back" href="../../../CIME_api/CIME.XML.html#CIME.XML.namelist_definition.NamelistDefinition.dict_to_namelist">[docs]</a>
    <span class="k">def</span> <span class="nf">dict_to_namelist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict_</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts a dictionary of name-value pairs to a `Namelist`.</span>

<span class="sd">        The input is assumed to be similar to the output of `parse` when</span>
<span class="sd">        `groupless=True` is set. This function uses the namelist definition file</span>
<span class="sd">        to look up the namelist group associated with each variable, and uses</span>
<span class="sd">        this information to create a true `Namelist` object.</span>

<span class="sd">        The optional `filename` argument can be used to assist in error</span>
<span class="sd">        reporting when the namelist comes from a specific, known file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Improve error reporting when a file name is provided.</span>
        <span class="n">variable_template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_variable_template</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">variable_name</span> <span class="ow">in</span> <span class="n">dict_</span><span class="p">:</span>
            <span class="n">variable_lc</span> <span class="o">=</span> <span class="n">variable_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">qualified_varname</span> <span class="o">=</span> <span class="n">get_fortran_name_only</span><span class="p">(</span><span class="n">variable_lc</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_expect_variable_in_definition</span><span class="p">(</span><span class="n">qualified_varname</span><span class="p">,</span> <span class="n">variable_template</span><span class="p">)</span>
            <span class="n">group_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">qualified_varname</span><span class="p">)</span>
            <span class="n">expect</span><span class="p">(</span>
                <span class="n">group_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;No group found for var </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variable_lc</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">group_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
                <span class="n">groups</span><span class="p">[</span><span class="n">group_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">()</span>
            <span class="n">groups</span><span class="p">[</span><span class="n">group_name</span><span class="p">][</span><span class="n">variable_lc</span><span class="p">]</span> <span class="o">=</span> <span class="n">dict_</span><span class="p">[</span><span class="n">variable_name</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">Namelist</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span></div>


<div class="viewcode-block" id="NamelistDefinition.get_input_pathname">
<a class="viewcode-back" href="../../../CIME_api/CIME.XML.html#CIME.XML.namelist_definition.NamelistDefinition.get_input_pathname">[docs]</a>
    <span class="k">def</span> <span class="nf">get_input_pathname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nodes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_version</span><span class="p">()</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="n">input_pathname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;input_pathname&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_version</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mf">2.0</span><span class="p">:</span>
            <span class="n">input_pathname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_node_element_info</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;input_pathname&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">input_pathname</span></div>


    <span class="c1"># pylint: disable=arguments-differ</span>
<div class="viewcode-block" id="NamelistDefinition.get_default_value">
<a class="viewcode-back" href="../../../CIME_api/CIME.XML.html#CIME.XML.namelist_definition.NamelistDefinition.get_default_value">[docs]</a>
    <span class="k">def</span> <span class="nf">get_default_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">attribute</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the default value for the variable named `item`.</span>

<span class="sd">        The return value is a list of strings corresponding to the</span>
<span class="sd">        comma-separated list of entries for the value (length 1 for scalars). If</span>
<span class="sd">        there is no default value in the file, this returns `None`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Merge internal attributes with those passed in.</span>
        <span class="n">all_attributes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">all_attributes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">attribute</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">all_attributes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span>

        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_value_match</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">all_attributes</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017, U.S. National Science Foundation and U.S. Department of Energy.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
     
<script>var version_json_loc = "../../../../../versions.json";</script>


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>