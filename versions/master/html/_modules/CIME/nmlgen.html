<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CIME.nmlgen &mdash; CIME master documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=30d551ce"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/pop_ver.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            CIME
          </a>
              <div class="version">
                master
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../what_cime/index.html">What is CIME?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../users_guide/index.html">Case Control System Part 1: Basic Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../users_guide/index.html#case-control-system-part-2-configuration-porting-testing-and-use-cases">Case Control System Part 2: Configuration, Porting, Testing and Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../build_cpl/index.html">Building a Coupled Model with CIME</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc_tools/index.html">Miscellaneous Tools</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../glossary/index.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Tools_user/index.html">User Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../xml_files/index.html">XML Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CIME_api/modules.html">CIME</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Tools_api/modules.html">Tools</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">CIME</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">CIME.nmlgen</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for CIME.nmlgen</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Class for generating component namelists.&quot;&quot;&quot;</span>

<span class="c1"># Typically ignore this.</span>
<span class="c1"># pylint: disable=invalid-name</span>

<span class="c1"># Disable these because this is our standard setup</span>
<span class="c1"># pylint: disable=wildcard-import,unused-wildcard-import</span>

<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">hashlib</span>

<span class="kn">from</span> <span class="nn">CIME.XML.standard_module_setup</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">CIME.namelist</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Namelist</span><span class="p">,</span>
    <span class="n">parse</span><span class="p">,</span>
    <span class="n">character_literal_to_string</span><span class="p">,</span>
    <span class="n">string_to_character_literal</span><span class="p">,</span>
    <span class="n">expand_literal_list</span><span class="p">,</span>
    <span class="n">compress_literal_list</span><span class="p">,</span>
    <span class="n">merge_literal_lists</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">CIME.XML.namelist_definition</span> <span class="kn">import</span> <span class="n">NamelistDefinition</span>
<span class="kn">from</span> <span class="nn">CIME.utils</span> <span class="kn">import</span> <span class="n">expect</span><span class="p">,</span> <span class="n">safe_copy</span>
<span class="kn">from</span> <span class="nn">CIME.XML.stream</span> <span class="kn">import</span> <span class="n">Stream</span>
<span class="kn">from</span> <span class="nn">CIME.XML.grids</span> <span class="kn">import</span> <span class="n">GRID_SEP</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="n">_var_ref_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\$(\{)?(?P&lt;name&gt;\w+)(?(1)\})&quot;</span><span class="p">)</span>

<span class="n">_ymd_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;%(?P&lt;digits&gt;[1-9][0-9]*)?y(?P&lt;month&gt;m(?P&lt;day&gt;d)?)?&quot;</span><span class="p">)</span>

<span class="n">_stream_mct_file_template</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="s2">&lt;file id=&quot;stream&quot; version=&quot;1.0&quot;&gt;</span>
<span class="s2">&lt;dataSource&gt;</span>
<span class="s2">   GENERIC</span>
<span class="s2">&lt;/dataSource&gt;</span>
<span class="s2">&lt;domainInfo&gt;</span>
<span class="s2">  &lt;variableNames&gt;</span>
<span class="s2">     </span><span class="si">{domain_varnames}</span>
<span class="s2">  &lt;/variableNames&gt;</span>
<span class="s2">  &lt;filePath&gt;</span>
<span class="s2">     </span><span class="si">{domain_filepath}</span>
<span class="s2">  &lt;/filePath&gt;</span>
<span class="s2">  &lt;fileNames&gt;</span>
<span class="s2">     </span><span class="si">{domain_filenames}</span>
<span class="s2">  &lt;/fileNames&gt;</span>
<span class="s2">&lt;/domainInfo&gt;</span>
<span class="s2">&lt;fieldInfo&gt;</span>
<span class="s2">   &lt;variableNames&gt;</span>
<span class="s2">     </span><span class="si">{data_varnames}</span>
<span class="s2">   &lt;/variableNames&gt;</span>
<span class="s2">   &lt;filePath&gt;</span>
<span class="s2">     </span><span class="si">{data_filepath}</span>
<span class="s2">   &lt;/filePath&gt;</span>
<span class="s2">   &lt;fileNames&gt;</span>
<span class="s2">    </span><span class="si">{data_filenames}</span>
<span class="s2">   &lt;/fileNames&gt;</span>
<span class="s2">   &lt;offset&gt;</span>
<span class="s2">      </span><span class="si">{offset}</span>
<span class="s2">   &lt;/offset&gt;</span>
<span class="s2">&lt;/fieldInfo&gt;</span>
<span class="s2">&lt;/file&gt;</span>
<span class="s2">&quot;&quot;&quot;</span>


<div class="viewcode-block" id="NamelistGenerator">
<a class="viewcode-back" href="../../CIME_api/CIME.html#CIME.nmlgen.NamelistGenerator">[docs]</a>
<span class="k">class</span> <span class="nc">NamelistGenerator</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;Utility class for generating namelists for a given component.&quot;&quot;&quot;</span>

    <span class="n">_streams_variables</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># pylint:disable=too-many-arguments</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">case</span><span class="p">,</span> <span class="n">definition_files</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct a namelist generator.</span>

<span class="sd">        Arguments:</span>
<span class="sd">        `case`             - `Case` object corresponding to the current case.</span>
<span class="sd">        `infiles`          - List of files with user namelist options.</span>
<span class="sd">        `definition_files` - List of XML files containing namelist definitions.</span>
<span class="sd">        `config`           - A dictionary of attributes for matching defaults.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Save off important information from inputs.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_case</span> <span class="o">=</span> <span class="n">case</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_din_loc_root</span> <span class="o">=</span> <span class="n">case</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="s2">&quot;DIN_LOC_ROOT&quot;</span><span class="p">)</span>

        <span class="c1"># Create definition object - this will validate the xml schema in the definition file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_definition</span> <span class="o">=</span> <span class="n">NamelistDefinition</span><span class="p">(</span><span class="n">definition_files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">)</span>

        <span class="c1"># Determine array of _stream_variables from definition object</span>
        <span class="c1"># This is only applicable to data models</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_streams_namelists</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;streams&quot;</span><span class="p">:</span> <span class="p">[]}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_streams_variables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_definition</span><span class="o">.</span><span class="n">get_per_stream_entries</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_streams_variables</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_streams_namelists</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Create namelist object.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_namelist</span> <span class="o">=</span> <span class="n">Namelist</span><span class="p">()</span>

        <span class="c1"># entries for which we should potentially call add_default (variables that do not</span>
        <span class="c1"># set skip_default_entry)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_nodes</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Define __enter__ and __exit__ so that we can use this as a context manager</span>
    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>

<div class="viewcode-block" id="NamelistGenerator.init_defaults">
<a class="viewcode-back" href="../../CIME_api/CIME.html#CIME.nmlgen.NamelistGenerator.init_defaults">[docs]</a>
    <span class="k">def</span> <span class="nf">init_defaults</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">infiles</span><span class="p">,</span>
        <span class="n">config</span><span class="p">,</span>
        <span class="n">skip_groups</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">skip_entry_loop</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">skip_default_for_groups</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">set_group_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return array of names of all definition nodes</span>

<span class="sd">        infiles should be a list of file paths, each one giving namelist settings that</span>
<span class="sd">        take precedence over the default values. Often there will be only one file in this</span>
<span class="sd">        list. If there are multiple files, earlier files take precedence over later files.</span>

<span class="sd">        If skip_default_for_groups is provided, it should be a list of namelist group</span>
<span class="sd">        names; the add_default call will not be done for any variables in these</span>
<span class="sd">        groups. This is often paired with later conditional calls to</span>
<span class="sd">        add_defaults_for_group.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">skip_default_for_groups</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">skip_default_for_groups</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># first clean out any settings left over from previous calls</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_instance</span><span class="p">()</span>

        <span class="c1"># Determine the array of entry nodes that will be acted upon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_definition</span><span class="o">.</span><span class="n">set_nodes</span><span class="p">(</span><span class="n">skip_groups</span><span class="o">=</span><span class="n">skip_groups</span><span class="p">)</span>

        <span class="c1"># Add attributes to definition object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_definition</span><span class="o">.</span><span class="n">add_attributes</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

        <span class="c1"># Parse the infile and create namelist settings for the contents of infile</span>
        <span class="c1"># this will override all other settings in add_defaults</span>
        <span class="k">for</span> <span class="n">file_</span> <span class="ow">in</span> <span class="n">infiles</span><span class="p">:</span>
            <span class="c1"># Parse settings in &quot;groupless&quot; mode.</span>
            <span class="n">nml_dict</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="n">in_file</span><span class="o">=</span><span class="n">file_</span><span class="p">,</span> <span class="n">groupless</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Add groups using the namelist definition.</span>
            <span class="n">new_namelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_definition</span><span class="o">.</span><span class="n">dict_to_namelist</span><span class="p">(</span><span class="n">nml_dict</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">file_</span><span class="p">)</span>

            <span class="c1"># Make sure that the input is actually valid.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_definition</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">new_namelist</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">file_</span><span class="p">)</span>

            <span class="c1"># Merge into existing settings (earlier settings have precedence</span>
            <span class="c1"># over later settings).</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_namelist</span><span class="o">.</span><span class="n">merge_nl</span><span class="p">(</span><span class="n">new_namelist</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">skip_entry_loop</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_nodes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">set_group_name</span><span class="p">:</span>
                    <span class="n">group_name</span> <span class="o">=</span> <span class="n">set_group_name</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">group_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_definition</span><span class="o">.</span><span class="n">get_group_name</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">group_name</span> <span class="ow">in</span> <span class="n">skip_default_for_groups</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_default</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_definition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">))</span>

        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_definition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_nodes</span><span class="p">]</span></div>


<div class="viewcode-block" id="NamelistGenerator.rename_group">
<a class="viewcode-back" href="../../CIME_api/CIME.html#CIME.nmlgen.NamelistGenerator.rename_group">[docs]</a>
    <span class="k">def</span> <span class="nf">rename_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">newgroup</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Pass through to namelist definition&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_definition</span><span class="o">.</span><span class="n">rename_group</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">newgroup</span><span class="p">)</span></div>


<div class="viewcode-block" id="NamelistGenerator.add_defaults_for_group">
<a class="viewcode-back" href="../../CIME_api/CIME.html#CIME.nmlgen.NamelistGenerator.add_defaults_for_group">[docs]</a>
    <span class="k">def</span> <span class="nf">add_defaults_for_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call add_default for namelist variables in the given group</span>

<span class="sd">        This still skips variables that have attributes of skip_default_entry or</span>
<span class="sd">        per_stream_entry.</span>

<span class="sd">        This must be called after init_defaults. It is often paired with use of</span>
<span class="sd">        skip_default_for_groups in the init_defaults call.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_nodes</span><span class="p">:</span>
            <span class="n">group_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_definition</span><span class="o">.</span><span class="n">get_group_name</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">group_name</span> <span class="o">==</span> <span class="n">group</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_default</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_definition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">))</span></div>


<div class="viewcode-block" id="NamelistGenerator.confirm_group_is_empty">
<a class="viewcode-back" href="../../CIME_api/CIME.html#CIME.nmlgen.NamelistGenerator.confirm_group_is_empty">[docs]</a>
    <span class="k">def</span> <span class="nf">confirm_group_is_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">errmsg</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Confirms that no values have been added to the given group</span>

<span class="sd">        If any values HAVE been added to this group, aborts with the given error message.</span>

<span class="sd">        This is often paired with use of skip_default_for_groups in the init_defaults call</span>
<span class="sd">        and add_defaults_for_group, as in:</span>

<span class="sd">            if nmlgen.get_value(&quot;enable_frac_overrides&quot;) == &quot;.true.&quot;:</span>
<span class="sd">                nmlgen.add_defaults_for_group(&quot;glc_override_nml&quot;)</span>
<span class="sd">            else:</span>
<span class="sd">                nmlgen.confirm_empty(&quot;glc_override_nml&quot;, &quot;some message&quot;)</span>

<span class="sd">        Args:</span>
<span class="sd">        group_name: string - name of namelist group</span>
<span class="sd">        errmsg: string - error message to print if group is not empty</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">variables_in_group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_namelist</span><span class="o">.</span><span class="n">get_variable_names</span><span class="p">(</span><span class="n">group_name</span><span class="p">)</span>
        <span class="n">fullmsg</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="se">\n</span><span class="s2">Offending variables: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">errmsg</span><span class="p">,</span> <span class="n">variables_in_group</span><span class="p">)</span>
        <span class="n">expect</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">variables_in_group</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fullmsg</span><span class="p">)</span></div>


<div class="viewcode-block" id="NamelistGenerator.quote_string">
<a class="viewcode-back" href="../../CIME_api/CIME.html#CIME.nmlgen.NamelistGenerator.quote_string">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">quote_string</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert a string to a quoted Fortran literal.</span>

<span class="sd">        Does nothing if the string appears to be quoted already.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">or</span> <span class="p">(</span><span class="n">string</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">string</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">string</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">string</span> <span class="o">=</span> <span class="n">string_to_character_literal</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">string</span></div>


    <span class="k">def</span> <span class="nf">_to_python_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">literals</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Transform a literal list as needed for `get_value`.&quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">var_type</span><span class="p">,</span>
            <span class="n">_</span><span class="p">,</span>
            <span class="n">var_size</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_definition</span><span class="o">.</span><span class="n">split_type_string</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">literals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">literals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">expand_literal_list</span><span class="p">(</span><span class="n">literals</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">scalar</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">scalar</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">elif</span> <span class="n">var_type</span> <span class="o">==</span> <span class="s2">&quot;character&quot;</span><span class="p">:</span>
                <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">character_literal_to_string</span><span class="p">(</span><span class="n">scalar</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">var_size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">values</span>

    <span class="k">def</span> <span class="nf">_to_namelist_literals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Transform a literal list as needed for `set_value`.</span>

<span class="sd">        This is the inverse of `_to_python_value`, except that many of the</span>
<span class="sd">        changes have potentially already been performed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">var_type</span><span class="p">,</span>
            <span class="n">_</span><span class="p">,</span>
            <span class="n">var_size</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_definition</span><span class="o">.</span><span class="n">split_type_string</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">var_size</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">values</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">scalar</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">scalar</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">elif</span> <span class="n">var_type</span> <span class="o">==</span> <span class="s2">&quot;character&quot;</span><span class="p">:</span>
                <span class="n">expect</span><span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scalar</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span> <span class="n">name</span><span class="p">)</span>
                <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">quote_string</span><span class="p">(</span><span class="n">scalar</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">compress_literal_list</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

<div class="viewcode-block" id="NamelistGenerator.get_value">
<a class="viewcode-back" href="../../CIME_api/CIME.html#CIME.nmlgen.NamelistGenerator.get_value">[docs]</a>
    <span class="k">def</span> <span class="nf">get_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the current value of a given namelist variable.</span>

<span class="sd">        Note that the return value of this function is always a string or a list</span>
<span class="sd">        of strings. E.g. the scalar logical value .false. will be returned as</span>
<span class="sd">        `&quot;.false.&quot;`, while an array of two .false. values will be returned as</span>
<span class="sd">        `[&quot;.false.&quot;, &quot;.false.&quot;]`. Whether or not a value is scalar is determined</span>
<span class="sd">        by checking the array size in the namelist definition file.</span>

<span class="sd">        Null values are converted to `None`, and repeated values are expanded,</span>
<span class="sd">        e.g. `[&#39;2*3&#39;]` is converted to `[&#39;3&#39;, &#39;3&#39;, &#39;3&#39;]`.</span>

<span class="sd">        For character variables, the value is converted to a Python string (e.g.</span>
<span class="sd">        quotation marks are removed).</span>

<span class="sd">        All other literals are returned as the raw string values that will be</span>
<span class="sd">        written to the namelist.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_python_value</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_namelist</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="n">name</span><span class="p">))</span></div>


<div class="viewcode-block" id="NamelistGenerator.set_value">
<a class="viewcode-back" href="../../CIME_api/CIME.html#CIME.nmlgen.NamelistGenerator.set_value">[docs]</a>
    <span class="k">def</span> <span class="nf">set_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the current value of a given namelist variable.</span>

<span class="sd">        Usually, you should use `add_default` instead of this function.</span>

<span class="sd">        The `name` argument is the name of the variable to set, and the `value`</span>
<span class="sd">        is a list of strings to use as settings. If the variable is scalar, the</span>
<span class="sd">        list is optional; i.e. a scalar logical can be set using either</span>
<span class="sd">        `value=&#39;.false.&#39;` or `value=[&#39;.false.&#39;]`. If the variable is of type</span>
<span class="sd">        character, and the input is missing quotes, quotes will be added</span>
<span class="sd">        automatically. If `None` is provided in place of a string, this will be</span>
<span class="sd">        translated to a null value.</span>

<span class="sd">        Note that this function will overwrite the current value, which may hold</span>
<span class="sd">        a user-specified setting. Even if `value` is (or contains) a null value,</span>
<span class="sd">        the old setting for the variable will be thrown out completely.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">var_group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_definition</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">literals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_namelist_literals</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="p">(</span>
            <span class="n">_</span><span class="p">,</span>
            <span class="n">_</span><span class="p">,</span>
            <span class="n">var_size</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_definition</span><span class="o">.</span><span class="n">split_type_string</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">literals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">literals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_namelist</span><span class="o">.</span><span class="n">set_variable_value</span><span class="p">(</span><span class="n">var_group</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">literals</span><span class="p">,</span> <span class="n">var_size</span><span class="p">)</span></div>


<div class="viewcode-block" id="NamelistGenerator.get_default">
<a class="viewcode-back" href="../../CIME_api/CIME.html#CIME.nmlgen.NamelistGenerator.get_default">[docs]</a>
    <span class="k">def</span> <span class="nf">get_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the value of a variable from the namelist definition file.</span>

<span class="sd">        The `config` argument is passed through to the underlying</span>
<span class="sd">        `NamelistDefaults.get_value` call as the `attribute` argument.</span>

<span class="sd">        The return value of this function is a list of values that were found in</span>
<span class="sd">        the defaults file. If there is no matching default, this function</span>
<span class="sd">        returns `None` if `allow_none=True` is passed, otherwise an error is</span>
<span class="sd">        raised.</span>

<span class="sd">        Note that we perform some translation of the values, since there are a</span>
<span class="sd">        few differences between Fortran namelist literals and values in the</span>
<span class="sd">        defaults file:</span>
<span class="sd">        1) In the defaults file, whitespace is ignored except within strings, so</span>
<span class="sd">           the output of this function strips out most whitespace. (This implies</span>
<span class="sd">           that commas are the only way to separate array elements in the</span>
<span class="sd">           defaults file.)</span>
<span class="sd">        2) In the defaults file, quotes around character literals (strings) are</span>
<span class="sd">           optional, as long as the literal does not contain whitespace, commas,</span>
<span class="sd">           or (single or double) quotes. If a setting for a character variable</span>
<span class="sd">           does not seem to have quotes (and is not a null value), this function</span>
<span class="sd">           will add them.</span>
<span class="sd">        3) Default values may refer to variables in a case&#39;s `env_*.xml` files.</span>
<span class="sd">           This function replaces references of the form `$VAR` or `${VAR}` with</span>
<span class="sd">           the value of the variable `VAR` in an env file, if that variable</span>
<span class="sd">           exists. This behavior is suppressed within single-quoted strings</span>
<span class="sd">           (similar to parameter expansion in shell scripts).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_definition</span><span class="o">.</span><span class="n">get_value_match</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="n">config</span><span class="p">,</span> <span class="n">exact_match</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">expect</span><span class="p">(</span><span class="n">allow_none</span><span class="p">,</span> <span class="s2">&quot;No default value found for </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">default</span> <span class="o">=</span> <span class="n">expand_literal_list</span><span class="p">(</span><span class="n">default</span><span class="p">)</span>

        <span class="n">var_type</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_definition</span><span class="o">.</span><span class="n">split_type_string</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">scalar</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">default</span><span class="p">):</span>
            <span class="c1"># Skip single-quoted strings.</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">var_type</span> <span class="o">==</span> <span class="s2">&quot;character&quot;</span>
                <span class="ow">and</span> <span class="n">scalar</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span>
                <span class="ow">and</span> <span class="n">scalar</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">scalar</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&#39;&quot;</span>
            <span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">_var_ref_re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">scalar</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">env_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_case</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">env_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">scalar</span> <span class="o">=</span> <span class="n">scalar</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">env_val</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">match</span> <span class="o">=</span> <span class="n">_var_ref_re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">scalar</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">scalar</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;Namelist default for variable </span><span class="si">{}</span><span class="s2"> refers to unknown XML variable </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">name</span><span class="p">,</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">match</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">default</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">scalar</span>

        <span class="c1"># Deal with missing quotes.</span>

        <span class="k">if</span> <span class="n">var_type</span> <span class="o">==</span> <span class="s2">&quot;character&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">scalar</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">default</span><span class="p">):</span>
                <span class="c1"># Preserve null values.</span>
                <span class="k">if</span> <span class="n">scalar</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">default</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">quote_string</span><span class="p">(</span><span class="n">scalar</span><span class="p">)</span>

        <span class="n">default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_python_value</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">default</span></div>


<div class="viewcode-block" id="NamelistGenerator.get_streams">
<a class="viewcode-back" href="../../CIME_api/CIME.html#CIME.nmlgen.NamelistGenerator.get_streams">[docs]</a>
    <span class="k">def</span> <span class="nf">get_streams</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a list of all streams used for the current data model  mode.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default</span><span class="p">(</span><span class="s2">&quot;streamslist&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="NamelistGenerator.clean_streams">
<a class="viewcode-back" href="../../CIME_api/CIME.html#CIME.nmlgen.NamelistGenerator.clean_streams">[docs]</a>
    <span class="k">def</span> <span class="nf">clean_streams</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_streams_variables</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_streams_namelists</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_streams_namelists</span><span class="p">[</span><span class="s2">&quot;streams&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span></div>


<div class="viewcode-block" id="NamelistGenerator.new_instance">
<a class="viewcode-back" href="../../CIME_api/CIME.html#CIME.nmlgen.NamelistGenerator.new_instance">[docs]</a>
    <span class="k">def</span> <span class="nf">new_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clean the object just enough to introduce a new instance&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clean_streams</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_namelist</span><span class="o">.</span><span class="n">clean_groups</span><span class="p">()</span></div>


    <span class="k">def</span> <span class="nf">_sub_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">varnames</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Substitute indicators with given values in a list of fields.</span>

<span class="sd">        Replace any instance of the following substring indicators with the</span>
<span class="sd">        appropriate values:</span>
<span class="sd">            %glc = two-digit GLC elevation class from 00 through glc_nec</span>

<span class="sd">        The difference between this function and `_sub_paths` is that this</span>
<span class="sd">        function is intended to be used for variable names (especially from the</span>
<span class="sd">        `strm_datvar` defaults), whereas `_sub_paths` is intended for use on</span>
<span class="sd">        input data file paths.</span>

<span class="sd">        Returns a string.</span>

<span class="sd">        Example: If `_sub_fields` is called with an array containing two</span>
<span class="sd">        elements, each of which contains two strings, and glc_nec=3:</span>
<span class="sd">             foo               bar</span>
<span class="sd">             s2x_Ss_tsrf%glc   tsrf%glc</span>
<span class="sd">         then the returned array will be:</span>
<span class="sd">             foo               bar</span>
<span class="sd">             s2x_Ss_tsrf00     tsrf00</span>
<span class="sd">             s2x_Ss_tsrf01     tsrf01</span>
<span class="sd">             s2x_Ss_tsrf02     tsrf02</span>
<span class="sd">             s2x_Ss_tsrf03     tsrf03</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">varnames</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">new_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="s2">&quot;</span><span class="si">%g</span><span class="s2">lc&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_case</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="s2">&quot;GLC_NEC&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">glc_nec_indices</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">glc_nec_indices</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_case</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="s2">&quot;GLC_NEC&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">glc_nec_indices</span><span class="p">:</span>
                    <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%g</span><span class="s2">lc&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{:02d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_lines</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_days_in_month</span><span class="p">(</span><span class="n">month</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Number of days in the given month (specified as an int, 1-12).</span>

<span class="sd">        The `year` argument gives the year for which to request the number of</span>
<span class="sd">        days, in a Gregorian calendar. Defaults to `1` (not a leap year).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">month_start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">month</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
            <span class="n">next_year</span> <span class="o">=</span> <span class="n">year</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">next_month</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">next_year</span> <span class="o">=</span> <span class="n">year</span>
            <span class="n">next_month</span> <span class="o">=</span> <span class="n">month</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">next_month_start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">next_year</span><span class="p">,</span> <span class="n">next_month</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">next_month_start</span> <span class="o">-</span> <span class="n">month_start</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>

    <span class="k">def</span> <span class="nf">_sub_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filenames</span><span class="p">,</span> <span class="n">year_start</span><span class="p">,</span> <span class="n">year_end</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Substitute indicators with given values in a list of filenames.</span>

<span class="sd">        Replace any instance of the following substring indicators with the</span>
<span class="sd">        appropriate values:</span>
<span class="sd">            %y    = year from the range year_start to year_end</span>
<span class="sd">            %ym   = year-month from the range year_start to year_end with all 12</span>
<span class="sd">                    months</span>
<span class="sd">            %ymd  = year-month-day from the range year_start to year_end with</span>
<span class="sd">                    all 12 months</span>

<span class="sd">        For the date indicators, the year may be prefixed with a number of</span>
<span class="sd">        digits to use (the default is 4). E.g. `%2ymd` can be used to change the</span>
<span class="sd">        number of year digits from 4 to 2.</span>

<span class="sd">        Note that we assume that there is no mixing and matching of date</span>
<span class="sd">        indicators, i.e. you cannot use `%4ymd` and `%2y` in the same line. Note</span>
<span class="sd">        also that we use a no-leap calendar, i.e. every month has the same</span>
<span class="sd">        number of days every year.</span>

<span class="sd">        The difference between this function and `_sub_fields` is that this</span>
<span class="sd">        function is intended to be used for file names (especially from the</span>
<span class="sd">        `strm_datfil` defaults), whereas `_sub_fields` is intended for use on</span>
<span class="sd">        variable names.</span>

<span class="sd">        Returns a string (filenames separated by newlines).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">filenames</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">line</span><span class="p">]</span>
        <span class="n">new_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">_ymd_re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;digits&quot;</span><span class="p">):</span>
                <span class="n">year_format</span> <span class="o">=</span> <span class="s2">&quot;{:0&quot;</span> <span class="o">+</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;digits&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;d}&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">year_format</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:04d}</span><span class="s2">&quot;</span>
            <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">year_start</span><span class="p">,</span> <span class="n">year_end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;day&quot;</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">):</span>
                        <span class="n">days</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_days_in_month</span><span class="p">(</span><span class="n">month</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">days</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                            <span class="n">date_string</span> <span class="o">=</span> <span class="p">(</span><span class="n">year_format</span> <span class="o">+</span> <span class="s2">&quot;-</span><span class="si">{:02d}</span><span class="s2">-</span><span class="si">{:02d}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span>
                            <span class="p">)</span>
                            <span class="n">new_line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">date_string</span><span class="p">)</span>
                            <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_line</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;month&quot;</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">):</span>
                        <span class="n">date_string</span> <span class="o">=</span> <span class="p">(</span><span class="n">year_format</span> <span class="o">+</span> <span class="s2">&quot;-</span><span class="si">{:02d}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">)</span>
                        <span class="n">new_line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">date_string</span><span class="p">)</span>
                        <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_line</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">date_string</span> <span class="o">=</span> <span class="n">year_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
                    <span class="n">new_line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">date_string</span><span class="p">)</span>
                    <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_line</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_lines</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_add_xml_delimiter</span><span class="p">(</span><span class="n">list_to_deliminate</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">):</span>
        <span class="n">expect</span><span class="p">(</span><span class="n">delimiter</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s2">&quot; &quot;</span> <span class="ow">in</span> <span class="n">delimiter</span><span class="p">,</span> <span class="s2">&quot;Missing or badly formed delimiter&quot;</span><span class="p">)</span>
        <span class="n">pred</span> <span class="o">=</span> <span class="s2">&quot;&lt;</span><span class="si">{}</span><span class="s2">&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">delimiter</span><span class="p">)</span>
        <span class="n">postd</span> <span class="o">=</span> <span class="s2">&quot;&lt;/</span><span class="si">{}</span><span class="s2">&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">delimiter</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_to_deliminate</span><span class="p">):</span>
            <span class="n">list_to_deliminate</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">pred</span> <span class="o">+</span> <span class="n">list_to_deliminate</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="n">postd</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">      &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">list_to_deliminate</span><span class="p">)</span>

<div class="viewcode-block" id="NamelistGenerator.create_stream_file_and_update_shr_strdata_nml">
<a class="viewcode-back" href="../../CIME_api/CIME.html#CIME.nmlgen.NamelistGenerator.create_stream_file_and_update_shr_strdata_nml">[docs]</a>
    <span class="k">def</span> <span class="nf">create_stream_file_and_update_shr_strdata_nml</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">config</span><span class="p">,</span>
        <span class="n">caseroot</span><span class="p">,</span>  <span class="c1"># pylint:disable=too-many-locals</span>
        <span class="n">stream</span><span class="p">,</span>
        <span class="n">stream_path</span><span class="p">,</span>
        <span class="n">data_list_path</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write the pseudo-XML file corresponding to a given stream.</span>

<span class="sd">        Arguments:</span>
<span class="sd">        `config` - Used to look up namelist defaults. This is used *in addition*</span>
<span class="sd">                   to the `config` used to construct the namelist generator. The</span>
<span class="sd">                   main reason to supply additional configuration options here</span>
<span class="sd">                   is to specify stream-specific settings.</span>
<span class="sd">        `stream` - Name of the stream.</span>
<span class="sd">        `stream_path` - Path to write the stream file to.</span>
<span class="sd">        `data_list_path` - Path of file to append input data information to.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">stream_path</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">stream_path</span><span class="p">)</span>
        <span class="n">user_stream_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">caseroot</span><span class="p">,</span> <span class="s2">&quot;user_&quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">stream_path</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Use the user&#39;s stream file, or create one if necessary.</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">config</span><span class="p">[</span><span class="s2">&quot;stream&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stream</span>

        <span class="c1"># Stream-specific configuration.</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">user_stream_path</span><span class="p">):</span>
            <span class="n">safe_copy</span><span class="p">(</span><span class="n">user_stream_path</span><span class="p">,</span> <span class="n">stream_path</span><span class="p">)</span>
            <span class="n">strmobj</span> <span class="o">=</span> <span class="n">Stream</span><span class="p">(</span><span class="n">infile</span><span class="o">=</span><span class="n">stream_path</span><span class="p">)</span>
            <span class="n">domain_filepath</span> <span class="o">=</span> <span class="n">strmobj</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="s2">&quot;domainInfo/filePath&quot;</span><span class="p">)</span>
            <span class="n">data_filepath</span> <span class="o">=</span> <span class="n">strmobj</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="s2">&quot;fieldInfo/filePath&quot;</span><span class="p">)</span>
            <span class="n">domain_filenames</span> <span class="o">=</span> <span class="n">strmobj</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="s2">&quot;domainInfo/fileNames&quot;</span><span class="p">)</span>
            <span class="n">data_filenames</span> <span class="o">=</span> <span class="n">strmobj</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="s2">&quot;fieldInfo/fileNames&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Figure out the details of this stream.</span>
            <span class="k">if</span> <span class="n">stream</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;prescribed&quot;</span><span class="p">,</span> <span class="s2">&quot;copyall&quot;</span><span class="p">):</span>
                <span class="c1"># Assume only one file for prescribed mode!</span>
                <span class="n">grid_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default</span><span class="p">(</span><span class="s2">&quot;strm_grid_file&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
                <span class="n">domain_filepath</span><span class="p">,</span> <span class="n">domain_filenames</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">grid_file</span><span class="p">)</span>
                <span class="n">data_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default</span><span class="p">(</span><span class="s2">&quot;strm_data_file&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
                <span class="n">data_filepath</span><span class="p">,</span> <span class="n">data_filenames</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">data_file</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">domain_filepath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default</span><span class="p">(</span><span class="s2">&quot;strm_domdir&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
                <span class="n">domain_filenames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default</span><span class="p">(</span><span class="s2">&quot;strm_domfil&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
                <span class="n">data_filepath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default</span><span class="p">(</span><span class="s2">&quot;strm_datdir&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
                <span class="n">data_filenames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default</span><span class="p">(</span><span class="s2">&quot;strm_datfil&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

            <span class="n">domain_varnames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sub_fields</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_default</span><span class="p">(</span><span class="s2">&quot;strm_domvar&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">))</span>
            <span class="n">data_varnames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sub_fields</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_default</span><span class="p">(</span><span class="s2">&quot;strm_datvar&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">))</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default</span><span class="p">(</span><span class="s2">&quot;strm_offset&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
            <span class="n">year_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_default</span><span class="p">(</span><span class="s2">&quot;strm_year_start&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">))</span>
            <span class="n">year_end</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_default</span><span class="p">(</span><span class="s2">&quot;strm_year_end&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">))</span>
            <span class="n">data_filenames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sub_paths</span><span class="p">(</span><span class="n">data_filenames</span><span class="p">,</span> <span class="n">year_start</span><span class="p">,</span> <span class="n">year_end</span><span class="p">)</span>
            <span class="n">domain_filenames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sub_paths</span><span class="p">(</span><span class="n">domain_filenames</span><span class="p">,</span> <span class="n">year_start</span><span class="p">,</span> <span class="n">year_end</span><span class="p">)</span>

            <span class="c1"># Overwrite domain_file if should be set from stream data</span>
            <span class="k">if</span> <span class="n">domain_filenames</span> <span class="o">==</span> <span class="s2">&quot;null&quot;</span><span class="p">:</span>
                <span class="n">domain_filepath</span> <span class="o">=</span> <span class="n">data_filepath</span>
                <span class="n">domain_filenames</span> <span class="o">=</span> <span class="n">data_filenames</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">stream_file_text</span> <span class="o">=</span> <span class="n">_stream_mct_file_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">domain_varnames</span><span class="o">=</span><span class="n">domain_varnames</span><span class="p">,</span>
                <span class="n">domain_filepath</span><span class="o">=</span><span class="n">domain_filepath</span><span class="p">,</span>
                <span class="n">domain_filenames</span><span class="o">=</span><span class="n">domain_filenames</span><span class="p">,</span>
                <span class="n">data_varnames</span><span class="o">=</span><span class="n">data_varnames</span><span class="p">,</span>
                <span class="n">data_filepath</span><span class="o">=</span><span class="n">data_filepath</span><span class="p">,</span>
                <span class="n">data_filenames</span><span class="o">=</span><span class="n">data_filenames</span><span class="p">,</span>
                <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">stream_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream_file</span><span class="p">:</span>
                <span class="n">stream_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">stream_file_text</span><span class="p">)</span>

        <span class="n">lines_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_input_file_hash</span><span class="p">(</span><span class="n">data_list_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">data_list_path</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">input_data_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">filename</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">domain_filenames</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">filepath</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">filepath</span><span class="p">:</span>
                    <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">domain_filepath</span><span class="p">,</span> <span class="n">filename</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;domain</span><span class="si">{:d}</span><span class="s2"> = </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span>
                <span class="n">hashValue</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">hashValue</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">lines_hash</span><span class="p">:</span>
                    <span class="n">input_data_list</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">filename</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_filenames</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_filepath</span><span class="p">,</span> <span class="n">filename</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;file</span><span class="si">{:d}</span><span class="s2"> = </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span>
                <span class="n">hashValue</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">hashValue</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">lines_hash</span><span class="p">:</span>
                    <span class="n">input_data_list</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_shr_strdata_nml</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">stream_path</span><span class="p">)</span></div>


<div class="viewcode-block" id="NamelistGenerator.update_shr_strdata_nml">
<a class="viewcode-back" href="../../CIME_api/CIME.html#CIME.nmlgen.NamelistGenerator.update_shr_strdata_nml">[docs]</a>
    <span class="k">def</span> <span class="nf">update_shr_strdata_nml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">stream_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Updates values for the `shr_strdata_nml` namelist group.</span>

<span class="sd">        This should be done once per stream, and it shouldn&#39;t usually be called</span>
<span class="sd">        directly, since `create_stream_file` calls this method itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">config</span><span class="p">[</span><span class="s2">&quot;stream&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">stream</span>
        <span class="p">),</span> <span class="s2">&quot;config stream is </span><span class="si">{}</span><span class="s2">, but input stream is </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">config</span><span class="p">[</span><span class="s2">&quot;stream&quot;</span><span class="p">],</span> <span class="n">stream</span>
        <span class="p">)</span>
        <span class="c1"># Double-check the years for sanity.</span>
        <span class="n">year_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_default</span><span class="p">(</span><span class="s2">&quot;strm_year_start&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">))</span>
        <span class="n">year_end</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_default</span><span class="p">(</span><span class="s2">&quot;strm_year_end&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">))</span>
        <span class="n">year_align</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_default</span><span class="p">(</span><span class="s2">&quot;strm_year_align&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">))</span>
        <span class="n">expect</span><span class="p">(</span>
            <span class="n">year_end</span> <span class="o">&gt;=</span> <span class="n">year_start</span><span class="p">,</span>
            <span class="s2">&quot;Stream </span><span class="si">{}</span><span class="s2"> starts at year </span><span class="si">{:d}</span><span class="s2">, but ends at earlier year </span><span class="si">{:d}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">stream</span><span class="p">,</span> <span class="n">year_start</span><span class="p">,</span> <span class="n">year_end</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="c1"># Add to streams file.</span>
        <span class="n">stream_string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> </span><span class="si">{:d}</span><span class="s2"> </span><span class="si">{:d}</span><span class="s2"> </span><span class="si">{:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">stream_path</span><span class="p">),</span> <span class="n">year_align</span><span class="p">,</span> <span class="n">year_start</span><span class="p">,</span> <span class="n">year_end</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_streams_namelists</span><span class="p">[</span><span class="s2">&quot;streams&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stream_string</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_streams_variables</span><span class="p">:</span>
            <span class="n">default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
            <span class="n">expect</span><span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">default</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;Stream </span><span class="si">{}</span><span class="s2"> had multiple settings for variable </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">stream</span><span class="p">,</span> <span class="n">variable</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_streams_namelists</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">default</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>


<div class="viewcode-block" id="NamelistGenerator.set_abs_file_path">
<a class="viewcode-back" href="../../CIME_api/CIME.html#CIME.nmlgen.NamelistGenerator.set_abs_file_path">[docs]</a>
    <span class="k">def</span> <span class="nf">set_abs_file_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;If `file_path` is relative, make it absolute using `DIN_LOC_ROOT`.</span>

<span class="sd">        If an absolute path is input, it is returned unchanged.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">file_path</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fullpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_din_loc_root</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">fullpath</span></div>


<div class="viewcode-block" id="NamelistGenerator.add_default">
<a class="viewcode-back" href="../../CIME_api/CIME.html#CIME.nmlgen.NamelistGenerator.add_default">[docs]</a>
    <span class="k">def</span> <span class="nf">add_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ignore_abs_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a value for the specified variable to the namelist.</span>

<span class="sd">        If the specified variable is already defined in the object, the existing</span>
<span class="sd">        value is preserved. Otherwise, the `value` argument, if provided, will</span>
<span class="sd">        be used to set the value. If no such value is found, the defaults file</span>
<span class="sd">        will be consulted. If null values are present in any of the above, the</span>
<span class="sd">        result will be a merged array of values.</span>

<span class="sd">        If no value for the variable is found via any of the above, this method</span>
<span class="sd">        will raise an exception.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># pylint: disable=protected-access</span>
        <span class="n">group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_definition</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># Use this to see if we need to raise an error when nothing is found.</span>
        <span class="n">have_value</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Check for existing value.</span>
        <span class="n">current_literals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_namelist</span><span class="o">.</span><span class="n">get_variable_value</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">current_literals</span> <span class="o">!=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]:</span>
            <span class="n">have_value</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Check for input argument.</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">have_value</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># if compression were to occur, this is where it does</span>
            <span class="n">literals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_namelist_literals</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="n">current_literals</span> <span class="o">=</span> <span class="n">merge_literal_lists</span><span class="p">(</span><span class="n">literals</span><span class="p">,</span> <span class="n">current_literals</span><span class="p">)</span>

        <span class="c1"># Check for default value.</span>
        <span class="n">default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">have_value</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">default_literals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_namelist_literals</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
            <span class="n">current_literals</span> <span class="o">=</span> <span class="n">merge_literal_lists</span><span class="p">(</span><span class="n">default_literals</span><span class="p">,</span> <span class="n">current_literals</span><span class="p">)</span>
        <span class="n">expect</span><span class="p">(</span>
            <span class="n">have_value</span><span class="p">,</span>
            <span class="s2">&quot;No default value found for </span><span class="si">{}</span><span class="s2"> with attributes </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_definition</span><span class="o">.</span><span class="n">get_attributes</span><span class="p">()</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Go through file names and prepend input data root directory for</span>
        <span class="c1"># absolute pathnames.</span>
        <span class="n">var_type</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">var_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_definition</span><span class="o">.</span><span class="n">split_type_string</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">var_type</span> <span class="o">==</span> <span class="s2">&quot;character&quot;</span> <span class="ow">and</span> <span class="n">ignore_abs_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">var_input_pathname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_definition</span><span class="o">.</span><span class="n">get_input_pathname</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">var_input_pathname</span> <span class="o">==</span> <span class="s2">&quot;abs&quot;</span><span class="p">:</span>
                <span class="n">current_literals</span> <span class="o">=</span> <span class="n">expand_literal_list</span><span class="p">(</span><span class="n">current_literals</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">literal</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">current_literals</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">literal</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">file_path</span> <span class="o">=</span> <span class="n">character_literal_to_string</span><span class="p">(</span><span class="n">literal</span><span class="p">)</span>
                    <span class="n">abs_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_to_abs_file_path</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                    <span class="n">current_literals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">string_to_character_literal</span><span class="p">(</span><span class="n">abs_file_path</span><span class="p">)</span>
                <span class="n">current_literals</span> <span class="o">=</span> <span class="n">compress_literal_list</span><span class="p">(</span><span class="n">current_literals</span><span class="p">)</span>

        <span class="c1"># Set the new value.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_namelist</span><span class="o">.</span><span class="n">set_variable_value</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">current_literals</span><span class="p">,</span> <span class="n">var_size</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_convert_to_abs_file_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert the given file_path to an abs file path and return the result</span>

<span class="sd">        It&#39;s possible that file_path actually contains multiple files delimited by</span>
<span class="sd">        GRID_SEP. (This is the case when a component has multiple grids, and so has a file</span>
<span class="sd">        for each grid.) In this case, we split it on GRID_SEP and handle each separated</span>
<span class="sd">        portion as a separate file, then return a new GRID_SEP-delimited string.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">abs_file_paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># In most cases, the list created by the following split will only contain a</span>
        <span class="c1"># single element, but this split is needed to handle grid-related files for</span>
        <span class="c1"># components with multiple grids (e.g., GLC).</span>
        <span class="k">for</span> <span class="n">one_file_path</span> <span class="ow">in</span> <span class="n">file_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">GRID_SEP</span><span class="p">):</span>
            <span class="c1"># NOTE - these are hard-coded here and a better way is to make these extensible</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">one_file_path</span> <span class="o">==</span> <span class="s2">&quot;UNSET&quot;</span>
                <span class="ow">or</span> <span class="n">one_file_path</span> <span class="o">==</span> <span class="s2">&quot;idmap&quot;</span>
                <span class="ow">or</span> <span class="n">one_file_path</span> <span class="o">==</span> <span class="s2">&quot;idmap_ignore&quot;</span>
                <span class="ow">or</span> <span class="n">one_file_path</span> <span class="o">==</span> <span class="s2">&quot;unset&quot;</span>
            <span class="p">):</span>
                <span class="n">abs_file_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">one_file_path</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">one_file_path</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;null&quot;</span><span class="p">,</span> <span class="s2">&quot;create_mesh&quot;</span><span class="p">):</span>
                <span class="n">abs_file_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">one_file_path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">one_abs_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_abs_file_path</span><span class="p">(</span><span class="n">one_file_path</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">one_abs_file_path</span><span class="p">):</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;File not found: </span><span class="si">{}</span><span class="s2"> = </span><span class="si">{}</span><span class="s2">, will attempt to download in check_input_data phase&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">name</span><span class="p">,</span> <span class="n">one_abs_file_path</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="n">abs_file_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">one_abs_file_path</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">GRID_SEP</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">abs_file_paths</span><span class="p">)</span>

<div class="viewcode-block" id="NamelistGenerator.create_shr_strdata_nml">
<a class="viewcode-back" href="../../CIME_api/CIME.html#CIME.nmlgen.NamelistGenerator.create_shr_strdata_nml">[docs]</a>
    <span class="k">def</span> <span class="nf">create_shr_strdata_nml</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set defaults for `shr_strdata_nml` variables other than the variable domainfile&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_default</span><span class="p">(</span><span class="s2">&quot;datamode&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="s2">&quot;datamode&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;NULL&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_default</span><span class="p">(</span><span class="s2">&quot;streams&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_streams_namelists</span><span class="p">[</span><span class="s2">&quot;streams&quot;</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_streams_variables</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_default</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_streams_namelists</span><span class="p">[</span><span class="n">variable</span><span class="p">])</span></div>


<div class="viewcode-block" id="NamelistGenerator.get_group_variables">
<a class="viewcode-back" href="../../CIME_api/CIME.html#CIME.nmlgen.NamelistGenerator.get_group_variables">[docs]</a>
    <span class="k">def</span> <span class="nf">get_group_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_namelist</span><span class="o">.</span><span class="n">get_group_variables</span><span class="p">(</span><span class="n">group_name</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_get_input_file_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_list_path</span><span class="p">):</span>
        <span class="n">lines_hash</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">data_list_path</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">data_list_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">input_data_list</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">input_data_list</span><span class="p">:</span>
                    <span class="n">hashValue</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Found line </span><span class="si">{}</span><span class="s2"> with hash </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">hashValue</span><span class="p">))</span>
                    <span class="n">lines_hash</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hashValue</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lines_hash</span>

    <span class="k">def</span> <span class="nf">_write_input_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_list_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write input data files to list.&quot;&quot;&quot;</span>
        <span class="c1"># append to input_data_list file</span>
        <span class="n">lines_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_input_file_hash</span><span class="p">(</span><span class="n">data_list_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">data_list_path</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">input_data_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">group_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_namelist</span><span class="o">.</span><span class="n">get_group_names</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">variable_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_namelist</span><span class="o">.</span><span class="n">get_variable_names</span><span class="p">(</span><span class="n">group_name</span><span class="p">):</span>
                    <span class="n">input_pathname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_definition</span><span class="o">.</span><span class="n">get_node_element_info</span><span class="p">(</span>
                        <span class="n">variable_name</span><span class="p">,</span> <span class="s2">&quot;input_pathname&quot;</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">input_pathname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="c1"># This is where we end up for all variables that are paths</span>
                        <span class="c1"># to input data files.</span>
                        <span class="n">literals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_namelist</span><span class="o">.</span><span class="n">get_variable_value</span><span class="p">(</span>
                            <span class="n">group_name</span><span class="p">,</span> <span class="n">variable_name</span>
                        <span class="p">)</span>
                        <span class="k">for</span> <span class="n">literal</span> <span class="ow">in</span> <span class="n">literals</span><span class="p">:</span>
                            <span class="n">file_path</span> <span class="o">=</span> <span class="n">character_literal_to_string</span><span class="p">(</span><span class="n">literal</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_add_file_to_input_data_list</span><span class="p">(</span>
                                <span class="n">input_data_list</span><span class="o">=</span><span class="n">input_data_list</span><span class="p">,</span>
                                <span class="n">variable_name</span><span class="o">=</span><span class="n">variable_name</span><span class="p">,</span>
                                <span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span>
                                <span class="n">input_pathname</span><span class="o">=</span><span class="n">input_pathname</span><span class="p">,</span>
                                <span class="n">lines_hash</span><span class="o">=</span><span class="n">lines_hash</span><span class="p">,</span>
                            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_add_file_to_input_data_list</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">input_data_list</span><span class="p">,</span> <span class="n">variable_name</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">input_pathname</span><span class="p">,</span> <span class="n">lines_hash</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add one file to the input data list, if needed</span>

<span class="sd">        It&#39;s possible that file_path actually contains multiple files delimited by</span>
<span class="sd">        GRID_SEP. (This is the case when a component has multiple grids, and so has a file</span>
<span class="sd">        for each grid.) In this case, we split it on GRID_SEP and handle each separated</span>
<span class="sd">        portion as a separate file.</span>

<span class="sd">        Args:</span>
<span class="sd">        - input_data_list: file handle</span>
<span class="sd">        - variable_name (string): name of variable to add</span>
<span class="sd">        - file_path (string): path to file</span>
<span class="sd">        - input_pathname (string): whether this is an absolute or relative path</span>
<span class="sd">        - lines_hash (set): set of hashes of lines already in the given input data list</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">one_file_path</span> <span class="ow">in</span> <span class="n">file_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">GRID_SEP</span><span class="p">):</span>
            <span class="c1"># NOTE - these are hard-coded here and a better way is to make these extensible</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">one_file_path</span> <span class="o">==</span> <span class="s2">&quot;UNSET&quot;</span>
                <span class="ow">or</span> <span class="n">one_file_path</span> <span class="o">==</span> <span class="s2">&quot;idmap&quot;</span>
                <span class="ow">or</span> <span class="n">one_file_path</span> <span class="o">==</span> <span class="s2">&quot;idmap_ignore&quot;</span>
            <span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">input_pathname</span> <span class="o">==</span> <span class="s2">&quot;abs&quot;</span><span class="p">:</span>
                <span class="c1"># No further mangling needed for absolute paths.</span>
                <span class="c1"># At this point, there are overwrites that should be ignored</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">one_file_path</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">input_pathname</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;rel:&quot;</span><span class="p">):</span>
                <span class="c1"># The part past &quot;rel&quot; is the name of a variable that</span>
                <span class="c1"># this variable specifies its path relative to.</span>
                <span class="n">root_var</span> <span class="o">=</span> <span class="n">input_pathname</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span>
                <span class="n">root_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="n">root_var</span><span class="p">)</span>
                <span class="n">one_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_dir</span><span class="p">,</span> <span class="n">one_file_path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">expect</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Bad input_pathname value: </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">input_pathname</span><span class="p">))</span>

            <span class="c1"># Write to the input data list.</span>
            <span class="c1">#</span>
            <span class="c1"># Note that the same variable name is repeated for each file. This currently</span>
            <span class="c1"># seems okay for check_input_data, but if it becomes a problem, we could</span>
            <span class="c1"># change this, e.g., appending an index to the end of variable_name.</span>
            <span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variable_name</span><span class="p">,</span> <span class="n">one_file_path</span><span class="p">)</span>
            <span class="n">hashValue</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">hashValue</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">lines_hash</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Adding line </span><span class="si">{}</span><span class="s2"> with hash </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">hashValue</span><span class="p">))</span>
                <span class="n">input_data_list</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">string</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Line already in file </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">string</span><span class="p">))</span>

<div class="viewcode-block" id="NamelistGenerator.write_output_file">
<a class="viewcode-back" href="../../CIME_api/CIME.html#CIME.nmlgen.NamelistGenerator.write_output_file">[docs]</a>
    <span class="k">def</span> <span class="nf">write_output_file</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">namelist_file</span><span class="p">,</span> <span class="n">data_list_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sorted_groups</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write out the namelists and input data files.</span>

<span class="sd">        The `namelist_file` and `modelio_file` are the locations to which the</span>
<span class="sd">        component and modelio namelists will be written, respectively. The</span>
<span class="sd">        `data_list_path` argument is the location of the `*.input_data_list`</span>
<span class="sd">        file, which will have the input data files added to it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_definition</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_namelist</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">groups</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_namelist</span><span class="o">.</span><span class="n">get_group_names</span><span class="p">()</span>

        <span class="c1"># remove groups that are never in namelist file</span>
        <span class="k">if</span> <span class="s2">&quot;modelio&quot;</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
            <span class="n">groups</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;modelio&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;seq_maps&quot;</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
            <span class="n">groups</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;seq_maps&quot;</span><span class="p">)</span>

        <span class="c1"># write namelist file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_namelist</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">namelist_file</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="n">groups</span><span class="p">,</span> <span class="n">sorted_groups</span><span class="o">=</span><span class="n">sorted_groups</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">data_list_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_input_files</span><span class="p">(</span><span class="n">data_list_path</span><span class="p">)</span></div>


    <span class="c1"># For MCT</span>
<div class="viewcode-block" id="NamelistGenerator.add_nmlcontents">
<a class="viewcode-back" href="../../CIME_api/CIME.html#CIME.nmlgen.NamelistGenerator.add_nmlcontents">[docs]</a>
    <span class="k">def</span> <span class="nf">add_nmlcontents</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">format_</span><span class="o">=</span><span class="s2">&quot;nmlcontents&quot;</span><span class="p">,</span> <span class="n">sorted_groups</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write only contents of nml group&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_namelist</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="n">filename</span><span class="p">,</span>
            <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="n">group</span><span class="p">],</span>
            <span class="n">append</span><span class="o">=</span><span class="n">append</span><span class="p">,</span>
            <span class="n">format_</span><span class="o">=</span><span class="n">format_</span><span class="p">,</span>
            <span class="n">sorted_groups</span><span class="o">=</span><span class="n">sorted_groups</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="NamelistGenerator.write_seq_maps">
<a class="viewcode-back" href="../../CIME_api/CIME.html#CIME.nmlgen.NamelistGenerator.write_seq_maps">[docs]</a>
    <span class="k">def</span> <span class="nf">write_seq_maps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write mct out seq_maps.rc&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_namelist</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;seq_maps&quot;</span><span class="p">],</span> <span class="n">format_</span><span class="o">=</span><span class="s2">&quot;rc&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="NamelistGenerator.write_modelio_file">
<a class="viewcode-back" href="../../CIME_api/CIME.html#CIME.nmlgen.NamelistGenerator.write_modelio_file">[docs]</a>
    <span class="k">def</span> <span class="nf">write_modelio_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write mct component modelio files&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_namelist</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;modelio&quot;</span><span class="p">,</span> <span class="s2">&quot;pio_inparm&quot;</span><span class="p">],</span> <span class="n">format_</span><span class="o">=</span><span class="s2">&quot;nml&quot;</span><span class="p">)</span></div>


    <span class="c1"># For NUOPC</span>
<div class="viewcode-block" id="NamelistGenerator.write_nuopc_modelio_file">
<a class="viewcode-back" href="../../CIME_api/CIME.html#CIME.nmlgen.NamelistGenerator.write_nuopc_modelio_file">[docs]</a>
    <span class="k">def</span> <span class="nf">write_nuopc_modelio_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write nuopc component modelio files&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_namelist</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pio_inparm&quot;</span><span class="p">],</span> <span class="n">format_</span><span class="o">=</span><span class="s2">&quot;nml&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="NamelistGenerator.write_nuopc_config_file">
<a class="viewcode-back" href="../../CIME_api/CIME.html#CIME.nmlgen.NamelistGenerator.write_nuopc_config_file">[docs]</a>
    <span class="k">def</span> <span class="nf">write_nuopc_config_file</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">data_list_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sorted_groups</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write the nuopc config file&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_definition</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_namelist</span><span class="p">)</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_namelist</span><span class="o">.</span><span class="n">get_group_names</span><span class="p">()</span>
        <span class="c1"># write the config file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_namelist</span><span class="o">.</span><span class="n">write_nuopc</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="n">groups</span><span class="p">,</span> <span class="n">sorted_groups</span><span class="o">=</span><span class="n">sorted_groups</span><span class="p">)</span>
        <span class="c1"># append to input_data_list file</span>
        <span class="k">if</span> <span class="n">data_list_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_input_files</span><span class="p">(</span><span class="n">data_list_path</span><span class="p">)</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017, U.S. National Science Foundation and U.S. Department of Energy.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
     
<script>var version_json_loc = "../../../../versions.json";</script>


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>