

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>4. Building a Case &mdash; CIME master documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=30d551ce"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="5. Running a Case" href="running-a-case.html" />
    <link rel="prev" title="3. Setting up a Case" href="setting-up-a-case.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            CIME
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../what_cime/index.html">What is CIME?</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Using the Case Control System</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introduction-and-overview.html">1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="create-a-case.html">2. Creating a Case</a></li>
<li class="toctree-l2"><a class="reference internal" href="setting-up-a-case.html">3. Setting up a Case</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">4. Building a Case</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#calling-case-build">4.1. Calling <strong>case.build</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#rebuilding-the-model">4.2. Rebuilding the model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#input-data">4.3. Input data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="running-a-case.html">5. Running a Case</a></li>
<li class="toctree-l2"><a class="reference internal" href="cloning-a-case.html">6. Cloning a Case</a></li>
<li class="toctree-l2"><a class="reference internal" href="cime-change-namelist.html">7. Customizing your input variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="cime-config.html">8. CIME user config directory</a></li>
<li class="toctree-l2"><a class="reference internal" href="cime-customize.html">9. CIME config and hooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="testing.html">10. Testing Cases</a></li>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html">11. Troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#configuring-the-case-control-system">Configuring the Case Control System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build_cpl/index.html">Building a Coupled Model with CIME</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc_tools/index.html">Miscellaneous Tools</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../glossary/index.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tools_user/index.html">User Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../xml_files/index.html">XML Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CIME_api/modules.html">CIME</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tools_api/modules.html">Tools</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">CIME</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Using the Case Control System</a></li>
      <li class="breadcrumb-item active"><span class="section-number">4. </span>Building a Case</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/users_guide/building-a-case.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="building-a-case">
<span id="id1"></span><h1><span class="section-number">4. </span>Building a Case<a class="headerlink" href="#building-a-case" title="Link to this heading"></a></h1>
<p>Once the case has been created and setup, its time to build the executable.
Several directories full of source code must be built all with the same compiler and flags.
<strong>case.build</strong> performs all build operations (setting dependecies, invoking Make,
creating the executable).</p>
<section id="calling-case-build">
<span id="building-the-model"></span><h2><span class="section-number">4.1. </span>Calling <strong>case.build</strong><a class="headerlink" href="#calling-case-build" title="Link to this heading"></a></h2>
<p>After calling <a class="reference external" href="../Tools_user/case.setup.html">case.setup</a> , run <a class="reference external" href="../Tools_user/case.build.html">case.build</a>  to build the model executable. Running this will:</p>
<ol class="arabic simple">
<li><p>Create the component namelists in <code class="docutils literal notranslate"><span class="pre">$RUNDIR</span></code> and <code class="docutils literal notranslate"><span class="pre">$CASEROOT/CaseDocs</span></code>.</p></li>
<li><p>Create the necessary compiled libraries used by coupler and component models <code class="docutils literal notranslate"><span class="pre">mct</span></code>, <code class="docutils literal notranslate"><span class="pre">pio</span></code>, <code class="docutils literal notranslate"><span class="pre">gptl</span></code> and <code class="docutils literal notranslate"><span class="pre">csm_share</span></code>.
The libraries will be placed in a path below <code class="docutils literal notranslate"><span class="pre">$SHAREDLIBROOT</span></code>.</p></li>
<li><p>Create the necessary compiled libraries for each component model. These are be placed in <code class="docutils literal notranslate"><span class="pre">$EXEROOT/bld/lib</span></code>.</p></li>
<li><p>Create the model executable (<code class="docutils literal notranslate"><span class="pre">$MODEL.exe</span></code>), which is placed in <code class="docutils literal notranslate"><span class="pre">$EXEROOT</span></code>.</p></li>
</ol>
<p>You do not need to change the default build settings to create the executable, but it is useful to become familiar with them in order to make optimal use of the system. The CIME scripts provide you with a great deal of flexibility in customizing the build process.</p>
<p>The <strong>env_build.xml</strong> variables control various aspects of building the executable. Most of the variables should not be modified, but users can modify these:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">$BUILD_THREADED</span></code> : if TRUE, the model will be built with OpenMP.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$DEBUG</span></code> : if TRUE, the model is compiled with debugging instead of optimization flags.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$GMAKE_J</span></code> : How many threads GNUMake should use while building.</p></li>
</ul>
<p>The best way to see what xml variables are in your <code class="docutils literal notranslate"><span class="pre">$CASEROOT</span></code> directory is to use the <a class="reference external" href="../Tools_user/xmlquery.html">xmlquery</a>  command. For usage information, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="o">./</span><span class="n">xmlquery</span> <span class="o">--</span><span class="n">help</span>
</pre></div>
</div>
<p>To build the model, change to your <code class="docutils literal notranslate"><span class="pre">$CASEROOT</span></code> directory and execute <strong>case.build</strong>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&gt; cd $CASEROOT
&gt; ./case.build
</pre></div>
</div>
<p>Diagnostic comments appear as the build proceeds.</p>
<p>The <a class="reference external" href="../Tools_user/case.build.html">case.build</a>  command generates the utility and component libraries and the model executable, and it generates build logs for each component.
Each log file is named form: <strong>$component.bldlog.$datestamp</strong>. They are located in <code class="docutils literal notranslate"><span class="pre">$BLDDIR</span></code>. If they are compressed (as indicated by a .gz file extension), the build ran successfully.</p>
<p>Invoking <a class="reference external" href="../Tools_user/case.build.html">case.build</a>  creates the following directory structure in <code class="docutils literal notranslate"><span class="pre">$EXEROOT</span></code> if the Intel compiler is used:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">atm</span><span class="o">/</span><span class="p">,</span> <span class="n">cpl</span><span class="o">/</span><span class="p">,</span> <span class="n">esp</span><span class="o">/</span><span class="p">,</span> <span class="n">glc</span><span class="o">/</span><span class="p">,</span> <span class="n">ice</span><span class="o">/</span><span class="p">,</span> <span class="n">intel</span><span class="o">/</span><span class="p">,</span> <span class="n">lib</span><span class="o">/</span><span class="p">,</span> <span class="n">lnd</span><span class="o">/</span><span class="p">,</span> <span class="n">ocn</span><span class="o">/</span><span class="p">,</span> <span class="n">rof</span><span class="o">/</span><span class="p">,</span> <span class="n">wav</span><span class="o">/</span>
</pre></div>
</div>
<p>Except for <strong>intel/</strong> and <strong>lib/</strong>, each directory contains an <strong>obj/</strong> subdirectory for the target model component’s compiled object files.</p>
<p>The <em>mct</em>, <em>pio</em>, <em>gptl</em> and <em>csm_share</em> libraries are placed in a directory tree that reflects their dependencies. See the <strong>bldlog</strong> for a given component to locate the library.</p>
<p>Special <strong>include</strong> modules are placed in <strong>lib/include</strong>. The model executable (<strong>cesm.exe</strong> or <strong>e3sm.exe</strong>, for example) is placed directly in <code class="docutils literal notranslate"><span class="pre">$EXEROOT</span></code>.</p>
<p>Component namelists, component logs, output data sets, and restart files are placed in <code class="docutils literal notranslate"><span class="pre">$RUNDIR</span></code>.
It is important to note that <code class="docutils literal notranslate"><span class="pre">$RUNDIR</span></code> and <code class="docutils literal notranslate"><span class="pre">$EXEROOT</span></code> are independent variables that are set in the <strong>$CASEROOT/env_run.xml</strong> file.</p>
</section>
<section id="rebuilding-the-model">
<span id="id4"></span><h2><span class="section-number">4.2. </span>Rebuilding the model<a class="headerlink" href="#rebuilding-the-model" title="Link to this heading"></a></h2>
<p>Rebuild the model under the following circumstances:</p>
<p>If either <strong>env_build.xml</strong> or <strong>Macros.make</strong> has been modified, and/or if code is added to <strong>SourceMods/src.</strong>, it’s safest to clean the build and rebuild from scratch as shown here:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&gt; cd $CASEROOT
&gt; ./case.build --clean-all
</pre></div>
</div>
<p>If you have ONLY modified the PE layout in <strong>env_mach_pes.xml</strong>, a clean may not be required.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&gt; cd $CASEROOT
&gt; ./case.build
</pre></div>
</div>
<p>If the threading has been changed (turned on or off) in any component since the previous build, the build script should fail with the following error and suggestion that the model be rebuilt from scratch:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ERROR</span> <span class="n">SMP</span> <span class="n">STATUS</span> <span class="n">HAS</span> <span class="n">CHANGED</span>
<span class="n">SMP_BUILD</span> <span class="o">=</span> <span class="n">a0l0i0o0g0c0</span>
<span class="n">SMP_VALUE</span> <span class="o">=</span> <span class="n">a1l0i0o0g0c0</span>
<span class="n">A</span> <span class="n">manual</span> <span class="n">clean</span> <span class="n">of</span> <span class="n">your</span> <span class="n">obj</span> <span class="n">directories</span> <span class="ow">is</span> <span class="n">strongly</span> <span class="n">recommended</span><span class="o">.</span>
<span class="n">You</span> <span class="n">should</span> <span class="n">execute</span> <span class="n">the</span> <span class="n">following</span><span class="p">:</span>
   <span class="o">./</span><span class="n">case</span><span class="o">.</span><span class="n">build</span> <span class="o">--</span><span class="n">clean</span>
   <span class="o">./</span><span class="n">case</span><span class="o">.</span><span class="n">build</span>

 <span class="o">----</span> <span class="n">OR</span> <span class="o">----</span>

 <span class="n">You</span> <span class="n">can</span> <span class="n">override</span> <span class="n">this</span> <span class="n">error</span> <span class="n">message</span> <span class="n">at</span> <span class="n">your</span> <span class="n">own</span> <span class="n">risk</span> <span class="n">by</span> <span class="n">executing</span><span class="p">:</span>
   <span class="o">./</span><span class="n">xmlchange</span> <span class="n">SMP_BUILD</span><span class="o">=</span><span class="mi">0</span>
 <span class="n">Then</span> <span class="n">rerun</span> <span class="n">the</span> <span class="n">build</span> <span class="n">script</span> <span class="n">interactively</span><span class="o">.</span>
</pre></div>
</div>
<p>If there is any doubt, rebuild.</p>
<dl>
<dt>Run this to clean all of the model components (except for support libraries such as <em>mct</em> and <em>gptl</em>):</dt><dd><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">case</span><span class="o">.</span><span class="n">build</span> <span class="o">--</span><span class="n">clean</span>
</pre></div>
</div>
</dd>
<dt>Run this to clean everything associated with the build:</dt><dd><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">case</span><span class="o">.</span><span class="n">build</span> <span class="o">--</span><span class="n">clean</span><span class="o">-</span><span class="nb">all</span>
</pre></div>
</div>
</dd>
<dt>You can also clean an individual component as shown here, where “compname” is the name of the component you want to clean (for example, atm, clm, pio and so on).</dt><dd><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">case</span><span class="o">.</span><span class="n">build</span> <span class="o">--</span><span class="n">clean</span> <span class="n">compname</span>
</pre></div>
</div>
</dd>
</dl>
<p>Review the <strong>help</strong> text for more information.</p>
</section>
<section id="input-data">
<span id="inputdata"></span><h2><span class="section-number">4.3. </span>Input data<a class="headerlink" href="#input-data" title="Link to this heading"></a></h2>
<p>All active components and data components use input data sets. In order to run CIME and the CIME-compliant active components, a local disk needs the directory tree that is specified by the xml variable <code class="docutils literal notranslate"><span class="pre">$DIN_LOC_ROOT</span></code> to be populated with input data.</p>
<p>Input data is provided as part of the CIME release via data from a subversion input data server. It is downloaded from the server on an as-needed basis determined by the case. Data may already exist in the default local file system’s input data area as specified by <code class="docutils literal notranslate"><span class="pre">$DIN_LOC_ROOT</span></code>.</p>
<p>Input data can occupy significant space on a system, so users should share a common <code class="docutils literal notranslate"><span class="pre">$DIN_LOC_ROOT</span></code> directory on each system if possible.</p>
<p>The build process handles input data as follows:</p>
<ul>
<li><p>The <strong>buildnml</strong> scripts in the various component <code class="docutils literal notranslate"><span class="pre">cime_config</span></code> directories create listings of required component input data sets in the <code class="docutils literal notranslate"><span class="pre">Buildconf/$component.input_data_list</span></code> files.</p></li>
<li><p><a class="reference external" href="../Tools_user/check_input_data.html">check_input_data</a> , which is called by <a class="reference external" href="../Tools_user/case.build.html">case.build</a> , checks for the presence of the required input data files in the root directory <code class="docutils literal notranslate"><span class="pre">$DIN_LOC_ROOT</span></code>.</p></li>
<li><p>If all required data sets are found on the local disk, the build can proceed.</p></li>
<li><p>If any of the required input data sets are not found locally, the
files that are missing are listed. At this point, you must obtain
the required data from the input data server with <a class="reference external" href="../Tools_user/check_input_data.html">check_input_data</a> as shown here:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">check_input_data</span> <span class="o">--</span><span class="n">download</span>
</pre></div>
</div>
</li>
</ul>
<p>The <strong>env_run.xml</strong> variables <code class="docutils literal notranslate"><span class="pre">$DIN_LOC_ROOT</span></code> and <code class="docutils literal notranslate"><span class="pre">$DIN_LOC_ROOT_CLMFORC</span></code> determine where you should expect input data to reside on a local disk.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="setting-up-a-case.html" class="btn btn-neutral float-left" title="3. Setting up a Case" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="running-a-case.html" class="btn btn-neutral float-right" title="5. Running a Case" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017, U.S. National Science Foundation and U.S. Department of Energy.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
     
<script>var version_json_loc = "../../../versions.json";</script>


</footer>
        </div>
      </div>
    </section>
  </div>
  

  <script type="text/javascript">
    let baseUriRegex = /(.*\/cime)\/.*/g;
    let parsedUri = baseUriRegex.exec(document.baseURI);

    if (parsedUri != null && parsedUri.length == 2) {
      let baseUri = parsedUri[1];

      $.get(`${baseUri}/versions/versions.json`, function(data) {
        let versionElement = $("#versions");

        Object.keys(data).forEach(function(key) {
          let value = data[key];

          let item = `<dd><a href="${baseUri}/versions/${key}/html/">${value}</a></dd>`

          versionElement.append(item);
        });
      });
    }
  </script>
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: master
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <dl id="versions">
        <dt>Versions</dt>
      </dl>
      
      
    </div>
  </div>
<script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>